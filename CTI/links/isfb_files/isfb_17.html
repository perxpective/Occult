<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="profile" href="http://gmpg.org/xfn/11">

<title>RM3 &#8211; Curiosities of the wildest banking malware &#8211; Fox-IT International blog</title>
<script type="text/javascript">
  WebFontConfig = {"google":{"families":["Open+Sans:600:latin,latin-ext","Open+Sans:r,i,b,bi:latin,latin-ext"]},"api_url":"https:\/\/fonts-api.wp.com\/css"};
  (function() {
    var wf = document.createElement('script');
    wf.src = 'https://blog.fox-it.com/wp-content/mu-plugins/wpcomsh/vendor/automattic/custom-fonts/js/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
	})();
</script><style id="jetpack-custom-fonts-css">.wf-active code, .wf-active kbd, .wf-active pre, .wf-active samp{font-family:"Open Sans",sans-serif}.wf-active body{font-family:"Open Sans",sans-serif}.wf-active button, .wf-active input, .wf-active select{font-family:"Open Sans",sans-serif}.wf-active textarea{font-family:"Open Sans",sans-serif}.wf-active blockquote{font-family:"Open Sans",sans-serif}.wf-active code, .wf-active kbd, .wf-active pre, .wf-active tt, .wf-active var{font-family:"Open Sans",sans-serif}.wf-active .button, .wf-active .more-link, .wf-active button:not(.menu-toggle), .wf-active input[type="button"], .wf-active input[type="reset"], .wf-active input[type="submit"], .wf-active .posts-navigation .nav-links a, .wf-active #content #infinite-handle span button{font-family:"Open Sans",sans-serif}.wf-active input[type="email"], .wf-active input[type="password"], .wf-active input[type="search"], .wf-active input[type="text"], .wf-active input[type="url"], .wf-active textarea{font-family:"Open Sans",sans-serif}.wf-active .post-navigation{font-family:"Open Sans",sans-serif}.wf-active .main-navigation{font-family:"Open Sans",sans-serif}.wf-active .entry-content, .wf-active .entry-summary, .wf-active .page-content{font-family:"Open Sans",sans-serif}.wf-active .entry-content .subtitle{font-family:"Open Sans",sans-serif}.wf-active #comments{font-family:"Open Sans",sans-serif}.wf-active .comment-form label{font-family:"Open Sans",sans-serif}.wf-active .comment-form span.required{font-family:"Open Sans",sans-serif}.wf-active .widget_recent_entries span.post-date{font-family:"Open Sans",sans-serif}.wf-active .site-description{font-family:"Open Sans",sans-serif}.wf-active .site-posted-on time{font-family:"Open Sans",sans-serif}.wf-active .page-header:not(.page-header-light) .taxonomy-description{font-family:"Open Sans",sans-serif}.wf-active .light-text{font-family:"Open Sans",sans-serif}.wf-active .site-info{font-family:"Open Sans",sans-serif}.wf-active .sticky-label{font-family:"Open Sans",sans-serif}.wf-active .post-details, .wf-active .post-details a{font-family:"Open Sans",sans-serif}.wf-active .page-links{font-family:"Open Sans",sans-serif}.wf-active .post-edit-link{font-family:"Open Sans",sans-serif}.wf-active .post-author-card .author-description{font-family:"Open Sans",sans-serif}.wf-active #tinymce h1, .wf-active #tinymce h2, .wf-active #tinymce h3, .wf-active #tinymce h4, .wf-active #tinymce h5, .wf-active #tinymce h6, .wf-active .comment-content h1, .wf-active .comment-content h2, .wf-active .comment-content h3, .wf-active .comment-content h4, .wf-active .comment-content h5, .wf-active .comment-content h6, .wf-active .entry-content h1, .wf-active .entry-content h2, .wf-active .entry-content h3, .wf-active .entry-content h4, .wf-active .entry-content h5, .wf-active .entry-content h6, .wf-active .entry-summary h1, .wf-active .entry-summary h2, .wf-active .entry-summary h3, .wf-active .entry-summary h4, .wf-active .entry-summary h5, .wf-active .entry-summary h6, .wf-active .widget_text h1, .wf-active .widget_text h2, .wf-active .widget_text h3, .wf-active .widget_text h4, .wf-active .widget_text h5, .wf-active .widget_text h6{font-family:"Open Sans",sans-serif;font-style:normal;font-weight:600}.wf-active h1{font-style:normal;font-weight:600}.wf-active h2{font-style:normal;font-weight:600}.wf-active h3{font-style:normal;font-weight:600}.wf-active h4{font-style:normal;font-weight:600}.wf-active h5{font-style:normal;font-weight:600}.wf-active h6{font-style:normal;font-weight:600}.wf-active blockquote h1, .wf-active blockquote h2, .wf-active blockquote h3, .wf-active blockquote h4{font-family:"Open Sans",sans-serif;font-weight:600;font-style:normal}.wf-active div#jp-relatedposts h3.jp-relatedposts-headline em{font-family:"Open Sans",sans-serif;font-style:normal;font-weight:600}.wf-active .comment-reply-title, .wf-active .comments-title{font-family:"Open Sans",sans-serif;font-weight:600;font-style:normal}.wf-active .image-post-title{font-family:"Open Sans",sans-serif;font-weight:600;font-style:normal}.wf-active .page-header:not(.page-header-light) h1{font-style:normal;font-weight:600}.wf-active .entry-title{font-family:"Open Sans",sans-serif;font-style:normal;font-weight:600}.wf-active #post-cover-image .cover-meta .single-post-title{font-family:"Open Sans",sans-serif;font-style:normal;font-weight:600}.wf-active #hero-header .site-title{font-family:"Open Sans",sans-serif;font-style:normal;font-weight:600}.wf-active .site-header .site-title{font-style:normal;font-weight:600}.wf-active .site-header .site-description{font-style:normal;font-weight:600}</style>
<meta name='robots' content='max-image-preview:large' />
<link rel='dns-prefetch' href='//secure.gravatar.com' />
<link rel='dns-prefetch' href='//stats.wp.com' />
<link rel='dns-prefetch' href='//widgets.wp.com' />
<link rel='dns-prefetch' href='//jetpack.wordpress.com' />
<link rel='dns-prefetch' href='//s0.wp.com' />
<link rel='dns-prefetch' href='//public-api.wordpress.com' />
<link rel='dns-prefetch' href='//0.gravatar.com' />
<link rel='dns-prefetch' href='//1.gravatar.com' />
<link rel='dns-prefetch' href='//2.gravatar.com' />
<link rel='dns-prefetch' href='//i0.wp.com' />
<link rel='dns-prefetch' href='//c0.wp.com' />
<link rel="alternate" type="application/rss+xml" title="Fox-IT International blog &raquo; Feed" href="https://blog.fox-it.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Fox-IT International blog &raquo; Comments Feed" href="https://blog.fox-it.com/comments/feed/" />
<script type="text/javascript">
/* <![CDATA[ */
window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/14.0.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/14.0.0\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/blog.fox-it.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=6.4.2"}};
/*! This file is auto-generated */
!function(i,n){var o,s,e;function c(e){try{var t={supportTests:e,timestamp:(new Date).valueOf()};sessionStorage.setItem(o,JSON.stringify(t))}catch(e){}}function p(e,t,n){e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(t,0,0);var t=new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data),r=(e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(n,0,0),new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data));return t.every(function(e,t){return e===r[t]})}function u(e,t,n){switch(t){case"flag":return n(e,"\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f","\ud83c\udff3\ufe0f\u200b\u26a7\ufe0f")?!1:!n(e,"\ud83c\uddfa\ud83c\uddf3","\ud83c\uddfa\u200b\ud83c\uddf3")&&!n(e,"\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f","\ud83c\udff4\u200b\udb40\udc67\u200b\udb40\udc62\u200b\udb40\udc65\u200b\udb40\udc6e\u200b\udb40\udc67\u200b\udb40\udc7f");case"emoji":return!n(e,"\ud83e\udef1\ud83c\udffb\u200d\ud83e\udef2\ud83c\udfff","\ud83e\udef1\ud83c\udffb\u200b\ud83e\udef2\ud83c\udfff")}return!1}function f(e,t,n){var r="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?new OffscreenCanvas(300,150):i.createElement("canvas"),a=r.getContext("2d",{willReadFrequently:!0}),o=(a.textBaseline="top",a.font="600 32px Arial",{});return e.forEach(function(e){o[e]=t(a,e,n)}),o}function t(e){var t=i.createElement("script");t.src=e,t.defer=!0,i.head.appendChild(t)}"undefined"!=typeof Promise&&(o="wpEmojiSettingsSupports",s=["flag","emoji"],n.supports={everything:!0,everythingExceptFlag:!0},e=new Promise(function(e){i.addEventListener("DOMContentLoaded",e,{once:!0})}),new Promise(function(t){var n=function(){try{var e=JSON.parse(sessionStorage.getItem(o));if("object"==typeof e&&"number"==typeof e.timestamp&&(new Date).valueOf()<e.timestamp+604800&&"object"==typeof e.supportTests)return e.supportTests}catch(e){}return null}();if(!n){if("undefined"!=typeof Worker&&"undefined"!=typeof OffscreenCanvas&&"undefined"!=typeof URL&&URL.createObjectURL&&"undefined"!=typeof Blob)try{var e="postMessage("+f.toString()+"("+[JSON.stringify(s),u.toString(),p.toString()].join(",")+"));",r=new Blob([e],{type:"text/javascript"}),a=new Worker(URL.createObjectURL(r),{name:"wpTestEmojiSupports"});return void(a.onmessage=function(e){c(n=e.data),a.terminate(),t(n)})}catch(e){}c(n=f(s,u,p))}t(n)}).then(function(e){for(var t in e)n.supports[t]=e[t],n.supports.everything=n.supports.everything&&n.supports[t],"flag"!==t&&(n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&n.supports[t]);n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&!n.supports.flag,n.DOMReady=!1,n.readyCallback=function(){n.DOMReady=!0}}).then(function(){return e}).then(function(){var e;n.supports.everything||(n.readyCallback(),(e=n.source||{}).concatemoji?t(e.concatemoji):e.wpemoji&&e.twemoji&&(t(e.twemoji),t(e.wpemoji)))}))}((window,document),window._wpemojiSettings);
/* ]]> */
</script>
<link rel='stylesheet' id='all-css-dbdd6f9b800695287d86e5a846b4b04a' href='https://blog.fox-it.com/_static/??-eJydkttuwjAMhl9oIStM29W0G6Q9AA8wpYkVTHNSnYj17edAQYAGFC4q2am/38dtEjqGDCHL5IrFQNIWdlvorWwLOiNbF3UnHLa96gdJeXAw00Qv20fRvAZ/FXVqiCUL26M5z4FBu2KA5IakB4MKHMsweeokxqEXDqzSw8xjuEvzv1P/lLksTcddHyQNUt4XJw5vonmKgl+OJYyBnsJVQK8y41MXoaNPMXAE3V7gMetxbktIEAwEjex8x6UyZpCrqkGjtlMZKF9T3EBOSnfSR1Mq47CDO0UckB8uQloI0COH0P/m1Ly6UI5ecPSZyV/rVOguZXa3Wsdgxv6zSKV1SGs+s/nI1Uk9CNaW9svcJl7K1OpprXowu9lXE4OdNDyKGpUTLtpIZ86tcz8o1B5Hu4Z++c/m43Xx3rw1i/kfWG2dlg==' type='text/css' media='all' />
<style id='wp-block-library-inline-css'>
.has-text-align-justify{text-align:justify;}
</style>
<style id='independent-publisher-2-style-inline-css'>
.cat-links, .post-tags, .tags-links, .byline { clip: rect(1px, 1px, 1px, 1px); height: 1px; position: absolute; overflow: hidden; width: 1px; }
</style>
<style id='wp-emoji-styles-inline-css'>

	img.wp-smiley, img.emoji {
		display: inline !important;
		border: none !important;
		box-shadow: none !important;
		height: 1em !important;
		width: 1em !important;
		margin: 0 0.07em !important;
		vertical-align: -0.1em !important;
		background: none !important;
		padding: 0 !important;
	}
</style>
<style id='classic-theme-styles-inline-css'>
/*! This file is auto-generated */
.wp-block-button__link{color:#fff;background-color:#32373c;border-radius:9999px;box-shadow:none;text-decoration:none;padding:calc(.667em + 2px) calc(1.333em + 2px);font-size:1.125em}.wp-block-file__button{background:#32373c;color:#fff;text-decoration:none}
</style>
<style id='global-styles-inline-css'>
body{--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #fff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--color--medium-blue: #0087be;--wp--preset--color--bright-blue: #00aadc;--wp--preset--color--dark-gray: #4d4d4b;--wp--preset--color--light-gray: #b3b3b1;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;--wp--preset--font-family--albert-sans: 'Albert Sans', sans-serif;--wp--preset--font-family--alegreya: Alegreya, serif;--wp--preset--font-family--arvo: Arvo, serif;--wp--preset--font-family--bodoni-moda: 'Bodoni Moda', serif;--wp--preset--font-family--cabin: Cabin, sans-serif;--wp--preset--font-family--chivo: Chivo, sans-serif;--wp--preset--font-family--commissioner: Commissioner, sans-serif;--wp--preset--font-family--cormorant: Cormorant, serif;--wp--preset--font-family--courier-prime: 'Courier Prime', monospace;--wp--preset--font-family--crimson-pro: 'Crimson Pro', serif;--wp--preset--font-family--dm-mono: 'DM Mono', monospace;--wp--preset--font-family--dm-sans: 'DM Sans', sans-serif;--wp--preset--font-family--domine: Domine, serif;--wp--preset--font-family--eb-garamond: 'EB Garamond', serif;--wp--preset--font-family--epilogue: Epilogue, sans-serif;--wp--preset--font-family--figtree: Figtree, sans-serif;--wp--preset--font-family--fira-sans: 'Fira Sans', sans-serif;--wp--preset--font-family--fraunces: Fraunces, serif;--wp--preset--font-family--ibm-plex-mono: 'IBM Plex Mono', monospace;--wp--preset--font-family--ibm-plex-sans: 'IBM Plex Sans', sans-serif;--wp--preset--font-family--inter: Inter, sans-serif;--wp--preset--font-family--josefin-sans: 'Josefin Sans', sans-serif;--wp--preset--font-family--jost: Jost, sans-serif;--wp--preset--font-family--libre-baskerville: 'Libre Baskerville', serif;--wp--preset--font-family--libre-franklin: 'Libre Franklin', sans-serif;--wp--preset--font-family--literata: Literata, serif;--wp--preset--font-family--lora: Lora, serif;--wp--preset--font-family--merriweather: Merriweather, serif;--wp--preset--font-family--montserrat: Montserrat, sans-serif;--wp--preset--font-family--newsreader: Newsreader, serif;--wp--preset--font-family--nunito: Nunito, sans-serif;--wp--preset--font-family--open-sans: 'Open Sans', sans-serif;--wp--preset--font-family--overpass: Overpass, sans-serif;--wp--preset--font-family--petrona: Petrona, serif;--wp--preset--font-family--piazzolla: Piazzolla, serif;--wp--preset--font-family--playfair-display: 'Playfair Display', serif;--wp--preset--font-family--plus-jakarta-sans: 'Plus Jakarta Sans', sans-serif;--wp--preset--font-family--poppins: Poppins, sans-serif;--wp--preset--font-family--raleway: Raleway, sans-serif;--wp--preset--font-family--roboto: Roboto, sans-serif;--wp--preset--font-family--roboto-slab: 'Roboto Slab', serif;--wp--preset--font-family--rubik: Rubik, sans-serif;--wp--preset--font-family--sora: Sora, sans-serif;--wp--preset--font-family--source-sans-3: 'Source Sans 3', sans-serif;--wp--preset--font-family--source-serif-4: 'Source Serif 4', serif;--wp--preset--font-family--space-mono: 'Space Mono', monospace;--wp--preset--font-family--texturina: Texturina, serif;--wp--preset--font-family--work-sans: 'Work Sans', sans-serif;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;--wp--preset--shadow--natural: 6px 6px 9px rgba(0, 0, 0, 0.2);--wp--preset--shadow--deep: 12px 12px 50px rgba(0, 0, 0, 0.4);--wp--preset--shadow--sharp: 6px 6px 0px rgba(0, 0, 0, 0.2);--wp--preset--shadow--outlined: 6px 6px 0px -3px rgba(255, 255, 255, 1), 6px 6px rgba(0, 0, 0, 1);--wp--preset--shadow--crisp: 6px 6px 0px rgba(0, 0, 0, 1);}:where(.is-layout-flex){gap: 0.5em;}:where(.is-layout-grid){gap: 0.5em;}body .is-layout-flow > .alignleft{float: left;margin-inline-start: 0;margin-inline-end: 2em;}body .is-layout-flow > .alignright{float: right;margin-inline-start: 2em;margin-inline-end: 0;}body .is-layout-flow > .aligncenter{margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > .alignleft{float: left;margin-inline-start: 0;margin-inline-end: 2em;}body .is-layout-constrained > .alignright{float: right;margin-inline-start: 2em;margin-inline-end: 0;}body .is-layout-constrained > .aligncenter{margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > :where(:not(.alignleft):not(.alignright):not(.alignfull)){max-width: var(--wp--style--global--content-size);margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > .alignwide{max-width: var(--wp--style--global--wide-size);}body .is-layout-flex{display: flex;}body .is-layout-flex{flex-wrap: wrap;align-items: center;}body .is-layout-flex > *{margin: 0;}body .is-layout-grid{display: grid;}body .is-layout-grid > *{margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}.has-albert-sans-font-family{font-family: var(--wp--preset--font-family--albert-sans) !important;}.has-alegreya-font-family{font-family: var(--wp--preset--font-family--alegreya) !important;}.has-arvo-font-family{font-family: var(--wp--preset--font-family--arvo) !important;}.has-bodoni-moda-font-family{font-family: var(--wp--preset--font-family--bodoni-moda) !important;}.has-cabin-font-family{font-family: var(--wp--preset--font-family--cabin) !important;}.has-chivo-font-family{font-family: var(--wp--preset--font-family--chivo) !important;}.has-commissioner-font-family{font-family: var(--wp--preset--font-family--commissioner) !important;}.has-cormorant-font-family{font-family: var(--wp--preset--font-family--cormorant) !important;}.has-courier-prime-font-family{font-family: var(--wp--preset--font-family--courier-prime) !important;}.has-crimson-pro-font-family{font-family: var(--wp--preset--font-family--crimson-pro) !important;}.has-dm-mono-font-family{font-family: var(--wp--preset--font-family--dm-mono) !important;}.has-dm-sans-font-family{font-family: var(--wp--preset--font-family--dm-sans) !important;}.has-domine-font-family{font-family: var(--wp--preset--font-family--domine) !important;}.has-eb-garamond-font-family{font-family: var(--wp--preset--font-family--eb-garamond) !important;}.has-epilogue-font-family{font-family: var(--wp--preset--font-family--epilogue) !important;}.has-figtree-font-family{font-family: var(--wp--preset--font-family--figtree) !important;}.has-fira-sans-font-family{font-family: var(--wp--preset--font-family--fira-sans) !important;}.has-fraunces-font-family{font-family: var(--wp--preset--font-family--fraunces) !important;}.has-ibm-plex-mono-font-family{font-family: var(--wp--preset--font-family--ibm-plex-mono) !important;}.has-ibm-plex-sans-font-family{font-family: var(--wp--preset--font-family--ibm-plex-sans) !important;}.has-inter-font-family{font-family: var(--wp--preset--font-family--inter) !important;}.has-josefin-sans-font-family{font-family: var(--wp--preset--font-family--josefin-sans) !important;}.has-jost-font-family{font-family: var(--wp--preset--font-family--jost) !important;}.has-libre-baskerville-font-family{font-family: var(--wp--preset--font-family--libre-baskerville) !important;}.has-libre-franklin-font-family{font-family: var(--wp--preset--font-family--libre-franklin) !important;}.has-literata-font-family{font-family: var(--wp--preset--font-family--literata) !important;}.has-lora-font-family{font-family: var(--wp--preset--font-family--lora) !important;}.has-merriweather-font-family{font-family: var(--wp--preset--font-family--merriweather) !important;}.has-montserrat-font-family{font-family: var(--wp--preset--font-family--montserrat) !important;}.has-newsreader-font-family{font-family: var(--wp--preset--font-family--newsreader) !important;}.has-nunito-font-family{font-family: var(--wp--preset--font-family--nunito) !important;}.has-open-sans-font-family{font-family: var(--wp--preset--font-family--open-sans) !important;}.has-overpass-font-family{font-family: var(--wp--preset--font-family--overpass) !important;}.has-petrona-font-family{font-family: var(--wp--preset--font-family--petrona) !important;}.has-piazzolla-font-family{font-family: var(--wp--preset--font-family--piazzolla) !important;}.has-playfair-display-font-family{font-family: var(--wp--preset--font-family--playfair-display) !important;}.has-plus-jakarta-sans-font-family{font-family: var(--wp--preset--font-family--plus-jakarta-sans) !important;}.has-poppins-font-family{font-family: var(--wp--preset--font-family--poppins) !important;}.has-raleway-font-family{font-family: var(--wp--preset--font-family--raleway) !important;}.has-roboto-font-family{font-family: var(--wp--preset--font-family--roboto) !important;}.has-roboto-slab-font-family{font-family: var(--wp--preset--font-family--roboto-slab) !important;}.has-rubik-font-family{font-family: var(--wp--preset--font-family--rubik) !important;}.has-sora-font-family{font-family: var(--wp--preset--font-family--sora) !important;}.has-source-sans-3-font-family{font-family: var(--wp--preset--font-family--source-sans-3) !important;}.has-source-serif-4-font-family{font-family: var(--wp--preset--font-family--source-serif-4) !important;}.has-space-mono-font-family{font-family: var(--wp--preset--font-family--space-mono) !important;}.has-texturina-font-family{font-family: var(--wp--preset--font-family--texturina) !important;}.has-work-sans-font-family{font-family: var(--wp--preset--font-family--work-sans) !important;}
:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}
.wp-block-pullquote{font-size: 1.5em;line-height: 1.6;}
.wp-block-navigation a:where(:not(.wp-element-button)){color: inherit;}
:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}
</style>
<link rel='stylesheet' id='dashicons-css' href='https://blog.fox-it.com/wp-includes/css/dashicons.min.css?ver=6.4.2' media='all' />
<style id='jetpack-global-styles-frontend-style-inline-css'>
:root { --font-headings: unset; --font-base: unset; --font-headings-default: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif; --font-base-default: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif;}
</style>
<script type='text/javascript'  src='https://blog.fox-it.com/wp-content/plugins/gutenberg/build/modules/importmap-polyfill.min.js?m=1703614132'></script>
<link rel="https://api.w.org/" href="https://blog.fox-it.com/wp-json/" /><link rel="alternate" type="application/json" href="https://blog.fox-it.com/wp-json/wp/v2/posts/3036" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://blog.fox-it.com/xmlrpc.php?rsd" />

<link rel="canonical" href="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/" />
<link rel='shortlink' href='https://wp.me/pWykx-MY' />
<link rel="alternate" type="application/json+oembed" href="https://blog.fox-it.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fblog.fox-it.com%2F2021%2F05%2F04%2Frm3-curiosities-of-the-wildest-banking-malware%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://blog.fox-it.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fblog.fox-it.com%2F2021%2F05%2F04%2Frm3-curiosities-of-the-wildest-banking-malware%2F&#038;format=xml" />
	<style>img#wpstats{display:none}</style>
				<style type="text/css">
			.recentcomments a {
				display: inline !important;
				padding: 0 !important;
				margin: 0 !important;
			}

			table.recentcommentsavatartop img.avatar, table.recentcommentsavatarend img.avatar {
				border: 0px;
				margin: 0;
			}

			table.recentcommentsavatartop a, table.recentcommentsavatarend a {
				border: 0px !important;
				background-color: transparent !important;
			}

			td.recentcommentsavatarend, td.recentcommentsavatartop {
				padding: 0px 0px 1px 0px;
				margin: 0px;
			}

			td.recentcommentstextend {
				border: none !important;
				padding: 0px 0px 2px 10px;
			}

			.rtl td.recentcommentstextend {
				padding: 0px 10px 2px 0px;
			}

			td.recentcommentstexttop {
				border: none;
				padding: 0px 0px 0px 10px;
			}

			.rtl td.recentcommentstexttop {
				padding: 0px 10px 0px 0px;
			}
		</style>
		<meta name="description" content="fumik0_ &amp; the RIFT Team TL:DR Our&nbsp;Research and Intelligence Fusion Team have been tracking the&nbsp;Gozi&nbsp;variant RM3 for close to 30 months. In this post we provide&nbsp;some&nbsp;history, analysis and observations&nbsp;on&nbsp;this most pernicious family of banking malware targeting Oceania, the UK, Germany and Italy.&nbsp; We’ll start with&nbsp;an overview of its origins&nbsp;and&nbsp;current operations before providing a deep&nbsp;dive&nbsp;technical analysis&hellip;" />
	<style id="independent-publisher-2-custom-header-css" type="text/css">
			.site-title,
		.site-description,
		#hero-header #hero-social-navigation {
			clip: rect(1px, 1px, 1px, 1px);
			position: absolute;
		}
		</style>
	<link rel="amphtml" href="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/amp/">
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="RM3 &#8211; Curiosities of the wildest banking malware" />
<meta property="og:url" content="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/" />
<meta property="og:description" content="fumik0_ &amp; the RIFT Team TL:DR Our&nbsp;Research and Intelligence Fusion Team have been tracking the&nbsp;Gozi&nbsp;variant RM3 for close to 30 months. In this post we provide&nbsp;some&nbsp;his…" />
<meta property="article:published_time" content="2021-05-04T14:47:41+00:00" />
<meta property="article:modified_time" content="2021-05-04T18:14:08+00:00" />
<meta property="og:site_name" content="Fox-IT International blog" />
<meta property="og:image" content="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Explorer_Tasks.png?fit=1200%2C512&#038;ssl=1" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="512" />
<meta property="og:image:alt" content="" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:text:title" content="RM3 &#8211; Curiosities of the wildest banking malware" />
<meta name="twitter:image" content="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Explorer_Tasks.png?fit=1200%2C512&#038;ssl=1&#038;w=640" />
<meta name="twitter:card" content="summary_large_image" />

<!-- End Jetpack Open Graph Tags -->
<style type="text/css" id="custom-colors-css">.has-header-image .site-title a,.has-header-image .site-title a:visited{color:#fff}@media screen and (max-width:32.374em){.main-navigation ul ul{background:0 0 !important}.main-navigation ul ul a{color:inherit !important}}.widget_recent_comments a,.widget_recent_entries a,body,input,select,textarea,.menu-toggle{color:#383838}#infinite-footer .blog-info a:hover,#infinite-footer .blog-credits a:hover{color:#383838}.posts-navigation .nav-links a,.main-navigation ul ul a,.main-navigation>div>ul>li.current-menu-item>ul>li a,.main-navigation>div>ul>li.current_page_item>ul>li a{color:#303030}input[type=button],input[type=button]:hover,input[type=reset],input[type=reset]:hover,input[type=submit],input[type=submit]:hover,button,.button,.button:hover,#content #infinite-handle span button,#content #infinite-handle span button:hover,.more-link,.more-link:hover,.more-link:visited{color:#303030}.site-main>.hentry:nth-child(n+2),.site .infinite-wrap>.hentry:nth-child(n+2),.entry-author-wrapper,.post-navigation,.comment,.page-links a:hover,.main-navigation li{border-color:#ddd}.site-main>.hentry:nth-child(n+2),.site .infinite-wrap>.hentry:nth-child(n+2),.entry-author-wrapper,.post-navigation,.comment,.page-links a:hover,.main-navigation li{border-color:rgba(221,221,221,.25)}#infinite-footer .blog-info a,#infinite-footer .blog-credits,#infinite-footer .blog-credits a{color:#6d6d6d}.post-details,.post-details a,.post-details a:visited,.post-edit-link a,.post-edit-link a:visited{color:#6e6e6c}.post-tags li:first-child,.jetpack-social-navigation li a:hover,.widget_wpcom_social_media_icons_widget li a:hover,.jetpack-social-navigation li a:focus,.widget_wpcom_social_media_icons_widget li a:focus,.jetpack-social-navigation li a:active,.widget_wpcom_social_media_icons_widget li a:active{color:#515151}.jetpack-social-navigation li a,.widget_wpcom_social_media_icons_widget li a{color:#6d6d6d}.post-navigation .nav-links a:hover,.post-navigation .nav-links a:focus,.post-navigation .nav-links a:active,.entry-author .author-bio,.site-posted-on time,.site-description{color:#6d6d6d}.comment .comment-meta,.comment-form label,.light-text,.light-text a,.light-text a:visited,.widget_rss .rss-date,.widget_rss li>cite{color:#6e6e6c}.light-text a:hover{color:#6e6e6c}body{background-color:#fff}#infinite-footer .container{background-color:#fff}#infinite-footer .container{background-color:rgba(255,255,255,.7)}.post-edit-link a{background-color:#f9f9f9}.entry-author .author-title,.entry-title,.entry-title a,.entry-title a:visited,.site-posted-on strong,.site-title,.site-title a,.site-title a:visited,.entry-title a:hover,.site-title a:hover,h1,h2,h3,h4,h5,h6,.page-header:not(.page-header-light) h1,.comment .comment-meta .comment-author .fn{color:#00284d}.comment-form input[type=email]:active,.comment-form input[type=email]:focus,.comment-form input[type=password]:active,.comment-form input[type=password]:focus,.comment-form input[type=search]:active,.comment-form input[type=search]:focus,.comment-form input[type=text]:active,.comment-form input[type=text]:focus,.comment-form input[type=url]:active,.comment-form input[type=url]:focus,.comment-form textarea:active,.comment-form textarea:focus,blockquote,input[type=email]:focus,input[type=password]:focus,input[type=search]:focus,input[type=text]:focus,input[type=url]:focus,textarea:focus{border-color:#1cabe5}.comment .comment-meta .comment-metadata a:hover,.comment-form span.required,.pingback:before,.post-details a:hover,.post-edit-link a:active,.post-edit-link a:focus,.post-edit-link a:hover,.site-info a:hover,.trackback:before,a,a:visited{color:#0b77a2}.main-navigation>div>ul>li.current-menu-item>a,.main-navigation>div>ul>li.current_page_item>a,a:active,a:focus,a:hover,.page-links a:hover{color:#1cabe5}.posts-navigation .nav-links a,.main-navigation ul ul{background-color:#1cabe5}button,input[type=button],input[type=reset],input[type=submit],.button,#content #infinite-handle span button,.more-link{background-color:#1cabe5}button:not(".components-button"):hover,input[type=button]:hover,input[type=reset]:hover,input[type=submit]:hover,.button:hover,#content #infinite-handle span button:hover,.more-link:hover{background-color:#1588b6}</style>
<link rel="icon" href="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2022/01/cropped-fox-favicon.png?fit=32%2C32&#038;ssl=1" sizes="32x32" />
<link rel="icon" href="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2022/01/cropped-fox-favicon.png?fit=192%2C192&#038;ssl=1" sizes="192x192" />
<link rel="apple-touch-icon" href="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2022/01/cropped-fox-favicon.png?fit=180%2C180&#038;ssl=1" />
<meta name="msapplication-TileImage" content="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2022/01/cropped-fox-favicon.png?fit=270%2C270&#038;ssl=1" />
<link rel="stylesheet" type="text/css" id="wp-custom-css" href="https://blog.fox-it.com/?custom-css=a785352500" /><!-- Jetpack Google Analytics -->
			<script type='text/javascript'>
				var _gaq = _gaq || [];
				_gaq.push(['_setAccount', 'UA-7750533-3']);
_gaq.push(['_trackPageview']);
				(function() {
					var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
					ga.src = ('https:' === document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
					var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
				})();
			</script>
			<!-- End Jetpack Google Analytics -->
</head>

<body class="post-template-default single single-post postid-3036 single-format-standard wp-custom-logo wp-embed-responsive group-blog custom-colors categories-hidden tags-hidden author-hidden">

<div id="page" class="hfeed site">
	<a class="skip-link screen-reader-text" href="#content">Skip to content</a>

	<div id="hero-header" class="site-hero-section">
		<header id="masthead" class="site-header" role="banner">
			<div class="inner">
				<div class="site-branding">
					<a href="https://blog.fox-it.com/" class="custom-logo-link" rel="home"><img width="180" height="49" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2019/02/fox-it-logo.png?fit=180%2C49&amp;ssl=1" class="custom-logo" alt="Fox-IT International blog" decoding="async" data-attachment-id="2375" data-permalink="https://blog.fox-it.com/fox-it-logo-2/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2019/02/fox-it-logo.png?fit=180%2C49&amp;ssl=1" data-orig-size="180,49" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="fox-it-logo" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2019/02/fox-it-logo.png?fit=180%2C49&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2019/02/fox-it-logo.png?fit=180%2C49&amp;ssl=1" /></a>
												<p class="site-title"><a href="https://blog.fox-it.com/" rel="home">Fox-IT International blog</a></p>
													<p class="site-description">News and opinions from Fox-IT</p>
									</div><!-- .site-branding -->

				
									<button class="menu-toggle" aria-controls="primary-menu" aria-expanded="false" id="primary-menu-button">
						Menu					</button><!-- .menu-toggle -->
				
			</div><!-- .inner -->
		</header><!-- #masthead -->
	</div>

				<nav id="site-navigation" class="main-navigation" role="navigation">
			<div class="menu-main-menu-container"><ul id="primary-menu" class="menu"><li id="menu-item-247" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-247"><a href="http://blog.fox-it.com/">Home</a></li>
<li id="menu-item-2346" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2346"><a href="https://blog.fox-it.com/archive/">Archive</a></li>
<li id="menu-item-246" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-246"><a href="http://www.fox-it.com">Back to Fox-IT</a></li>
</ul></div>		</nav><!-- .main-navigation -->
	
	
	
	<div id="content-wrapper" class="content-wrapper">
		<div id="content" class="site-content">

	<div id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
			
<article id="post-3036" class="post-3036 post type-post status-publish format-standard hentry category-threat-intelligence tag-rm3">
			<header class="entry-header">
			<h1 class="entry-title">RM3 &#8211; Curiosities of the wildest banking malware</h1>		</header><!-- .entry-header -->		<div class="entry-meta">
			<span class="byline">
				<a href="https://blog.fox-it.com/author/riftsle/" title="Posts by riftsle" rel="author">riftsle</a>			</span>
							<span class="cat-links">
					<a href="https://blog.fox-it.com/category/threat-intelligence/" rel="category tag">Threat Intelligence</a>				</span><!-- .cat-links -->
			
			
			<span class="published-on">
				<time class="entry-date published" datetime="2021-05-04T16:47:41+02:00">May 4, 2021</time><time class="updated" datetime="2021-05-04T20:14:08+02:00">May 4, 2021</time>			</span>

			<span class="word-count">39 Minutes</span>		</div><!-- .entry-meta -->
	
	<div class="entry-content">
		
<p><em><strong><a href="https://twitter.com/fumik0_" data-type="URL" data-id="https://twitter.com/fumik0_">fumik0_</a> &amp; the RIFT Team</strong></em></p>



<h2 class="wp-block-heading">TL:DR</h2>



<p>Our&nbsp;Research and Intelligence Fusion Team have been tracking the&nbsp;Gozi&nbsp;variant RM3 for close to 30 months. In this post we provide&nbsp;some&nbsp;history, analysis and observations&nbsp;on&nbsp;this most pernicious family of banking malware targeting Oceania, the UK, Germany and Italy.&nbsp;</p>



<p>We’ll start with&nbsp;an overview of its origins&nbsp;and&nbsp;current operations before providing a deep&nbsp;dive&nbsp;technical analysis of the RM3 variant.&nbsp;</p>



<h2 class="wp-block-heading">Introduction</h2>



<p>Despite its long and rich history in the cyber-criminal underworld,&nbsp;the&nbsp;<strong>Gozi</strong>&nbsp;malware family is surrounded with mystery and confusion.&nbsp;The leaking of&nbsp;its source code&nbsp;only increased this confusion as it led to&nbsp;an influx of&nbsp;<strong>Gozi</strong>&nbsp;variants&nbsp;across&nbsp;the threat landscape.&nbsp;&nbsp;</p>



<p>Although most&nbsp;variants&nbsp;were only short-lived – they either disappeared or were taken down by law enforcement –&nbsp;a few&nbsp;have&nbsp;had&nbsp;greater&nbsp;staying power.&nbsp;</p>



<p>Since September 2019, Fox-IT/NCC Group&nbsp;has&nbsp;intensified its research into&nbsp;known&nbsp;active&nbsp;<strong>Gozi</strong>&nbsp;variants. These are&nbsp;operated by a variety of threat actors&nbsp;(TAs)&nbsp;and generally&nbsp;cause financial losses by either&nbsp;direct involvement in&nbsp;transactional fraud,&nbsp;or by facilitating other types of malicious activity, such as targeted ransomware activity.&nbsp;</p>



<p><strong>Gozi</strong><strong>&nbsp;ISFB</strong>&nbsp;started&nbsp;targeting&nbsp;financial institutions around 2013-2015 and hasn&#8217;t stopped since then. It is one of the few &#8211; perhaps the only &#8211; main active branches&nbsp;of&nbsp;the notorious 15 year old&nbsp;<strong>Gozi</strong>&nbsp;/&nbsp;<strong>CRM</strong>.&nbsp;Its popularity is&nbsp;probably&nbsp;due to&nbsp;the&nbsp;wide&nbsp;range&nbsp;of variants&nbsp;which are available&nbsp;and&nbsp;the way threat&nbsp;actor groups&nbsp;can use&nbsp;these&nbsp;for their own goals.&nbsp;</p>



<p>In 2017,&nbsp;yet another&nbsp;new version was detected in the wild with a&nbsp;number&nbsp;of major modifications compared to the previous&nbsp;main&nbsp;variant:</p>



<ul><li>Rebranded&nbsp;<strong>RM</strong>&nbsp;loader (called&nbsp;<strong>RM3</strong>)&nbsp;</li><li>Used&nbsp;exotic PE&nbsp;file&nbsp;format&nbsp;exclusively designed for this banking malware&nbsp;</li><li>Modular architecture&nbsp;</li><li>Network communication reworked&nbsp;</li><li>New modules&nbsp;</li></ul>



<p>Given the complex development history of the <strong>Gozi ISFB</strong> forks, it is difficult to say with any certainty which variant was used as the basis for <strong>RM3</strong>. This is further complicated by the many different names used by the Cyber Threat Intelligence and Anti-Virus industries for this family of malware. But if you would like to understand the rather tortured history of this particular malware a little better, the research and blog posts on the subject by <a href="https://research.checkpoint.com/2020/gozi-the-malware-with-a-thousand-faces/" data-type="URL" data-id="https://research.checkpoint.com/2020/gozi-the-malware-with-a-thousand-faces/"><strong>Check Point</strong> </a>are a good starting point.</p>



<h2 class="wp-block-heading">Banking malware targeting mainly Europe &amp; Oceania</h2>



<p>With more than four years of activity, <strong>RM3</strong> has had a significant impact on the financial fraud landscape by spreading a colossal number of campaigns, principally across two regions:</p>



<ul><li><strong><em>Oceania</em></strong>, to date, Australia and New Zealand are the most impacted countries in this region. Threat actors seemed to have significant experience and used traditional means to conduct fraud and theft, mainly using web injects to push fakes or replacers directly into financial websites. Some of these injectors are more advanced than the usual ones that could be seen in bankers, and suggest the operators behind them were more sophisticated and experienced.</li><li><strong><em>Europe</em></strong>, targeting primarily the UK, Germany and Italy. In this region, a manual fraud strategy was generally followed which was drastically different to the approach seen in Oceania.</li></ul>



<div class="wp-block-image"><figure class="aligncenter size-large"><img decoding="async" width="785" height="406" data-attachment-id="3061" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/rm3_zones-1/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Zones-1.png?fit=785%2C406&amp;ssl=1" data-orig-size="785,406" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="RM3_Zones-1" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Zones-1.png?fit=300%2C155&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Zones-1.png?fit=785%2C406&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Zones-1.png?resize=785%2C406&#038;ssl=1" alt="" class="wp-image-3061" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Zones-1.png?w=785&amp;ssl=1 785w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Zones-1.png?resize=300%2C155&amp;ssl=1 300w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Zones-1.png?resize=768%2C397&amp;ssl=1 768w" sizes="(max-width: 785px) 100vw, 785px" data-recalc-dims="1" /><figcaption><em>Two different approaches to fraud used in Europe and Oceania</em></figcaption></figure></div>



<hr class="wp-block-separator" />



<p><em>It’s worth noting that ‘Elite’ in this context means highly skilled operators. The injects provided and the C&amp;C servers are by far the most complicated and restricted ones seen up to this date in the fraud landscape. </em><em></em></p>



<p>Fox-IT/NCC Group has currently counted at least eight* <strong>RM3</strong> infrastructures:</p>



<ul><li>4 in Europe</li><li>2 in Oceania (that seem to be linked together based on the fact that they share the same inject configurations)</li><li>1 worldwide (using AES-encryption)</li><li>1 unknown</li></ul>



<p>Looking back, 2019 seems to have been a golden age (at least from the malware operators&#8217; perspective), with five operators active at the same time. This golden age came to a sudden end with a sharp decline in 2020.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" decoding="async" width="800" height="313" data-attachment-id="3043" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/rm3_timeline/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Timeline.png?fit=1002%2C392&amp;ssl=1" data-orig-size="1002,392" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="RM3_Timeline" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Timeline.png?fit=300%2C117&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Timeline.png?fit=800%2C313&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Timeline.png?resize=800%2C313&#038;ssl=1" alt="" class="wp-image-3043" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Timeline.png?w=1002&amp;ssl=1 1002w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Timeline.png?resize=300%2C117&amp;ssl=1 300w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Timeline.png?resize=768%2C300&amp;ssl=1 768w" sizes="(max-width: 800px) 100vw, 800px" data-recalc-dims="1" /><figcaption><em>RM3 timeline of active campaigns seen in the wild</em></figcaption></figure></div>



<p>Even when some <strong>RM3</strong> controllers were not delivering any new campaigns, they were still managing their bots by pushing occasional updates and inspecting them carefully. Then, after a number of weeks, they start performing fraud on the most interesting targets. This is an extremely common pattern among bank malware operators in our experience, although the reasons for this pattern remain unclear. It may be a tactic related to maintaining stealth or it may simply be an indication of the operators lagging behind the sheer number of infections.</p>



<p>The global pandemic has had a noticeable impact on many types of <strong>RM3</strong> infrastructure, as it has on all malware as a service (MaaS) operations. The widespread lockdowns as a result of the pandemic have resulted in a massive number of bots being shut down as companies closed and users were forced to work from home, in some cases using personal computers. This change in working patterns could be an explanation for what happened between Q1 &amp; Q3 2020, when campaigns were drastically more aggressive than usual and bot infections intensified (and were also of lower quality, as if it was an emergency). The style of this operation differed drastically from the way in which <strong>RM3</strong> operated between 2018 and 2019, when there was a partnership with a distributor actor called <strong><a href="https://twitter.com/kafeine/status/1233407086324781058" data-type="URL" data-id="https://twitter.com/kafeine/status/1233407086324781058">Sagrid</a></strong>.</p>



<p>Analysis of the separate campaigns reveals that individual campaign infrastructures are independent from each of the others and operate their own strategies:</p>



<figure id="primary" class="wp-block-table is-style-regular"><table><thead><tr><th>RM3 Infra</th><th>Tasks</th><th>Injects <strong>†</strong> </th><th> </th><th> </th></tr></thead><tbody><tr><td>
        </td><td>
        </td><td><strong>Financial         </strong></td><td><strong>VNC         </strong></td><td><strong>SOCKS         </strong></td></tr><tr><td>UK 1
        </td><td>No‡
        </td><td>Yes
        </td><td>Yes
        </td><td>Yes
        </td></tr><tr><td>UK 2
        </td><td>Yes
        </td><td>No
        </td><td>No
        </td><td>No
        </td></tr><tr><td>Italy
        </td><td>No‡
        </td><td>Yes
        </td><td>Yes
        </td><td>Yes
        </td></tr><tr><td>Australia/NZ 1
        </td><td>Yes
        </td><td>Yes
        </td><td>No‡
        </td><td>No
        </td></tr><tr><td>Australia/NZ 2
        </td><td>Yes
        </td><td>Yes
        </td><td>No‡
        </td><td>No
        </td></tr><tr><td>RM3 .at
        </td><td>???
        </td><td>???
        </td><td>???
        </td><td>???
        </td></tr><tr><td>Germany
        </td><td>???
        </td><td>???
        </td><td>???
        </td><td>???
        </td></tr><tr><td>Worldwide
        </td><td>Yes
        </td><td>No
        </td><td>No
        </td><td>No
        </td></tr></tbody></table></figure>



<div class="wp-block-columns is-layout-flex wp-container-core-columns-layout-1 wp-block-columns-is-layout-flex">
<div class="wp-block-column is-vertically-aligned-center is-layout-flow wp-block-column-is-layout-flow" style="flex-basis:100%"></div>
</div>



<p><strong>†</strong><em> Based on the web inject configuration file from config.bin</em><br>‡<em> Based on active campaign monitoring, threat actor team(s) are mainly inspecting bots to manually push extra commands like VNC module for starting fraud activities.</em></p>



<h2 class="wp-block-heading">A robust and stable distribution routine</h2>



<p>As with many malware processes, renewing bots is not a simple, linear thing and many elements have to be taken into consideration:</p>



<ul><li>Malware signatures</li><li>Packer evading AV/EDR</li><li>Distribution used (ratio effectiveness)</li><li>Time of an active campaign before being takedown by abuse</li></ul>



<p>Many channels have been used to spread this malware, with distribution by spam (malspam) the most popular – and also the most effective. Multiple distribution teams are behind these campaigns and it is difficult to identify all of them; particularly so now, given the increased professionalisation of these operations (which now can involve shorter term, contractor like relationships). As a result, while malware campaign infrastructures are separate, there is now more overlap between the various infrastructures. It is certain however that one actor known as <strong>Sagrid</strong> was definitely the most prolific distributor. Around 2018/2019, <strong>Sagrid </strong>actively spread malware in Australia and New Zealand, using advanced techniques to deliver it to their victims.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" decoding="async" width="800" height="403" data-attachment-id="3048" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/rm3_delivery/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Delivery.png?fit=804%2C405&amp;ssl=1" data-orig-size="804,405" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="RM3_Delivery" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Delivery.png?fit=300%2C151&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Delivery.png?fit=800%2C403&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Delivery.png?resize=800%2C403&#038;ssl=1" alt="" class="wp-image-3048" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Delivery.png?w=804&amp;ssl=1 804w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Delivery.png?resize=300%2C151&amp;ssl=1 300w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Delivery.png?resize=768%2C387&amp;ssl=1 768w" sizes="(max-width: 800px) 100vw, 800px" data-recalc-dims="1" /><figcaption><em>RM3 distribution over the past 4 years</em></figcaption></figure></div>



<p>The graphic below shows the distribution method of an individual piece of RM3 malware in more detail.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" decoding="async" width="800" height="524" data-attachment-id="3050" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/classic_walkthrough/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/Classic_Walkthrough.png?fit=954%2C625&amp;ssl=1" data-orig-size="954,625" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Classic_Walkthrough" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/Classic_Walkthrough.png?fit=300%2C197&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/Classic_Walkthrough.png?fit=800%2C524&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/Classic_Walkthrough.png?resize=800%2C524&#038;ssl=1" alt="" class="wp-image-3050" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/Classic_Walkthrough.png?w=954&amp;ssl=1 954w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/Classic_Walkthrough.png?resize=300%2C197&amp;ssl=1 300w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/Classic_Walkthrough.png?resize=768%2C503&amp;ssl=1 768w" sizes="(max-width: 800px) 100vw, 800px" data-recalc-dims="1" /><figcaption><em>A simplified path of a payload from its compilation to its delivery </em></figcaption></figure></div>



<p>Interestingly, the only exploit kit seen to be involved in the distribution of RM3 has been&nbsp; <strong>Spelevo </strong>&#8211; at least in our experience. These days, Exploit Kits (EK) are not as active as in their golden era in the 2010s (when <strong>Angler EK</strong> dominated the market along with <strong>Rig</strong> and <strong>Magnitude</strong>). But they are still an interesting and effective technique for gathering bots from corporate networks, where updates are complicated and so can be delayed or just not performed. In other words, if a new bot is deployed using an EK, there is a higher chance that it is part of big network than one distributed by a more ‘classic’ malspam campaign.</p>



<p>Strangely, to this date, <strong>RM3</strong> has never been observed targeting financial institutions in North America. Perhaps there are just no malicious actors who want to be part of this particular mule ecosystem in that zone. Or perhaps all the malicious actors in this region are still making enough money from older strains or another banking malware.</p>



<p>Nowadays, there is a steady decline in banking malware in general, with most TAs joining the rising and explosive ransomware trend. It is more lucrative for bank malware gangs to stop their usual business and try to get some exclusive contracts with the ransom teams. The return on investment (ROI) of a ransom paid by a victim is significantly higher than for the whole classic money mule infrastructure. The cost and time required in money mule and inject operations are much more complex than just giving access to an affiliate and awaiting royalties.</p>



<h2 class="wp-block-heading">Large number of financial institutions targeted</h2>



<p>Fox-IT/NCC Group has identified more than 130 financial institution targeted by threat actor groups using this banking malware. As the table below shows, the scope and impact of these attacks is particularly concentrated on Oceania. This is also the only zone where loan and job websites are targeted. Of course, targeting job websites provides them with further opportunities to hire money mules more easily within their existing systems.</p>



<div class="wp-block-columns is-layout-flex wp-container-core-columns-layout-3 wp-block-columns-is-layout-flex">
<div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow" style="flex-basis:100%">
<div class="wp-block-columns alignwide is-layout-flex wp-container-core-columns-layout-2 wp-block-columns-is-layout-flex">
<div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow" style="flex-basis:100%">
<figure class="wp-block-table alignfull is-style-regular" id="primary"><table class="has-fixed-layout"><thead><tr><th>Country</th><th>Banks</th><th>Web Shops</th><th>Job Offers</th><th>Loans</th><th>Crypto Services</th></tr></thead><tbody><tr><td>UK</td><td>28</td><td>1</td><td>0</td><td>0</td><td>0</td></tr><tr><td>IT</td><td>17</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><td>AU/NZ</td><td>80~</td><td>0</td><td>2</td><td>2</td><td>6</td></tr></tbody></table></figure>
</div>
</div>
</div>
</div>



<h2 class="wp-block-heading">A short timeline of post-pandemic changes</h2>



<p>As we’ve already said, the pandemic has had an impact across the entire fraud landscape and forced many TAs (not just those using <strong>RM3</strong>) to drastically change their working methods. In some cases, they have shut down completely in one field and started doing something else. For <strong>RM3</strong> TAs, as for all of us, these are indeed interesting times.</p>



<h3 class="wp-block-heading">Q3 2019 &#8211; Q2 2020, Classic fraud era</h3>



<p>Before the pandemic, the tasks pushed by <strong>RM3</strong> were pretty standard when a bot was part of the infrastructure. The example below is a basic check for a legitimate corporate bot with an open access point for a threat actor to connect to and start to use for fraud.</p>



<pre class="wp-block-preformatted">GET_CREDS
GET_SYSINFO
LOAD_MODULE=mail.dll,UXA
LOAD_KEYLOG=*
LOAD_SOCKS=XXX.XXX.XXX.XXX:XXXX</pre>



<p>Otherwise, the banking malware was configured as an advanced infostealer, designed to steal data and intercept all keyboard interactions.</p>



<pre class="wp-block-preformatted">GET_CREDS
LOAD_MODULE=mail.dll,UXA
LOAD_KEYLOG=*</pre>



<h3 class="wp-block-heading">Q4 2020 &#8211; Now, Bot Harvesting Era</h3>



<p>Nowadays, bots are basically&nbsp; removed if they are coming from old infrastructures, if they are not part of an active campaign. It’s an easy way for them for removing researcher bots</p>



<pre class="wp-block-preformatted">DEL_CONFIG</pre>



<p>Otherwise, this is a classic information gathering system operation on the host and network. Which indicates TAs are following the ransomware path and declining their fraud legacy step by step.</p>



<pre class="wp-block-preformatted">GET_SYSINFO
RUN_CMD=net group "domain computers" /domain
RUN_CMD=net session</pre>



<h2 class="wp-block-heading">RM3 Configs &#8211; Invaluable threat intelligence data</h2>



<h3 class="wp-block-heading">RM3.AT</h3>



<p>Around the summer of 2019, when this banking malware was at its height, an infrastructure which was very different from the standard ones first emerged. It mostly used infostealers for distribution and pushed an interesting variant of the <strong>RM3</strong> loader.</p>



<p>Based on configs, similarities with the <strong>GoziAT</strong> TAs were seen. The crossovers were:</p>



<ul><li>both infrastructure are using the .at TLD</li><li>subdomains and domains are using the same naming convention</li><li>Server ID is also different from the default one (12)</li><li>Default nameservers config</li><li>First seen when <strong>GoziAT</strong> was curiously quiet</li></ul>



<p>An example loader.ini file for RM3.at is shown below:</p>



<pre class="wp-block-preformatted">LOADER.INI - RM3 .AT example
{
    "HOSTS": [
        "api.fiho.at",
        "t2.fiho.at"
    ],
    "NAMESERVERS": [
        "172.104.136.243",
        "8.8.4.4",
        "192.71.245.208",
        "51.15.98.97",
        "193.183.98.66",
        "8.8.8.8"
    ],
    "URI": "index.htm",
    "GROUP": "3000",
    "SERVER": "350",
    "SERVERKEY": "s2olwVg5cU7fWsec",
    "IDLEPERIOD": "10",
    "LOADPERIOD": "10",
    "HOSTKEEPTIMEOUT": "60",
    "DGATEMPLATE": "constitution.org/usdeclar.txt",
    "DGAZONES": [
        "com",
        "ru",
        "org"
    ],
    "DGATEMPHASH": "0x4eb7d2ca",
    "DGAPERIOD": "10"
}
</pre>



<p>As a reminder, the <strong>ISFB v2</strong> variant called <strong>GoziAT</strong> (which technically uses the <strong>RM2</strong> loader) uses the format shown below:</p>



<pre class="wp-block-preformatted">LOADER.INI - GoziAT/ISFB (RM2 Loader) 
{
    "HOSTS": [
        "api10.laptok.at/api1",
        "golang.feel500.at/api1",
        "go.in100k.at/api1"
    ],
    "GROUP": "1100",
    "SERVER": "730",
    "SERVERKEY": "F2oareSbPhCq2ch0",
    "IDLEPERIOD": "10",
    "LOADPERIOD": "20",
    "HOSTSHIFTTIMEOUT": "1"
}
</pre>



<p>But this <strong>RM3</strong> infrastructure disappeared just a few weeks later and has never been seen again. It is not known if the TAs were satisfied with the product and its results and it remains one of the unexplained curiosities of this banking malware</p>



<p>But, we can say this marked the return of <strong>GoziAT</strong>, which was back on track with intense campaigns.</p>



<p>Other domains related to this short lived <strong>RM3</strong> infrastructure were.</p>



<ul><li>api.fiho.at</li><li>y1.rexa.at</li><li>cde.frame303.at</li><li>api.frame303.at</li><li>u2.inmax.at</li><li>cdn5.inmax.at</li><li>go.maso.at</li><li>f1.maso.at</li></ul>



<h3 class="wp-block-heading">Standard routine for other infrastructures</h3>



<p>Meanwhile, a classic loader config will mostly need standard data like any other malware:</p>



<ul><li>C&amp;C domains (called hosts on the loader side)</li><li>Timeout values</li><li>Keys</li></ul>



<p>The example below shows a typical loader.ini file from a more ‘classic’ infrastructure. This one<ins> </ins>is from Germany, but similar configurations were seen in the UK1, Australia/New Zealand1 and Italian infrastructures:</p>



<pre class="wp-block-preformatted">LOADER.INI – DE 
{
    "HOSTS": "https://daycareforyou.xyz",
    "ADNSONLY": "0",
    "URI": "index.htm",
    "GROUP": "40000",
    "SERVER": "12",
    "SERVERKEY": "z2Ptfc0edLyV4Qxo",
    "IDLEPERIOD": "10",
    "LOADPERIOD": "10",
    "HOSTKEEPTIMEOUT": "60",
    "DGATEMPLATE": "constitution.org/usdeclar.txt",
    "DGAZONES": [
        "com",
        "ru",
        "org"
    ],
    "DGATEMPHASH": "0x4eb7d2ca",
    "DGAPERIOD": "10"
}
</pre>



<p>Updates to <strong>RM3 were observed to be ongoing</strong>, and more fields have appeared since the <strong><em>3009XX </em></strong>builds (e.g: 300912, 900932):</p>



<ul><li>Configuring the self-removing process</li><li>Setup the loader module as the persistent one</li><li>The Anti-CIS (langid field) is also making a comeback</li></ul>



<p>The example below shows a typical client.ini file as seen in build 3009xx from the UK2 and Australia/New Zealand 2 infrastructures:</p>



<pre class="wp-block-preformatted">CLIENT.INI 
{
    "HOSTS": "https://vilecorbeanca.xyz",
    "ADNSONLY": "0",
    "URI": "index.htm",
    "GROUP": "92020291",
    "SERVER": "12",
    "SERVERKEY": "kD9eVTdi6lgpH0Ml",
    "IDLEPERIOD": "10",
    "LOADPERIOD": "10",
    "HOSTKEEPTIMEOUT": "60",
    "NOSCRIPT": "0",
    "NODELETE": "0",
    "NOPERSISTLOADER": "0",
    "LANGID": "RU",
    "DGATEMPLATE": "constitution.org/usdeclar.txt",
    "DGATEMPHASH": "0x4eb7d2ca",
    "DGAZONES": [
        "com",
        "ru",
        "org"
    ],
    "DGAPERIOD": "10"
}
</pre>



<p>The client.ini file mainly stores elements that will be required for the explorer.dll module:</p>



<ul><li>Timeouts values</li><li>Maximum size allowed for <strong>RM3</strong> requests to the controllers</li><li>Video config</li><li>HTTP proxy activation</li></ul>



<pre class="wp-block-preformatted">CLIENT.INI - Default Format
{
    "CONTROLLER": [
        "",
    ],
    "ADNSONLY": "0",
    "IPRESOLVERS": "curlmyip.net",
    "SERVER": "12",
    "SERVERKEY": "",
    "IDLEPERIOD": "300",
    "TASKTIMEOUT": "300",
    "CONFIGTIMEOUT": "300",
    "INITIMEOUT": "300",
    "SENDTIMEOUT": "300",
    "GROUP": "",
    "HOSTKEEPTIMEOUT": "60",
    "HOSTSHIFTTIMEOUT": "60",
    "RUNCHECKTIMEOUT": "10",
    "REMOVECSP": "0",
    "LOGHTTP": "0",
    "CLEARCACHE": "1",
    "CACHECONTROL": [
        "no-cache,",
        "no-store,",
        "must-revalidate"
    ],
    "MAXPOSTLENGTH": "300000",
    "SETVIDEO": [
        "30,",
        "8,",
        "notipda"
    ],
    "HTTPCONNECTTIME": "480",
    "HTTPSENDTIME": "240",
    "HTTPRECEIVETIME": "240"
}
</pre>



<h2 class="wp-block-heading">What next?</h2>



<p>Active monitoring of current in-the-wild instances suggests that the <strong>RM3</strong> TAs are progressively switching to the ransomware path. That is, they have not pushed any updates on the fraud side of their operations for a number of months (by not pushing any injects), but they are still maintaining their C&amp;C infrastructure. All infrastructure has a cost and the fact they are maintaining their C&amp;C infrastructure without executing traditional fraud is a strong indication they are changing their strategy to another source of income.</p>



<p>The tasks which are being pushed (and old ones since May 2020) are triage steps for selecting bots which could be used for internal lateral movement. This pattern of behaviour is becoming more evident everyday in the latest ongoing campaigns, where everyone seems to be targeted and the inject configurations have been totally removed.</p>



<p>As a reminder, over the past two years banking malware gangs in general have been seen to follow this trend. This is due to the declining fraud ecosystem in general, but also due to the increased difficulty in finding inject developers with the skills to develop effective fakes which this decline has also prompted.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" decoding="async" width="800" height="571" data-attachment-id="3057" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/banking_modern_approach/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/Banking_Modern_Approach.png?fit=2800%2C2000&amp;ssl=1" data-orig-size="2800,2000" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Banking_Modern_Approach" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/Banking_Modern_Approach.png?fit=300%2C214&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/Banking_Modern_Approach.png?fit=800%2C571&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/Banking_Modern_Approach.png?resize=800%2C571&#038;ssl=1" alt="" class="wp-image-3057" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/Banking_Modern_Approach.png?resize=1024%2C731&amp;ssl=1 1024w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/Banking_Modern_Approach.png?resize=300%2C214&amp;ssl=1 300w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/Banking_Modern_Approach.png?resize=768%2C549&amp;ssl=1 768w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/Banking_Modern_Approach.png?resize=1536%2C1097&amp;ssl=1 1536w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/Banking_Modern_Approach.png?resize=2048%2C1463&amp;ssl=1 2048w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/Banking_Modern_Approach.png?resize=1200%2C857&amp;ssl=1 1200w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/Banking_Modern_Approach.png?resize=1100%2C786&amp;ssl=1 1100w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/Banking_Modern_Approach.png?w=1600&amp;ssl=1 1600w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/Banking_Modern_Approach.png?w=2400&amp;ssl=1 2400w" sizes="(max-width: 800px) 100vw, 800px" data-recalc-dims="1" /><figcaption><em>How banking TAs can migrate from fraud to ransom (or any other businesses)</em></figcaption></figure></div>



<p>We consider <strong>RM3</strong> to be the most advanced <strong>ISFB</strong> strain to date, and fraud tools can easily be switched into a malicious red team like strategy.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" decoding="async" width="800" height="519" data-attachment-id="3063" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/rm3_strategies/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Strategies.png?fit=972%2C631&amp;ssl=1" data-orig-size="972,631" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="RM3_Strategies" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Strategies.png?fit=300%2C195&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Strategies.png?fit=800%2C519&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Strategies.png?resize=800%2C519&#038;ssl=1" alt="" class="wp-image-3063" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Strategies.png?w=972&amp;ssl=1 972w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Strategies.png?resize=300%2C195&amp;ssl=1 300w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Strategies.png?resize=768%2C499&amp;ssl=1 768w" sizes="(max-width: 800px) 100vw, 800px" data-recalc-dims="1" /><figcaption><em>RM3 evolving to support two different use cases at the same time</em></figcaption></figure></div>



<h2 class="wp-block-heading">Why is RM3 the most advanced ISFB strain?</h2>



<p>As we said, we consider RM3 to be the most advanced ISFB variant we have seen. When we analyse the <strong>RM3</strong> payload, there is a huge gap between it and its predecessors. There are multiple differences:</p>



<ul><li>A new PE format called PX has been developed</li><li>The .bss section is slightly updated for <strong><em>storing RM3 static variables</em></strong></li><li>A new structure called<strong> WD</strong> based on the J1/J2/J3/JJ <strong>ISFB</strong> File Join system <em><strong>for storing files</strong></em></li></ul>



<div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" decoding="async" width="800" height="593" data-attachment-id="3066" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/isfb_rm3/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/isfb_rm3.png?fit=811%2C601&amp;ssl=1" data-orig-size="811,601" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="isfb_rm3" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/isfb_rm3.png?fit=300%2C222&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/isfb_rm3.png?fit=800%2C593&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/isfb_rm3.png?resize=800%2C593&#038;ssl=1" alt="" class="wp-image-3066" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/isfb_rm3.png?w=811&amp;ssl=1 811w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/isfb_rm3.png?resize=300%2C222&amp;ssl=1 300w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/isfb_rm3.png?resize=768%2C569&amp;ssl=1 768w" sizes="(max-width: 800px) 100vw, 800px" data-recalc-dims="1" /><figcaption><em>Architecture differences between ISFB v2 and RM3 payload<br>(main sections discussed below)</em></figcaption></figure></div>



<h2 class="wp-block-heading">PX Format</h2>



<p>As mentioned, <strong>RM3</strong> is designed to work with PX payloads (<strong>P</strong>ortable e<strong>X</strong>ecutable). This is an exotic file format created for, and only used with, this banking malware. The structure is not very different from the original PE format, with almost all sections, data directories and section tables remaining intact. Essentially, use of the new file format just requires malware to be re-crafted correctly in a new payload at the correct offset.</p>



<div class="wp-block-image"><figure class="aligncenter size-full"><img loading="lazy" decoding="async" width="800" height="178" data-attachment-id="3070" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/px_header/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/PX_Header.png?fit=1442%2C320&amp;ssl=1" data-orig-size="1442,320" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="PX_Header" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/PX_Header.png?fit=300%2C67&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/PX_Header.png?fit=800%2C177&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/PX_Header.png?resize=800%2C178&#038;ssl=1" alt="" class="wp-image-3070" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/PX_Header.png?w=1442&amp;ssl=1 1442w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/PX_Header.png?resize=300%2C67&amp;ssl=1 300w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/PX_Header.png?resize=1024%2C227&amp;ssl=1 1024w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/PX_Header.png?resize=768%2C170&amp;ssl=1 768w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/PX_Header.png?resize=1200%2C266&amp;ssl=1 1200w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/PX_Header.png?resize=1440%2C320&amp;ssl=1 1440w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/PX_Header.png?resize=1100%2C244&amp;ssl=1 1100w" sizes="(max-width: 800px) 100vw, 800px" data-recalc-dims="1" /><figcaption><em>PX Header</em></figcaption></figure></div>



<h2 class="wp-block-heading">BSS section</h2>



<p>The bss section (<strong>B</strong>lock <strong>S</strong>tarting <strong>S</strong>ymbol) is a critical data segment used by all strains of <strong>ISFB</strong> for storing uninitiated static local variables. These variables are encrypted and used for different interactions depending on the module in use.</p>



<p>In a compiled payload, this section is usually named &#8220;.bss0&#8221;. But evidence from a source code leak shows that this is originally named &#8220;.bss&#8221; in the source code. These comments also make it clear that this module is encrypted.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><a href="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_BSS.png?ssl=1"><img loading="lazy" decoding="async" width="800" height="381" data-attachment-id="3101" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/rm3_bss/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_BSS.png?fit=910%2C433&amp;ssl=1" data-orig-size="910,433" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="RM3_BSS" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_BSS.png?fit=300%2C143&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_BSS.png?fit=800%2C381&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_BSS.png?resize=800%2C381&#038;ssl=1" alt="" class="wp-image-3101" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_BSS.png?w=910&amp;ssl=1 910w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_BSS.png?resize=300%2C143&amp;ssl=1 300w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_BSS.png?resize=768%2C365&amp;ssl=1 768w" sizes="(max-width: 800px) 100vw, 800px" data-recalc-dims="1" /></a><figcaption><em>The encrypted .bss section </em></figcaption></figure></div>



<p>This is illustrated by the source code comments shown below:</p>



<pre class="wp-block-preformatted">// Original section name that will be created within a file
#define CS_SECTION_NAME ".bss0"
// The section will be renamed after the encryption completes.
// This is because we cannot use reserved section names aka ".rdata" or ".bss" during compile time.
#define CS_NEW_SECTION_NAME ".bss"</pre>



<p>When working with <strong>ISFB</strong>, it is common to see the same mechanism or routine across multiple compiled builds or variants. However, it is still necessary to analyse them all in detail because slight adjustments are frequently introduced. Understanding these minor changes can help with troubleshooting and explain why scripts don&#8217;t work. The decryption routine in the bss section is a perfect example of this; it is almost identical to <strong>ISFB v2</strong> variants, but the <strong>RM3</strong> developers decided to tweak it just slightly by creating an XOR key in a different way – adding a <strong><em><a href="https://docs.microsoft.com/en-us/windows/win32/api/winnt/ns-winnt-image_file_header" data-type="URL" data-id="https://docs.microsoft.com/en-us/windows/win32/api/winnt/ns-winnt-image_file_header">FILE_HEADER.TimeDateStamp</a></em></strong> with the <strong><em>gs_Cookie </em></strong>(this information based on the <strong>ISFB</strong> leak).</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" decoding="async" width="799" height="245" data-attachment-id="3072" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/bss_decrypted/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/bss_decrypted.png?fit=799%2C245&amp;ssl=1" data-orig-size="799,245" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="bss_decrypted" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/bss_decrypted.png?fit=300%2C92&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/bss_decrypted.png?fit=799%2C245&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/bss_decrypted.png?resize=799%2C245&#038;ssl=1" alt="" class="wp-image-3072" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/bss_decrypted.png?w=799&amp;ssl=1 799w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/bss_decrypted.png?resize=300%2C92&amp;ssl=1 300w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/bss_decrypted.png?resize=768%2C235&amp;ssl=1 768w" sizes="(max-width: 799px) 100vw, 799px" data-recalc-dims="1" /><figcaption><em>Decrypted strings from the .bss section being parsed by IDA</em></figcaption></figure></div>



<p>Occasionally, it is possible to see a debugged and compiled version of <strong>RM3</strong> in the wild. It is unknown if this behaviour is intended for some reason or simply a mistake by TA teams, but it is a gold mine for understanding more about the underlying code.</p>



<h2 class="wp-block-heading">WD Struct</h2>



<p><strong>ISFB</strong> has its own way of storing and using embedded files. It uses a homemade structure that seems to change its name whenever there is a new strain or a major <strong>ISFB</strong> update:</p>



<ul><li>FJ or J1 &#8211; Old ISFB era</li><li>J2 &#8211; Dreambot</li><li>J3 &#8211; ISFB v3 (Only seen in Japan)</li><li>JJ &#8211; ISFB v2 (v2.14+ &#8211; now)</li><li>WD &#8211; RM3 / Saigon</li></ul>



<p>To get a better understanding of the latest structure in use, it is worth taking a quick look back at the active strains of <strong>ISFB v2</strong> still known to use the JJ system.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" decoding="async" width="800" height="89" data-attachment-id="3073" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/jj_struct/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/JJ_struct.png?fit=828%2C92&amp;ssl=1" data-orig-size="828,92" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="JJ_struct" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/JJ_struct.png?fit=300%2C33&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/JJ_struct.png?fit=800%2C89&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/JJ_struct.png?resize=800%2C89&#038;ssl=1" alt="" class="wp-image-3073" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/JJ_struct.png?w=828&amp;ssl=1 828w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/JJ_struct.png?resize=300%2C33&amp;ssl=1 300w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/JJ_struct.png?resize=768%2C85&amp;ssl=1 768w" sizes="(max-width: 800px) 100vw, 800px" data-recalc-dims="1" /></figure></div>



<p>The structure is pretty rudimentary and can be summarised like this:</p>



<pre class="wp-block-preformatted">struct JJ_Struct {
 DWORD xor_cookie;
 DWORD crc32;
 DWORD size;
 DWORD addr;
} JJ;</pre>



<p>With <strong>RM3</strong>, they decided to slightly rework the join file philosophy by creating a new structure called <strong>WD</strong>. This is basically just a rebranded concept; it just adds the <strong>JJ</strong> structure (seen above) and stores it as a pointer array.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" decoding="async" width="800" height="124" data-attachment-id="3075" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/wd_struct/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/WD_Struct.png?fit=842%2C130&amp;ssl=1" data-orig-size="842,130" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="WD_Struct" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/WD_Struct.png?fit=300%2C46&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/WD_Struct.png?fit=800%2C124&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/WD_Struct.png?resize=800%2C124&#038;ssl=1" alt="" class="wp-image-3075" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/WD_Struct.png?w=842&amp;ssl=1 842w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/WD_Struct.png?resize=300%2C46&amp;ssl=1 300w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/WD_Struct.png?resize=768%2C119&amp;ssl=1 768w" sizes="(max-width: 800px) 100vw, 800px" data-recalc-dims="1" /></figure></div>



<p>The structure itself is really simple:</p>



<pre class="wp-block-preformatted">struct WD_Struct {
  DWORD size;
&nbsp; WORD magic;
&nbsp; WORD flag;
&nbsp; JJ_Struct *jj;
} WD;</pre>



<p>In allRM3 builds, these structures simply direct the malware to grab an average of at least 4 files†:</p>



<ul><li>A PX loader</li><li>An RSA pubkey</li><li>An RM3 config</li><li>A wordlist that will be mainly used for create subkeys in the registry</li></ul>



<p>† The amount of files is dependent on the loader stage or <strong>RM3</strong> modules used. It is also based on the <strong>ISFB</strong> variant, as another file could be present which stores the langid value (which is basically the anti-cis feature for this banking malware).</p>



<h2 class="wp-block-heading">Architecture</h2>



<p>Every major ISFB variant has something that makes it unique in some way. For example, the notorious Dreambot was designed to work as a standalone payload; the whole loader stage walk-through was removed and bots were directly pointed at the correct controllers. This choice was mainly explained by the fact that this strain was designed to work as malware as a service. It is fairly standard right now to see malware developers developing specific features for TAs &#8211; if they are prepared to pay for them. In these agreements, TAs can be guaranteed some kind of exclusivity with a variant or feature. However, this business model does also increase the risk of misunderstanding and overlap in term of assigning ownership and responsibility. This is one of the reasons it is harder to get a clear picture of the activities happening between malware developers &amp; TAs nowadays.</p>



<p>But to get back to the variant we are discussing here; <strong>RM3</strong> pushed the <strong>ISFB</strong> modular plugin system to its maximum potential by introducing a range of elements into new modules that had never been seen before. These new modules included:</p>



<ul><li>bl.dll</li><li>explorer.dll</li><li>rt.dll</li><li>netwrk.dll</li></ul>



<p>These modules are linked together to recreate a modded client32.bin/client64.bin (modded from the client.bin seen in <strong>ISFB v2</strong>). This new architecture is much more complicated to debug or disassemble. In the end, however, we can split this malware into 4 main branches:</p>



<ul><li>A modded client32.bin/client64.bin</li><li>A browser module designed to setup hooks and an SSL proxy (used for POST HTTP/HTTPS interception)</li><li>A remote shell (probably designed for initial assessments before starting lateral attacks)</li><li>A fraud arsenal toolkit (hidden VNC, SOCKs proxy, etc&#8230;)</li></ul>



<div class="wp-block-image"><figure class="aligncenter size-large"><a href="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Architecture.png?ssl=1"><img loading="lazy" decoding="async" width="800" height="743" data-attachment-id="3078" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/rm3_architecture/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Architecture.png?fit=1192%2C1107&amp;ssl=1" data-orig-size="1192,1107" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="RM3_Architecture" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Architecture.png?fit=300%2C279&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Architecture.png?fit=800%2C743&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Architecture.png?resize=800%2C743&#038;ssl=1" alt="" class="wp-image-3078" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Architecture.png?resize=1024%2C951&amp;ssl=1 1024w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Architecture.png?resize=300%2C279&amp;ssl=1 300w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Architecture.png?resize=768%2C713&amp;ssl=1 768w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Architecture.png?resize=1100%2C1022&amp;ssl=1 1100w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Architecture.png?w=1192&amp;ssl=1 1192w" sizes="(max-width: 800px) 100vw, 800px" data-recalc-dims="1" /></a><figcaption><em>RM3 Architecture</em></figcaption></figure></div>



<h2 class="wp-block-heading">RM3 Loader &#8211;<br>Major ISFB update? Or just a refactored code?</h2>



<p>The loader is a minimalist plugin that contains only the required functions for doing three main tasks:</p>



<ul><li>Contacting a loader C&amp;C (which is called host), downloading critical <strong>RM3</strong> modules and storing them into the registry (<em>bl.dll, explorer.dll, rt.dll, netwrk.dll</em>)</li><li>Setting up persistence†</li><li>Rebooting everything and making sure it has removed itself†.</li></ul>



<div class="wp-block-image"><figure class="aligncenter size-large"><a href="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Loader_Startup.png?ssl=1"><img loading="lazy" decoding="async" width="800" height="288" data-attachment-id="3096" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/rm3_loader_startup/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Loader_Startup.png?fit=1476%2C532&amp;ssl=1" data-orig-size="1476,532" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="RM3_Loader_Startup" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Loader_Startup.png?fit=300%2C108&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Loader_Startup.png?fit=800%2C288&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Loader_Startup.png?resize=800%2C288&#038;ssl=1" alt="" class="wp-image-3096" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Loader_Startup.png?resize=1024%2C369&amp;ssl=1 1024w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Loader_Startup.png?resize=300%2C108&amp;ssl=1 300w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Loader_Startup.png?resize=768%2C277&amp;ssl=1 768w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Loader_Startup.png?resize=1200%2C433&amp;ssl=1 1200w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Loader_Startup.png?resize=1100%2C396&amp;ssl=1 1100w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Loader_Startup.png?w=1476&amp;ssl=1 1476w" sizes="(max-width: 800px) 100vw, 800px" data-recalc-dims="1" /></a><figcaption><em>An overview of the second stage loader</em></figcaption></figure></div>



<p>These functions are summarised in the following schematic.‡</p>



<p>† In the <strong>3009XX </strong>build above, a TA can decide to setup the loader as persistent itself, or remove the payload.</p>



<p>‡ Of course, the loader has more details than could be mentioned here, but the schematic shows the main concepts for a basic understanding.</p>



<h2 class="wp-block-heading">RM3 Network beacons &#8211; Hiding the beast behind simple URIs</h2>



<p>C&amp;C beacon requests have been adjusted from the standard <strong>ISFB v2</strong> ones, by simplifying the process with just two default URI. These URIs are dynamic fields that can be configured from the loader and client config. This is something that older strains are starting to follow since build 250172.</p>



<p>When it switches to the controller side, <strong>RM3</strong> saves HTTPS POST requests performed by the users. These are then used to create fake but legitimate looking paths.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><a href="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Dynamic_URI.png?ssl=1"><img loading="lazy" decoding="async" width="800" height="94" data-attachment-id="3103" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/rm3_dynamic_uri/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Dynamic_URI.png?fit=945%2C111&amp;ssl=1" data-orig-size="945,111" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="RM3_Dynamic_URI" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Dynamic_URI.png?fit=300%2C35&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Dynamic_URI.png?fit=800%2C94&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Dynamic_URI.png?resize=800%2C94&#038;ssl=1" alt="" class="wp-image-3103" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Dynamic_URI.png?w=945&amp;ssl=1 945w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Dynamic_URI.png?resize=300%2C35&amp;ssl=1 300w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Dynamic_URI.png?resize=768%2C90&amp;ssl=1 768w" sizes="(max-width: 800px) 100vw, 800px" data-recalc-dims="1" /></a><figcaption><em>Changing RM3 URI path dynamically</em></figcaption></figure></div>



<p>This ingenious trick makes <strong>RM3</strong> really hard to catch behind the telemetry generated by the bot. To make short, whenever the user is browsing websites performing those specific requests, the malware is mimicking them by replacing the domain with the controller one.</p>



<pre class="wp-block-preformatted">https://&lt;controler_domain&gt;.tld/index.html                &lt;- default
https://&lt;controler_domain&gt;.tld/search/wp-content/app     &lt;- timer cycle #1
https://&lt;controler_domain&gt;.tld/search/wp-content/app
https://&lt;controler_domain&gt;.tld/search/wp-content/app
https://&lt;controler_domain&gt;.tld/search/wp-content/app
https://&lt;controler_domain&gt;.tld/admin/credentials/home    &lt;- timer cycle #2
https://&lt;controler_domain&gt;.tld/admin/credentials/home
https://&lt;controler_domain&gt;.tld/admin/credentials/home
https://&lt;controler_domain&gt;.tld/admin/credentials/home
https://&lt;controler_domain&gt;.tld/operating/static/template/index.php  &lt;- timer cycle #3
https://&lt;controler_domain&gt;.tld/operating/static/template/index.php
https://&lt;controler_domain&gt;.tld/operating/static/template/index.php
https://&lt;controler_domain&gt;.tld/operating/static/template/index.php</pre>



<p>If that wasn’t enough, the usual base64 beacons are now hidden as a data form and send by means of POST requests. When decrypted, these requests reveal this typical network communication.</p>



<pre class="wp-block-preformatted">random=rdm&amp;type=1&amp;soft=3&amp;version=300960&amp;user=17fe7d78280730e52b545792f07d61cb&amp;group=21031&amp;id=00000024&amp;arc=0&amp;crc=44c9058a&amp;size=2&amp;uptime=219&amp;sysid=15ddce20c9691c1ff5103a921e59d7a1&amp;os=10.0_0_0_x64 </pre>



<p>The fields can be explained in as follows:</p>



<div class="wp-block-columns is-layout-flex wp-container-core-columns-layout-4 wp-block-columns-is-layout-flex">
<div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow" style="flex-basis:100%">
<figure id="primary" class="wp-block-table alignfull is-style-regular"><table><thead><tr><th> <strong>Field</strong> </th><th> <strong>Meaning</strong> </th></tr></thead><tbody><tr><td>random</td><td>A mandatory randomised value</td></tr><tr><td>type</td><td>Data format</td></tr><tr><td>soft</td><td>Network communication method</td></tr><tr><td>version</td><td>Build of the RM3 banking malware</td></tr><tr><td>user</td><td>User seed</td></tr><tr><td>group</td><td>Campaign ID</td></tr><tr><td>id</td><td>RM3 Data type</td></tr><tr><td>arc</td><td>Module with specific architecture (0 =&nbsp; i386 &#8211; 1= 86_x64)</td></tr><tr><td>size</td><td>Stolen data size</td></tr><tr><td>uptime</td><td>Bot uptime</td></tr><tr><td>sysid</td><td>Machine seed</td></tr><tr><td>os</td><td>Windows version</td></tr></tbody></table></figure>
</div>
</div>



<h3 class="wp-block-heading">Soft &#8211; A curious ISFB Field</h3>



<div class="wp-block-columns is-layout-flex wp-container-core-columns-layout-5 wp-block-columns-is-layout-flex">
<div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow" style="flex-basis:100%">
<figure id="primary" class="wp-block-table alignfull is-style-regular"><table><thead><tr><th> <strong>Value</strong> </th><th> <strong>Stage C&amp;C</strong> </th><th> <strong>Network Communication</strong> </th><th> <strong>Response Format<br>(&lt; Build 300960)</strong> </th><th> <strong>Response Format<br>(Build 300960)</strong> </th></tr></thead><tbody><tr><td>3</td><td>Host (Loader)</td><td>WinAPI</td><td>Base64(RSA + Serpent)</td><td>Base64(RSA + AES)</td></tr><tr><td>2</td><td>Host (Loader)</td><td>COM</td><td>Base64(RSA + Serpent)</td><td>Base64(RSA + AES)</td></tr><tr><td>1</td><td>Controller</td><td>WinAPI/COM</td><td>RSA + Serpent</td><td>RSA + AES</td></tr></tbody></table></figure>
</div>
</div>



<h3 class="wp-block-heading">ID &#8211; A field being updated RM3</h3>



<p>Thanks to the source code leak, identifying <a href="https://github.com/gbrindisi/malware/blob/master/windows/gozi-isfb/dname.txt">the data type is not that complicated</a> and can be determined from the field &#8220;id&#8221;</p>



<pre class="wp-block-preformatted">Бот отправляет на сервер файлы следующего типа и формата (тип данных задаётся параметром type в POST-запросе):
SEND_ID_UNKNOWN	0	- неизвестно, используется только для тестирования	
SEND_ID_FORM	1	- данные HTML-форм. ASCII-заголовок + форма бинарном виде, как есть
SEND_ID_FILE	2	- любой файл, так шлются найденные по маске файлы
SEND_ID_AUTH	3	- данные IE Basic Authentication, ASCII-заголовок + бинарные данные
SEND_ID_CERTS	4	- сертификаты. Файлы PFX упакованые в CAB или ZIP.
SEND_ID_COOKIES	5	- куки и SOL-файлы. Шлются со структурой каталогов. Упакованы в CAB или ZIP
SEND_ID_SYSINFO	6	- информация о системе. UTF8(16)-файл, упакованый в CAB или ZIP
SEND_ID_SCRSHOT	7	- скриншот. GIF-файл.
SEND_ID_LOG	8	- внутренний лог бота. TXT-файл.
SEND_ID_FTP	9	- инфа с грабера FTP. TXT-файл.
SEND_ID_IM	10	- инфа с грабера IM. TXT-файл.
SEND_ID_KEYLOG	11	- лог клавиатуры. TXT-файл.
SEND_ID_PAGE_REP 12	- нотификация о полной подмене страницы TXT-файл.
SEND_ID_GRAB	13	- сграбленый фрагмент контента. ASCII заголовок + контент, как он есть</pre>



<p>Over time, they have created more fields:</p>



<div class="wp-block-columns is-layout-flex wp-container-core-columns-layout-6 wp-block-columns-is-layout-flex">
<div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow" style="flex-basis:100%">
<figure id="primary" class="wp-block-table alignfull is-style-regular"><table><thead><tr><th>New Command</th><th>ID</th><th>Description</th></tr></thead><tbody><tr><td>SEND_ID_CMD</td><td>19</td><td>Results from the CMD_RUN command</td></tr><tr><td>SEND_ID_???</td><td>20</td><td>&#8211;</td></tr><tr><td>SEND_ID_CRASH</td><td>21</td><td>Crash dump</td></tr><tr><td>SEND_ID_HTTP</td><td>22</td><td>Send HTTP Logs</td></tr><tr><td>SEND_ID_ACC</td><td>23</td><td>Send credentials</td></tr><tr><td>SEND_ID_ANTIVIRUS</td><td>24</td><td>Send Antivirus info</td></tr></tbody></table></figure>
</div>
</div>



<h2 class="wp-block-heading">Module list</h2>



<p>Analysis indicates that any <strong>RM3</strong> instance would have to include at least the following modules:</p>



<div class="wp-block-columns is-layout-flex wp-container-core-columns-layout-7 wp-block-columns-is-layout-flex">
<div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow" style="flex-basis:100%">
<figure id="primary" class="wp-block-table alignfull is-style-regular"><table><thead><tr><th>CRC</th><th>Module Name</th><th>PE Format</th><th>Stage</th><th>Description</th></tr></thead><tbody><tr><td>&#8211;</td><td>&#8211;</td><td>MZ</td><td>&#8211;</td><td>1st stage RM3 loader</td></tr><tr><td>0xc535d8bf</td><td>loader.dll</td><td>PX</td><td>&#8211;</td><td>2nd stage RM3 loader</td></tr><tr><td>&#8211;</td><td>&#8211;</td><td>MZ</td><td>&#8211;</td><td>RM3 Startup module hidden in the shellcode</td></tr><tr><td>0x8576b0d0</td><td>bl.dll</td><td>PX</td><td>Host</td><td>RM3 Background Loader</td></tr><tr><td>0x224c6c42</td><td>explorer.dll</td><td>PX</td><td>Host</td><td>RM3 Mastermind</td></tr><tr><td>0xd6306e08</td><td>rt.dll</td><td>PX</td><td>Host</td><td>RM3 Runtime DLL &#8211; RM3 WinAPI/COM Module</td></tr><tr><td>0x45a0fcd0</td><td>netwrk.dll</td><td>PX</td><td>Host</td><td>RM3 Network API</td></tr><tr><td>0xe6954637</td><td>browser.dll</td><td>PX</td><td>Controller</td><td>Browser Grabber/HTTPS Interception</td></tr><tr><td>0x5f92dac2</td><td>iexplore.dll</td><td>PX</td><td>Controller</td><td>Internet explorer Hooking module</td></tr><tr><td>0x309d98ff</td><td>firefox.dll</td><td>PX</td><td>Controller</td><td>Firefox Hooking module</td></tr><tr><td>0x309d98ff</td><td>microsoftedgecp.dll</td><td>PX</td><td>Controller</td><td>Microsoft Edge Hooking module (old one)</td></tr><tr><td>0x9eff4536</td><td>chrome.dll</td><td>PX</td><td>Controller</td><td>Google chrome Hooking module</td></tr><tr><td>0x7b41e687</td><td>msedge.dll</td><td>PX</td><td>Controller</td><td>Microsoft Edge Hooking module (Chromium one)</td></tr><tr><td>0x27ed1635</td><td>keylog.dll</td><td>PX</td><td>Controller</td><td>Keylogging module</td></tr><tr><td>0x6bb59728</td><td>mail.dll</td><td>PX</td><td>Controller</td><td>Mail Grabber module</td></tr><tr><td>0x1c4f452a</td><td>vnc.dll</td><td>PX</td><td>Controller</td><td>VNC module</td></tr><tr><td>0x970a7584</td><td>sqlite.dll</td><td>PX</td><td>Controller</td><td>SQLITE Library required for some module</td></tr><tr><td>0xfe9c154b</td><td>ftp.dll</td><td>PX</td><td>Controller</td><td>FTP module</td></tr><tr><td>0xd9839650</td><td>socks.dll</td><td>PX</td><td>Controller</td><td>Socks module</td></tr><tr><td>0x1f8fde6b</td><td>cmdshell.dll</td><td>PX</td><td>Controller</td><td>Persistent remote shell module</td></tr></tbody></table></figure>
</div>
</div>



<p>Additionally, more configuration files ( .ini ) are used to store all the critical information implemented in <strong>RM3</strong>. Four different files are currently known:</p>



<div class="wp-block-columns is-layout-flex wp-container-core-columns-layout-8 wp-block-columns-is-layout-flex">
<div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow" style="flex-basis:100%">
<figure id="primary" class="wp-block-table alignfull is-style-regular"><table><thead><tr><th> <strong>CRC</strong> </th><th> <strong>Name</strong> </th></tr></thead><tbody><tr><td>0x8fb1dde1</td><td>loader.ini</td></tr><tr><td>0x68c8691c</td><td>explorer.ini</td></tr><tr><td>0xd722afcb</td><td>client.ini†</td></tr><tr><td>0x68c8691c</td><td>vnc.ini</td></tr></tbody></table></figure>
</div>
</div>



<p><em>† CLIENT.INI is never intended to be seen in an </em><strong><em>RM3</em></strong><em> binary, as it is intended to be received by the loader C&amp;C (aka “the host”, based on its field name on configs). This is completely different from older </em><strong><em>ISFB</em></strong><em> strains, where the client.ini is stored in the client32.bin/client64.bin. So it means, if the loader c&amp;c is offline, there is no option to get this crucial file</em></p>



<p><em>Moving this file is a clever move by the </em><strong><em>RM3</em></strong><em> malware developers and the TAs using it as they have reduced the risk of having researcher bots in their ecosystem.</em></p>



<h2 class="wp-block-heading">RM3 dependency madness</h2>



<p>With client32.bin (from the more standard <strong>ISFB v2 form</strong>) technically not present itself but instead implemented as an accumulation of modules injected into a process, <strong>RM3</strong> is drastically different from its predecessors. It has totally changed its micro-ecosystem by forcing all of its modules to interact with each other (except bl.dll) and as shown below.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><a href="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Dependancies.png?ssl=1"><img loading="lazy" decoding="async" width="800" height="449" data-attachment-id="3099" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/rm3_dependancies/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Dependancies.png?fit=1231%2C691&amp;ssl=1" data-orig-size="1231,691" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="RM3_Dependancies" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Dependancies.png?fit=300%2C168&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Dependancies.png?fit=800%2C449&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Dependancies.png?resize=800%2C449&#038;ssl=1" alt="" class="wp-image-3099" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Dependancies.png?resize=1024%2C575&amp;ssl=1 1024w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Dependancies.png?resize=300%2C168&amp;ssl=1 300w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Dependancies.png?resize=768%2C431&amp;ssl=1 768w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Dependancies.png?resize=1200%2C674&amp;ssl=1 1200w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Dependancies.png?resize=1100%2C617&amp;ssl=1 1100w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Dependancies.png?w=1231&amp;ssl=1 1231w" sizes="(max-width: 800px) 100vw, 800px" data-recalc-dims="1" /></a><figcaption><em>All interactions between RM3 modules</em></figcaption></figure></div>



<p>These changes also slow down any in-depth analysis, as they make it way harder to analyse as a standalone module.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><a href="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Ordinal_Calls.png?ssl=1"><img loading="lazy" decoding="async" width="800" height="297" data-attachment-id="3105" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/rm3_ordinal_calls/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Ordinal_Calls.png?fit=880%2C327&amp;ssl=1" data-orig-size="880,327" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="RM3_Ordinal_Calls" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Ordinal_Calls.png?fit=300%2C111&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Ordinal_Calls.png?fit=800%2C297&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Ordinal_Calls.png?resize=800%2C297&#038;ssl=1" alt="" class="wp-image-3105" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Ordinal_Calls.png?w=880&amp;ssl=1 880w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Ordinal_Calls.png?resize=300%2C111&amp;ssl=1 300w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Ordinal_Calls.png?resize=768%2C285&amp;ssl=1 768w" sizes="(max-width: 800px) 100vw, 800px" data-recalc-dims="1" /></a><figcaption><em>External calls from other RM3 modules (8576b0d0 and e695437)</em></figcaption></figure></div>



<h2 class="wp-block-heading">RM3 Module 101</h2>



<p>Thanks to the startup module launched by start.ps1 in the registry, a hidden shell worker is plugged into explorer.exe (not the explorer.dll module) that initialises a hooking instance for specific WinAPI/COM calls. This allows the banking malware to inject all its components into every child process coming from that Windows process. This strategy permits <strong>RM3</strong> to have total control of all user interactions.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><a href="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Hook_Worker.png?ssl=1"><img loading="lazy" decoding="async" width="800" height="347" data-attachment-id="3202" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/rm3_hook_worker/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Hook_Worker.png?fit=901%2C391&amp;ssl=1" data-orig-size="901,391" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="RM3_Hook_Worker" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Hook_Worker.png?fit=300%2C130&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Hook_Worker.png?fit=800%2C347&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Hook_Worker.png?resize=800%2C347&#038;ssl=1" alt="" class="wp-image-3202" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Hook_Worker.png?w=901&amp;ssl=1 901w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Hook_Worker.png?resize=300%2C130&amp;ssl=1 300w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Hook_Worker.png?resize=768%2C333&amp;ssl=1 768w" sizes="(max-width: 800px) 100vw, 800px" data-recalc-dims="1" /></a></figure></div>



<p><em>(*) PoV = Point of View</em></p>



<p>Looking at DllMain, the code hasn&#8217;t changed that much in the years since the <strong>ISFB</strong> leak.</p>



<pre class="wp-block-code"><code>BOOL APIENTRY DllMain(HMODULE hModule, DWORD ul_reason_for_call, LPVOID lpReserved) {
  BOOL Ret = TRUE;
  WINERROR Status = NO_ERROR;

  Ret = 1;
  if ( ul_reason_for_call ) {
    if ( ul_reason_for_call == 1 &amp;&amp; _InterlockedIncrement(&amp;g_AttachCount) == 1 ) {
      Status = ModuleStartup(hModule, lpReserved); // &lt;- Main call 
      if ( Status ) {
        SetLastError(Status);
        Ret = 0;
      }
    }
  }
  else if ( !_InterlockedExchangeAdd(&amp;g_AttachCount, 0xFFFFFFFF) ) {
    ModuleCleanup();
  }
  return Ret;
}
</code></pre>



<p>It is only when we get to the <strong><em>ModuleStartup </em></strong>call that things start to become interesting. This code has been refactored and adjusted to the <strong>RM3</strong> philosophy:</p>



<pre class="wp-block-code"><code>static WINERROR ModuleStartup(HMODULE hModule) {
    WINERROR Status; 
    RM3_Struct RM3;

    // Need mandatory RM3 Struct Variable, that contains everything
    // By calling an export function from BL.DLL
	RM3 = bl!GetRM3Struct();  

    // Decrypting the .bss section
    // CsDecryptSection is the supposed name based on ISFB leak
	Status = bl!CsDecryptSection(hModule, 0);
  
    if ( (gs_Cookie ^ RM3-&gt;dCrc32ExeName) == PROCESSNAMEHASH )
    	Status = Startup() 
	
    return(Status);
}</code></pre>



<p>This adjustment is pretty similar in all modules and can be summarised as three main steps:</p>



<ul><li>Requesting from bl.dll a critical global structure (called <strong><em>RM3_struct </em></strong>for the purpose of this article) which has the minimal requirements for running the injected code smoothly. The structure itself changes based on which module it is. For example, bl.dll mostly uses it for recreating values that seem to be part of the PEB (hypothesis); explorer.dll uses this structure for storing timeout values and browsers.dll uses it for <strong>RM3</strong> injects configurations.</li><li>Decrypting the .bss section.</li><li>Entering into the checking routine by using an ingenious mechanism:<ul><li>The filename of the child process is converted into a JamCRC32 hash and compared with the one stored in the startup function. If it matches, the module starts its worker routine, otherwise it quits.</li></ul></li></ul>



<p>These are a just a few particular cases, but the philosophy of the <strong>RM3</strong> Module startup is well represented here. It is a simple and clever move for monitoring user interactions, because it has control over everything coming from explorer.exe.</p>



<h2 class="wp-block-heading">bl.dll &#8211; The backbone of RM3</h2>



<p>The background loader is almost nothing and everything at the same time. It&#8217;s the root of the whole <strong>RM3</strong> infrastructure when it&#8217;s fully installed and configured by the initial loader. Its focus is mainly to initialise RM3_Struct and permits and provides a fundamental <strong>RM3</strong> API to all other modules:</p>



<pre class="wp-block-preformatted">Ordinal    | Goal 
==========================================
856b0d0_1  | bl!GetBuild
856b0d0_2  | bl!GetRM3Struct
856b0d0_3  | bl!WaitForSingleObject
856b0d0_4  | bl!GenerateRNG
856b0d0_5  | bl!GenerateGUIDName
856b0d0_6  | bl!XorshiftStar
856b0d0_7  | bl!GenerateFieldName
856b0d0_8  | bl!GenerateCRC32Checksum
856b0d0_9  | bl!WaitForMultipleObjects
856b0d0_10 | bl!HeapAlloc
856b0d0_11 | bl!HeapFree
856b0d0_12 | bl!HeapReAlloc
856b0d0_13 | bl!???
856b0d0_14 | bl!Aplib
856b0d0_15 | bl!ReadSubKey 
856b0d0_16 | bl!WriteSubKey 
856b0d0_17 | bl!CreateProcessA
856b0d0_18 | bl!CreateProcessW
856b0d0_19 | bl!GetRM3MainSubkey
856b0d0_20 | bl!LoadModule
856b0d0_21 | bl!???
856b0d0_22 | bl!OpenProcess 
856b0d0_23 | bl!InjectDLL
856b0d0_24 | bl!ReturnInstructionPointer
856b0d0_25 | bl!GetPRNGValue
856b0d0_26 | bl!CheckRSA
856b0d0_27 | bl!Serpent
856b0d0_28 | bl!SearchConfigFile
856b0d0_29 | bl!???
856b0d0_30 | bl!ResolveFunction01
856b0d0_31 | bl!GetFunctionByIndex
856b0d0_32 | bl!HookFunction
856b0d0_33 | bl!???
856b0d0_34 | bl!ResolveFunction02
856b0d0_35 | bl!???
856b0d0_36 | bl!GetExplorerPID
856b0d0_37 | bl!PsSupSetWow64Redirection
856b0d0_40 | bl!MainRWFile
856b0d0_42 | bl!PipeSendCommand
856b0d0_43 | bl!PipeMainRWFile
856b0d0_44 | bl!WriteFile 
856b0d0_45 | bl!ReadFile
856b0d0_50 | bl!RebootBlModule
856b0d0_51 | bl!LdrFindEntryForAddress
856b0d0_52 | bl!???
856b0d0_55 | bl!SetEAXToZero
856b0d0_56 | bl!LdrRegisterDllNotification
856b0d0_57 | bl!LdrUnegisterDllNotification
856b0d0_59 | bl!FillGuidName
856b0d0_60 | bl!GenerateRandomSubkeyName
856b0d0_61 | bl!InjectDLLToSpecificPID
856b0d0_62 | bl!???
856b0d0_63 | bl!???
856b0d0_65 | bl!???
856b0d0_70 | bl!ReturnOne             
856b0d0_71 | bl!AppAlloc
856b0d0_72 | bl!AppFree
856b0d0_73 | bl!MemAlloc
856b0d0_74 | bl!MemFree
856b0d0_75 | bl!CsDecryptSection  (Decrypt bss, real name from isfb leak source code)
856b0d0_76 | bl!CreateThread
856b0d0_78 | bl!GrabDataFromRegistry
856b0d0_79 | bl!Purge
856b0d0_80 | bl!RSA
</pre>



<h2 class="wp-block-heading">explorer.dll &#8211; the RM3 mastermind</h2>



<p>Explorer.dll could be regarded as the opposite of the background loader. It is designed to manage all interactions of this banking malware, at any level:</p>



<ul><li>Checking timeout timers that could lead to drastic changes in <strong>RM3</strong> operations</li><li>Allowing and executing all tasks that <strong>RM3</strong> is able to perform</li><li>Starting fundamental grabbing features</li><li>Download and update modules and configs</li><li>Launch modules</li><li>Modifying <strong>RM3</strong> URIs dynamically</li></ul>



<div class="wp-block-image"><figure class="aligncenter size-large"><a href="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Explorer_Overview.png?ssl=1"><img loading="lazy" decoding="async" width="800" height="229" data-attachment-id="3112" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/rm3_explorer_overview/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Explorer_Overview.png?fit=1261%2C361&amp;ssl=1" data-orig-size="1261,361" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="RM3_Explorer_Overview" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Explorer_Overview.png?fit=300%2C86&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Explorer_Overview.png?fit=800%2C229&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Explorer_Overview.png?resize=800%2C229&#038;ssl=1" alt="" class="wp-image-3112" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Explorer_Overview.png?resize=1024%2C293&amp;ssl=1 1024w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Explorer_Overview.png?resize=300%2C86&amp;ssl=1 300w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Explorer_Overview.png?resize=768%2C220&amp;ssl=1 768w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Explorer_Overview.png?resize=1200%2C344&amp;ssl=1 1200w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Explorer_Overview.png?resize=1100%2C315&amp;ssl=1 1100w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Explorer_Overview.png?w=1261&amp;ssl=1 1261w" sizes="(max-width: 800px) 100vw, 800px" data-recalc-dims="1" /></a><figcaption><em>An overview of the RM3 explorer.dll module</em></figcaption></figure></div>



<p>In the task manager worker, the workaround looks like the following:</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><a href="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Explorer_Tasks.png?ssl=1"><img loading="lazy" decoding="async" width="800" height="341" data-attachment-id="3114" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/rm3_explorer_tasks/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Explorer_Tasks.png?fit=1301%2C555&amp;ssl=1" data-orig-size="1301,555" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="RM3_Explorer_Tasks" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Explorer_Tasks.png?fit=300%2C128&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Explorer_Tasks.png?fit=800%2C341&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Explorer_Tasks.png?resize=800%2C341&#038;ssl=1" alt="" class="wp-image-3114" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Explorer_Tasks.png?resize=1024%2C437&amp;ssl=1 1024w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Explorer_Tasks.png?resize=300%2C128&amp;ssl=1 300w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Explorer_Tasks.png?resize=768%2C328&amp;ssl=1 768w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Explorer_Tasks.png?resize=1200%2C512&amp;ssl=1 1200w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Explorer_Tasks.png?resize=1100%2C469&amp;ssl=1 1100w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Explorer_Tasks.png?w=1301&amp;ssl=1 1301w" sizes="(max-width: 800px) 100vw, 800px" data-recalc-dims="1" /></a><figcaption><em>RM3 task manager implemented in explorer.dll</em></figcaption></figure></div>



<p>Interestingly, the RM3 developers abuse their own hash system (JAMCRC32) by shuffling hashes into very large amounts of conditions. By doing this, they create an ecosystem that is seemingly unique to each build. Because of this, it feels a major update has been performed on an <strong>RM3</strong> module although technically it is just another anti-disassembly trick for greatly slowing down any in-depth analysis. On the other hand, this task manager is a gold mine for understanding how all the interactions between bots and the C&amp;C are performed and how to filter them into multiple categories.</p>



<h3 class="wp-block-heading">General command</h3>



<h4 class="wp-block-heading">General commands</h4>



<figure id="primary" class="wp-block-table is-style-regular"><table><thead><tr><th> <strong>CRC</strong> </th><th> <strong>Command</strong> </th><th> <strong>Description</strong> </th></tr></thead><tbody><tr><td>0xdf43cd90</td><td>CRASH</td><td>Generate and send a crash report</td></tr><tr><td>0x274323e2</td><td>RESTART</td><td>Restart RM3</td></tr><tr><td>0xce54bcf5</td><td>REBOOT</td><td>Reboot system</td></tr></tbody></table></figure>



<h4 class="wp-block-heading">Recording</h4>



<figure id="primary" class="wp-block-table is-style-regular"><table><thead><tr><th> <strong>CRC</strong> </th><th> <strong>Command</strong> </th><th> <strong>Description</strong> </th></tr></thead><tbody><tr><td>0x746ce763</td><td>VIDEO</td><td>Start desktop recording of the victim machine</td></tr><tr><td>0x8de92b0d</td><td>SETVIDEO</td><td>VIDEO pivot condition</td></tr><tr><td>0x54a7c26c</td><td>SET_VIDEO</td><td>Preparing desktop recording</td></tr></tbody></table></figure>



<h4 class="wp-block-heading">Updates</h4>



<figure id="primary" class="wp-block-table"><table><thead><tr><th> <strong>CRC</strong> </th><th> <strong>Command</strong> </th><th> <strong>Description</strong> </th></tr></thead><tbody><tr><td>0xb82d4140</td><td>UPDATE_ALL</td><td>Forcing update for all module</td></tr><tr><td>0x4f278846</td><td>LOAD_UPDATE</td><td>Load &amp; Execute and updated PX module</td></tr></tbody></table></figure>



<h4 class="wp-block-heading">Tasks</h4>



<figure id="primary" class="wp-block-table"><table><thead><tr><th> <strong>CRC</strong> </th><th> <strong>Command</strong> </th><th> <strong>Description</strong> </th></tr></thead><tbody><tr><td>0xaaa425c4</td><td>USETASKKEY</td><td>Use task.bin pubkey for decrypting upcoming tasks</td></tr></tbody></table></figure>



<h4 class="wp-block-heading">Timeout settings</h4>



<figure id="primary" class="wp-block-table"><table><thead><tr><th> <strong>CRC</strong>  </th><th> <strong>Command</strong>  </th><th> <strong>Description</strong>  </th></tr></thead><tbody><tr><td>0x955879a6</td><td>SENDTIMEOUT</td><td>Timeout timer for receiving commands</td></tr><tr><td>0xd7a003c9</td><td>CONFIGTIMEOUT</td><td>Timeout timer for receiving inject config updates</td></tr><tr><td>0x7d30ee46</td><td>INITIMEOUT</td><td>Timeout timer for receiving INI config update</td></tr><tr><td>0x11271c7f</td><td>IDLEPERIOD</td><td>Timeout timer for bot inactivity</td></tr><tr><td>0x584e5925</td><td>HOSTSHIFTTIMEOUT</td><td>Timeout timer for switching C&amp;C domain list</td></tr><tr><td>0x9dd1ccaf</td><td>STANDBYTIMEOUT</td><td>Timeout timer for switching primary C&amp;C&#8217;s to Stand by ones</td></tr><tr><td>0x9957591</td><td>RUNCHECKTIMEOUT</td><td>Timeout timer for checking &amp; run RM3 autorun</td></tr><tr><td>0x31277bd5</td><td>TASKTIMEOUT</td><td>Timeout timer for receiving a task request</td></tr></tbody></table></figure>



<h4 class="wp-block-heading">Clearing</h4>



<figure id="primary" class="wp-block-table"><table><thead><tr><th> <strong>CRC</strong> </th><th> <strong>Command</strong> </th><th> <strong>Description</strong> </th></tr></thead><tbody><tr><td>0xe3289ecb</td><td>CLEARCACHE</td><td>CLR_CACHE pivot condition</td></tr><tr><td>0xb9781fc7</td><td>CLR_CACHE</td><td>Clear all browser cache</td></tr><tr><td>0xa23fff87</td><td>CLR_LOGS</td><td>Clear all RM3 logs currently stored</td></tr><tr><td>0x213e71be</td><td>DEL_CONFIG</td><td>Remove requested RM3 inject config</td></tr></tbody></table></figure>



<h4 class="wp-block-heading">HTTP</h4>



<figure id="primary" class="wp-block-table"><table><thead><tr><th> <strong>CRC</strong> </th><th> <strong>Command</strong> </th><th> <strong>Description</strong> </th></tr></thead><tbody><tr><td>0x754c3c76</td><td>LOGHTTP</td><td>Intercept &amp; log POST HTTP communication</td></tr><tr><td>0x6c451cb6</td><td>REMOVECSP</td><td>Remove CSP headers from HTTP</td></tr><tr><td>0x97da04de</td><td>MAXPOSTLENGTH</td><td>Clear all RM3 logs currently stored</td></tr></tbody></table></figure>



<h4 class="wp-block-heading">Process execution</h4>



<figure id="primary" class="wp-block-table"><table><thead><tr><th> <strong>CRC</strong> </th><th> <strong>Command</strong> </th><th> <strong>Description</strong> </th></tr></thead><tbody><tr><td>0x73d425ff</td><td>NEWPROCESS</td><td>Initialising RM3 routine</td></tr></tbody></table></figure>



<h4 class="wp-block-heading">Backup</h4>



<figure id="primary" class="wp-block-table"><table><thead><tr><th> <strong>CRC</strong> </th><th> <strong>Command</strong> </th><th> <strong>Description</strong> </th></tr></thead><tbody><tr><td>0x5e822676</td><td>STANDBY</td><td>Case condition if primary servers are not responding for X minutes</td></tr></tbody></table></figure>



<h4 class="wp-block-heading">Data gathering</h4>



<figure id="primary" class="wp-block-table"><table><thead><tr><th> <strong>CRC</strong>  </th><th> <strong>Command</strong>  </th><th> <strong>Description</strong>  </th></tr></thead><tbody><tr><td>0x864b1e44</td><td>GET_CREDS</td><td>Collect credentials</td></tr><tr><td>0xdf794b64</td><td>GET_FILES</td><td>Collect files (grabber module)</td></tr><tr><td>0x2a77637a</td><td>GET_SYSINFO</td><td>Collect system information data</td></tr></tbody></table></figure>



<h4 class="wp-block-heading">Main tasks</h4>



<figure id="primary" class="wp-block-table"><table><thead><tr><th> <strong>CRC</strong> </th><th> <strong>Command</strong> </th><th> <strong>Description</strong> </th></tr></thead><tbody><tr><td>0x3889242</td><td>LOAD_CONFIG</td><td>Download and Load a requested config with specific arguments</td></tr><tr><td>0xdf794b64</td><td>GET_FILES</td><td>Download a DLL from a specific URL and load it into explorer.exe</td></tr><tr><td>0xae30e778</td><td>LOAD_EXE</td><td>Download an executable from a specific URL and load it</td></tr><tr><td>0xb204e7e0</td><td>LOAD_INI</td><td>Download and load an INI file from a specific URL</td></tr><tr><td>0xea0f4d48</td><td>LOAD_CMD</td><td>Load and Execute Shell module</td></tr><tr><td>0x6d1ef2c6</td><td>LOAD_FTP</td><td>Load and Execute FTP module with specific arguments</td></tr><tr><td>0x336845f8</td><td>LOAD_KEYLOG</td><td>Load and Execute keylog module with specific arguments</td></tr><tr><td>0xdb269b16</td><td>LOAD_MODULE</td><td>Load and Execute RM3 PX Module with specific arguments</td></tr><tr><td>0x1e84cd23</td><td>LOAD_SOCKS</td><td>Load and Execute socks module with specific arguments</td></tr><tr><td>0x45abeab3</td><td>LOAD_VNC</td><td>Load and Execute VNC module with specific arguments</td></tr></tbody></table></figure>



<h4 class="wp-block-heading">Shell command</h4>



<figure id="primary" class="wp-block-table"><table><thead><tr><th> <strong>CRC</strong> </th><th> <strong>Command</strong> </th><th> <strong>Description</strong> </th></tr></thead><tbody><tr><td>0xb88d3fdf</td><td>RUN_CMD</td><td>Execute specific command and send the output to the C&amp;C</td></tr></tbody></table></figure>



<h4 class="wp-block-heading">URI setup</h4>



<figure id="primary" class="wp-block-table"><table><thead><tr><th> <strong>CRC</strong> </th><th> <strong>Command</strong> </th><th> <strong>Description</strong> </th></tr></thead><tbody><tr><td>0x9c3c1432</td><td>SET_URI</td><td>Change the URI path of the request</td></tr></tbody></table></figure>



<h4 class="wp-block-heading">File storage</h4>



<figure id="primary" class="wp-block-table"><table><thead><tr><th> <strong>CRC</strong>  </th><th> <strong>Command</strong>  </th><th> <strong>Description</strong>  </th></tr></thead><tbody><tr><td>0xd8829500</td><td>STORE_GRAB</td><td>Save grabber content into temporary file</td></tr><tr><td>0x250de123</td><td>STORE_KEYLOG</td><td>Save keylog content into temporary file</td></tr><tr><td>0x863ecf42</td><td>STORE_MAIL</td><td>Save stolen mail credentials into temporary file</td></tr><tr><td>0x9b587bc4</td><td>STORE_HTTPLOG</td><td>Save stolen http interceptions into temporary file</td></tr><tr><td>0x36e4e464</td><td>STORE_ACC</td><td>Save stolen credentials into temporary file</td></tr></tbody></table></figure>



<h3 class="wp-block-heading">Timeout system</h3>



<p>With its timeout values stored into its rm3_struct, explorer.dll is able to manage every possible worker task launched and monitor them. Then, whenever one of the timers reaches the specified value, it can modify the behaviour of the malware (in most cases, avoiding unnecessary requests that could create noise and so increase the chances of detection).</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><a href="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Task_Timeout_Manager.png?ssl=1"><img loading="lazy" decoding="async" width="800" height="220" data-attachment-id="3117" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/rm3_task_timeout_manager/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Task_Timeout_Manager.png?fit=831%2C229&amp;ssl=1" data-orig-size="831,229" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="RM3_Task_Timeout_Manager" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Task_Timeout_Manager.png?fit=300%2C83&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Task_Timeout_Manager.png?fit=800%2C220&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Task_Timeout_Manager.png?resize=800%2C220&#038;ssl=1" alt="" class="wp-image-3117" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Task_Timeout_Manager.png?w=831&amp;ssl=1 831w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Task_Timeout_Manager.png?resize=300%2C83&amp;ssl=1 300w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Task_Timeout_Manager.png?resize=768%2C212&amp;ssl=1 768w" sizes="(max-width: 800px) 100vw, 800px" data-recalc-dims="1" /></a><figcaption><em>COM Objects being inspected for possible timeout</em></figcaption></figure></div>



<h3 class="wp-block-heading">Backup controllers</h3>



<p>In the same way, explorer.dll also provides additional controllers which are called ‘stand by’ domains. The idea behind this is that, when principal controller C&amp;Cs don’t respond, a module can automatically switch to this preset list. Those new domains are stored in explorer.ini.</p>



<pre class="wp-block-preformatted">{
    "STANDBY": "standbydns1.tld","standbydns2.tld"  
    "STANDBYTIMEOUT": "60"                   // Timeout in minutes
}
</pre>



<p>In the example above, if the primary domain C&amp;Cs did not respond after one hour, the request would automatically switch to the standby C&amp;Cs.</p>



<h3 class="wp-block-heading">Desktop recording and RM3 &#8211; An ingenious way to check bots</h3>



<p>Rarely mentioned in the wild but actively used by TAs, <strong>RM3</strong> is also able to record bot interactions. The video setup is stored in the client.ini file, which the bot receives from the controller domain.</p>



<pre class="wp-block-preformatted">"SETVIDEO": [
        "30,",     // 30 seconds
        "8,",      // 8 Level quality (min:1 - max:10)
        "notipda"  // Process name list    
],
</pre>



<p>Behind &#8220;SETVIDEO&#8221;, only 3 values are required to setup video recording:</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><a href="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Video_Settings.png?ssl=1"><img loading="lazy" decoding="async" width="800" height="439" data-attachment-id="3122" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/rm3_video_settings/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Video_Settings.png?fit=856%2C470&amp;ssl=1" data-orig-size="856,470" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="RM3_Video_Settings" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Video_Settings.png?fit=300%2C165&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Video_Settings.png?fit=800%2C439&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Video_Settings.png?resize=800%2C439&#038;ssl=1" alt="" class="wp-image-3122" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Video_Settings.png?w=856&amp;ssl=1 856w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Video_Settings.png?resize=300%2C165&amp;ssl=1 300w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Video_Settings.png?resize=768%2C422&amp;ssl=1 768w" sizes="(max-width: 800px) 100vw, 800px" data-recalc-dims="1" /></a><figcaption><em>RM3 AVI recording setup</em></figcaption></figure></div>



<p>After being initialised, the task waits its turn to be launched. It can be triggered to work in multiple ways:</p>



<ul><li>Detecting the use of specific keywords in a Windows process</li><li>Using RM3’s increased debugging telemetry to detect if something is crashing, either in the banking malware itself or in a deployed injects (although the ability to detect crashes in an inject is only hypothetical and has not been observed)</li><li>Recording user interactions with a bank account; the ability to record video is a relatively new but killer move on the part of the malware developers allowing them to check legitimate bots and get injects</li></ul>



<p>The ability to record video depends only on &#8220;@VIDEO=&#8221; being cached by the browser module. It is not primarily seen at first glance when examining the config, but likely inside external injects parts.</p>



<pre class="wp-block-preformatted">@ ISFB Code leak
Вкладка Video - запись видео с экрана

Opcode = "VIDEO"
Url - задает шаблон URL страницы, для которой необходмо сделать запись видео с экрана
Target - (опционально) задает ключевое слово, при наличии которого в коде страницы будет сделана запись
Var - задаёт длительность записи в секундах
</pre>



<div class="wp-block-image"><figure class="aligncenter size-large"><a href="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Injects_Pivot.png?ssl=1"><img loading="lazy" decoding="async" width="800" height="229" data-attachment-id="3124" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/rm3_injects_pivot/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Injects_Pivot.png?fit=968%2C277&amp;ssl=1" data-orig-size="968,277" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="RM3_Injects_Pivot" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Injects_Pivot.png?fit=300%2C86&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Injects_Pivot.png?fit=800%2C229&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Injects_Pivot.png?resize=800%2C229&#038;ssl=1" alt="" class="wp-image-3124" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Injects_Pivot.png?w=968&amp;ssl=1 968w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Injects_Pivot.png?resize=300%2C86&amp;ssl=1 300w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Injects_Pivot.png?resize=768%2C220&amp;ssl=1 768w" sizes="(max-width: 800px) 100vw, 800px" data-recalc-dims="1" /></a><figcaption> <em>RM3 browser webinject module detecting if it needs to launch a recording session (or any other particular task).</em> </figcaption></figure></div>



<h3 class="wp-block-heading">RM3 and its remote shell module &#8211; a trump card for ransomware gangs</h3>



<p>Banking malware having its own remote shell module changes the potential impact of infecting a corporate network drastically. This shell is completely custom to the malware and is specially designed. It is also significantly less detectable than other tools currently seen for starting lateral movement attacks due to its rarity. The combination of potentially much greater impact and lower detectability make this piece of code a trump card, particularly as they now look to migrate to a ransomware model.</p>



<p>Called <strong><em>cmdshell</em></strong>, this module isn&#8217;t exclusive to <strong>RM3</strong> but has in fact, been part of <strong>ISFB</strong> since at least build v2.15. It has likely been of interest for TA groups in fields less focused on fraud since then. The inclusion of a remote shell obviously greatly increases the flexibility this malware family provides to its operators; but also, of course, makes it harder to ascertain the exact purpose of any one infection, or the motivation of its operators.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><a href="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Cmdshell_Condition.png?ssl=1"><img loading="lazy" decoding="async" width="800" height="249" data-attachment-id="3126" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/rm3_cmdshell_condition/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Cmdshell_Condition.png?fit=835%2C260&amp;ssl=1" data-orig-size="835,260" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="RM3_Cmdshell_Condition" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Cmdshell_Condition.png?fit=300%2C93&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Cmdshell_Condition.png?fit=800%2C249&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Cmdshell_Condition.png?resize=800%2C249&#038;ssl=1" alt="" class="wp-image-3126" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Cmdshell_Condition.png?w=835&amp;ssl=1 835w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Cmdshell_Condition.png?resize=300%2C93&amp;ssl=1 300w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Cmdshell_Condition.png?resize=768%2C239&amp;ssl=1 768w" sizes="(max-width: 800px) 100vw, 800px" data-recalc-dims="1" /></a><figcaption><em>Cmdshell module being launched by the RM3 Task Manager</em></figcaption></figure></div>



<p>After being executed by the task command &#8220;LOAD_CMD&#8221;, the injected module installs a persistent remote shell which a TA can use to perform any kind of command they want.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><a href="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Cmdshell.png?ssl=1"><img loading="lazy" decoding="async" width="747" height="431" data-attachment-id="3128" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/rm3_cmdshell/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Cmdshell.png?fit=747%2C431&amp;ssl=1" data-orig-size="747,431" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="RM3_Cmdshell" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Cmdshell.png?fit=300%2C173&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Cmdshell.png?fit=747%2C431&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Cmdshell.png?resize=747%2C431&#038;ssl=1" alt="" class="wp-image-3128" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Cmdshell.png?w=747&amp;ssl=1 747w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Cmdshell.png?resize=300%2C173&amp;ssl=1 300w" sizes="(max-width: 747px) 100vw, 747px" data-recalc-dims="1" /></a><figcaption><em>RM3 cmdshell module creating the remote shell</em></figcaption></figure></div>



<p>As noted above, the inclusion of a shell gives great flexibility, but can certainly facilitate the work of at least two types of TA:</p>



<ul><li>Fraudsters (if the VNC/SOCKS module isn&#8217;t working well, perhaps)</li><li>Malicious Red teams affiliated with ransomware gangs</li></ul>



<p>It’s worth noting that this remote shell should not be confused with the RUN_CMD command. The RUN_CMD is used to instruct a bot to execute a simple command with the output saved and sent to the Controllers. It is also present as a simple condition:</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><a href="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_RunCMD.png?ssl=1"><img loading="lazy" decoding="async" width="704" height="244" data-attachment-id="3131" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/rm3_runcmd/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_RunCMD.png?fit=704%2C244&amp;ssl=1" data-orig-size="704,244" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="RM3_RunCMD" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_RunCMD.png?fit=300%2C104&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_RunCMD.png?fit=704%2C244&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_RunCMD.png?resize=704%2C244&#038;ssl=1" alt="" class="wp-image-3131" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_RunCMD.png?w=704&amp;ssl=1 704w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_RunCMD.png?resize=300%2C104&amp;ssl=1 300w" sizes="(max-width: 704px) 100vw, 704px" data-recalc-dims="1" /></a><figcaption><em>RUN_CMD inside the RM3 Task Manager</em></figcaption></figure></div>



<p>Then following a standard I/O interaction:</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><a href="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_RunCMD_Task.png?ssl=1"><img loading="lazy" decoding="async" width="789" height="350" data-attachment-id="3129" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/rm3_runcmd_task/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_RunCMD_Task.png?fit=789%2C350&amp;ssl=1" data-orig-size="789,350" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="RM3_RunCMD_Task" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_RunCMD_Task.png?fit=300%2C133&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_RunCMD_Task.png?fit=789%2C350&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_RunCMD_Task.png?resize=789%2C350&#038;ssl=1" alt="" class="wp-image-3129" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_RunCMD_Task.png?w=789&amp;ssl=1 789w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_RunCMD_Task.png?resize=300%2C133&amp;ssl=1 300w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_RunCMD_Task.png?resize=768%2C341&amp;ssl=1 768w" sizes="(max-width: 789px) 100vw, 789px" data-recalc-dims="1" /></a><figcaption><em>Executing task in cmd console and saving results into an archive</em></figcaption></figure></div>



<p>But both RM3’s remote shell and the RUN_CMD can be an entry point for pushing other specialised tools like Cobalt Strike, Mimikatz or just simple PowerShell scripts. With this kind of flexibility, the main limitation on the impact of this malware is any given TA’s level of skill and their imagination.</p>



<h3 class="wp-block-heading">Task.key – a new weapon in RM3’s encryption paranoia</h3>



<p>Implemented sometime around Q2 2020, <strong>RM3</strong> decided to add an additional layer of protection in its network communications by updating the RSA public key used to encrypt communications between bot and controller domains.</p>



<p>They designed a pivot condition (<strong><em>USETASKKEY</em></strong>) that decides which RSA.KEY and TASK.KEY will be used for decrypting the content from the C&amp;C depending of the command/content received. We believed this choice has been developed for breaking researcher for emulating RM3 traffic.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><a href="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Usetaskkey.png?ssl=1"><img loading="lazy" decoding="async" width="594" height="365" data-attachment-id="3133" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/rm3_usetaskkey/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Usetaskkey.png?fit=594%2C365&amp;ssl=1" data-orig-size="594,365" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="RM3_Usetaskkey" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Usetaskkey.png?fit=300%2C184&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Usetaskkey.png?fit=594%2C365&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Usetaskkey.png?resize=594%2C365&#038;ssl=1" alt="" class="wp-image-3133" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Usetaskkey.png?w=594&amp;ssl=1 594w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Usetaskkey.png?resize=300%2C184&amp;ssl=1 300w" sizes="(max-width: 594px) 100vw, 594px" data-recalc-dims="1" /></a><figcaption><em>Extra condition with USETASKKEY to avoid using the wrong RSA pubkey</em></figcaption></figure></div>



<h3 class="wp-block-heading">RM3 &#8211; A banking malware designed to debug itself</h3>



<p>As we’ve already noted, RM3 represents a significant step change from previous versions of ISFB. These changes extend from major architecture changes down to detailed functional changes and so can be expected to have involved considerable development and probably testing effort, as well. Whether or not the malware developers found the troubleshooting for the RM3 variant more difficult than previously, they also took the opportunity to include a troubleshooting feature. If RM3 experiences any issues, it is designed to dump the relevant process and send a report to the C&amp;C. It’s expected that this would then be reported to the malware developers and so may explain why we now see new builds appearing in the wild rather faster than we have previously.</p>



<p>The task is initialised at the beginning of the explorer module startup with a simple workaround:</p>



<ul><li>Address of the <a href="https://docs.microsoft.com/en-us/windows/win32/api/minidumpapiset/nf-minidumpapiset-minidumpwritedump"><strong>MiniDumpWritDump</strong></a> function from dbghelp.dll is stored</li><li>The path of the temporary dump file is stored in C://tmp/rm3.dmp</li><li>All these values are stored into a designed function and saved into the RM3 master struct</li></ul>



<figure class="wp-block-image size-large"><a href="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Explorer_Crash_Setup.png?ssl=1"><img loading="lazy" decoding="async" width="760" height="141" data-attachment-id="3136" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/rm3_explorer_crash_setup/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Explorer_Crash_Setup.png?fit=760%2C141&amp;ssl=1" data-orig-size="760,141" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="RM3_Explorer_Crash_Setup" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Explorer_Crash_Setup.png?fit=300%2C56&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Explorer_Crash_Setup.png?fit=760%2C141&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Explorer_Crash_Setup.png?resize=760%2C141&#038;ssl=1" alt="" class="wp-image-3136" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Explorer_Crash_Setup.png?w=760&amp;ssl=1 760w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Explorer_Crash_Setup.png?resize=300%2C56&amp;ssl=1 300w" sizes="(max-width: 760px) 100vw, 760px" data-recalc-dims="1" /></a><figcaption><em>Crash dump being initialized and stored into the RM3 global structure</em></figcaption></figure>



<p>With everything now configured, <strong>RM3</strong> is ready for two possible scenarios:</p>



<ul><li>Voluntarily crashing itself with the command ‘CRASH’</li><li>Something goes wrong and so a specific classic error code triggers the function</li></ul>



<div class="wp-block-image"><figure class="aligncenter size-large is-resized"><a href="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Explorer_Crash.png?ssl=1"><img loading="lazy" decoding="async" data-attachment-id="3137" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/rm3_explorer_crash/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Explorer_Crash.png?fit=692%2C291&amp;ssl=1" data-orig-size="692,291" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="RM3_Explorer_Crash" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Explorer_Crash.png?fit=300%2C126&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Explorer_Crash.png?fit=692%2C291&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Explorer_Crash.png?resize=692%2C291&#038;ssl=1" alt="" class="wp-image-3137" width="692" height="291" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Explorer_Crash.png?w=692&amp;ssl=1 692w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Explorer_Crash.png?resize=300%2C126&amp;ssl=1 300w" sizes="(max-width: 692px) 100vw, 692px" data-recalc-dims="1" /></a><figcaption><em>RM3 executing the crash dump routine</em></figcaption></figure></div>



<h2 class="wp-block-heading">Stolen Data &#8211; The (old) gold mine</h2>



<p>Gathering interesting bots is a skill that most banking malware TAs have decent experience with after years of fraud. And nowadays, with the ransomware market exploding, this expertise probably also permits them to affiliate more easily with ransom crews (or even to have exclusivity in some cases).</p>



<p>In general, <strong>ISFB</strong> (v2 and v3) is a perfect playground as it can be used as a loader with more advanced telemetry than classic info-stealers. For example, <strong>Vidar</strong>,<strong> Taurus </strong>or <strong>Raccoon Stealer </strong>can&#8217;t compete at this level. This is because the way they are designed to work as a one-shot process (and be removed from the machine immediately afterwards) makes them much less competitive than the more advanced and flexible ISFB. Of course, in any given situation, this does not necessarily mean they are less important than banking malware. And we should keep in mind the fact that the Revil gang bought the source code for the Kpot stealer and it is likely this was so they could develop their own loader/stealer.</p>



<p><strong>RM3</strong> can be split into three main parts in terms of the grabber:</p>



<ul><li>Files/folders</li><li>Browser credential harvesting</li><li>Mail</li></ul>



<div class="wp-block-image"><figure class="aligncenter size-large"><a href="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Grabbing_Features.png?ssl=1"><img loading="lazy" decoding="async" width="671" height="361" data-attachment-id="3139" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/rm3_grabbing_features/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Grabbing_Features.png?fit=671%2C361&amp;ssl=1" data-orig-size="671,361" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="RM3_Grabbing_Features" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Grabbing_Features.png?fit=300%2C161&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Grabbing_Features.png?fit=671%2C361&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Grabbing_Features.png?resize=671%2C361&#038;ssl=1" alt="" class="wp-image-3139" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Grabbing_Features.png?w=671&amp;ssl=1 671w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Grabbing_Features.png?resize=300%2C161&amp;ssl=1 300w" sizes="(max-width: 671px) 100vw, 671px" data-recalc-dims="1" /></a><figcaption><em>An overview of standard stealing feature developed by RM3</em></figcaption></figure></div>



<p>It’s worth noting that the mail module is an underrated feature that can provide a huge amount of information to a TA:</p>



<ul><li>Many users store nearly everything in their email (including passwords and sensitive documents)</li><li>Mails can be stolen and resold to spammers for crafting legitimate mails with malicious attachments/links</li></ul>



<h3 class="wp-block-heading">Stealing/intercepting HTTP and HTTPS communication</h3>



<p><strong>RM3</strong> implements an SSL Proxy and so is really effective at intercepting POST requests performed by the user. All of them are stored and sent every X minutes to the controllers.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><a href="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_SSL_Proxy.png?ssl=1"><img loading="lazy" decoding="async" width="758" height="335" data-attachment-id="3156" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/rm3_ssl_proxy/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_SSL_Proxy.png?fit=758%2C335&amp;ssl=1" data-orig-size="758,335" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="RM3_SSL_Proxy" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_SSL_Proxy.png?fit=300%2C133&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_SSL_Proxy.png?fit=758%2C335&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_SSL_Proxy.png?resize=758%2C335&#038;ssl=1" alt="" class="wp-image-3156" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_SSL_Proxy.png?w=758&amp;ssl=1 758w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_SSL_Proxy.png?resize=300%2C133&amp;ssl=1 300w" sizes="(max-width: 758px) 100vw, 758px" data-recalc-dims="1" /></a><figcaption><em>RM3 browser module initializing the SSL proxy interception</em></figcaption></figure></div>



<div class="wp-block-image"><figure class="aligncenter size-large"><a href="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/SSL_Proxy_Setup.png?ssl=1"><img loading="lazy" decoding="async" width="629" height="172" data-attachment-id="3141" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/ssl_proxy_setup/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/SSL_Proxy_Setup.png?fit=629%2C172&amp;ssl=1" data-orig-size="629,172" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="SSL_Proxy_Setup" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/SSL_Proxy_Setup.png?fit=300%2C82&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/SSL_Proxy_Setup.png?fit=629%2C172&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/SSL_Proxy_Setup.png?resize=629%2C172&#038;ssl=1" alt="" class="wp-image-3141" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/SSL_Proxy_Setup.png?w=629&amp;ssl=1 629w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/SSL_Proxy_Setup.png?resize=300%2C82&amp;ssl=1 300w" sizes="(max-width: 629px) 100vw, 629px" data-recalc-dims="1" /></a><figcaption><em>RM3 SSL Proxy running on MsEdge</em></figcaption></figure></div>



<p>Whenever the user visits a website, part of the inject config will automatically replace strings or variables in the code (‘base’) with the new content (‘new_var’); this often includes a URL path from an inject C&amp;C.</p>



<p>As if that wasn&#8217;t complicated enough, most of them are geofencedand it could be possible they manually allow the bot to get them (especially with the elite one). Indeed, this is another trick for avoiding analysts and researchers to get and report those scripts &nbsp;that cost millions to financial companies.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><a href="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Inject_Sample.png?ssl=1"><img loading="lazy" decoding="async" width="800" height="62" data-attachment-id="3158" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/rm3_inject_sample/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Inject_Sample.png?fit=1293%2C100&amp;ssl=1" data-orig-size="1293,100" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="RM3_Inject_Sample" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Inject_Sample.png?fit=300%2C23&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Inject_Sample.png?fit=800%2C62&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Inject_Sample.png?resize=800%2C62&#038;ssl=1" alt="" class="wp-image-3158" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Inject_Sample.png?resize=1024%2C79&amp;ssl=1 1024w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Inject_Sample.png?resize=300%2C23&amp;ssl=1 300w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Inject_Sample.png?resize=768%2C59&amp;ssl=1 768w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Inject_Sample.png?resize=1200%2C93&amp;ssl=1 1200w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Inject_Sample.png?resize=1100%2C85&amp;ssl=1 1100w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Inject_Sample.png?w=1293&amp;ssl=1 1293w" sizes="(max-width: 800px) 100vw, 800px" data-recalc-dims="1" /></a><figcaption><em>A typical inject entry in config.bin</em></figcaption></figure></div>



<p>A parser then modifies the variable ‘<strong>@ID@</strong> and ‘<strong>@GROUP@</strong>’ to the correct values as stored in <strong><em>RM3_Struct </em></strong>and other structures relevant to the browsers.dll module.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><a href="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Loading_Inject.png?ssl=1"><img loading="lazy" decoding="async" width="800" height="329" data-attachment-id="3160" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/rm3_loading_inject/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Loading_Inject.png?fit=1225%2C504&amp;ssl=1" data-orig-size="1225,504" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="RM3_Loading_Inject" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Loading_Inject.png?fit=300%2C123&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Loading_Inject.png?fit=800%2C329&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Loading_Inject.png?resize=800%2C329&#038;ssl=1" alt="" class="wp-image-3160" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Loading_Inject.png?resize=1024%2C421&amp;ssl=1 1024w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Loading_Inject.png?resize=300%2C123&amp;ssl=1 300w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Loading_Inject.png?resize=768%2C316&amp;ssl=1 768w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Loading_Inject.png?resize=1200%2C494&amp;ssl=1 1200w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Loading_Inject.png?resize=1100%2C453&amp;ssl=1 1100w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Loading_Inject.png?w=1225&amp;ssl=1 1225w" sizes="(max-width: 800px) 100vw, 800px" data-recalc-dims="1" /></a><figcaption><em>Browser inject module parsing config.bin and replacing with respective botid and groupid</em></figcaption></figure></div>



<h3 class="wp-block-heading">System information gathering</h3>



<p>Gathering system information is simple with <strong>RM3</strong>:</p>



<ul><li>Manually (using a specific <strong>RUN_CMD</strong> command)</li><li>Requesting info from a bot with <strong>GET_SYSINFO</strong></li></ul>



<p>Indeed, <strong>GET_SYSINFO</strong> is known and regularly used by <strong>ISFB</strong> actors (both active strains)</p>



<pre class="wp-block-preformatted">systeminfo.exe
driverquery.exe
net view
nslookup 127.0.0.1
whoami /all
net localgroup administrators
net group "domain computers" /domain</pre>



<p>TAs in general are spending a lot of time (or are literally paying people) to inspect bots for the stolen data they have gathered. In this regard, bots can be split into one of the following groups:</p>



<ul><li>Home bots (personal accounts)</li><li>Researcher bots</li><li>Corporate bots (compromised host from a company)</li></ul>



<p>Over the past 6 months, <strong>ISFB v2</strong> has been seen to be extremely active in term of updates. One purpose of these updates has been to help TAs filter their bots from the loader side directly and more easily. This filtering is not a new thing at all, but it is probably of more interest (and could have a greater impact) for malicious operations these days.&nbsp;</p>



<h3 class="wp-block-heading">Microsoft Edge (Chromium) joining the targeted browser list</h3>



<p>One critical aspect of any banking malware is the ability to hook into a browser so as to inject fakes and replacers in financial institution websites.</p>



<p>At the same time as the Task.key implementation, <strong>RM3</strong> decided to implement a new browser in its targeted list: &#8220;MsEdge&#8221;. This was not random, but was a development choice driven by the sheer number of corporate computers migrating from Internet Explorer to Edge.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><a href="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Msedge.png?ssl=1"><img loading="lazy" decoding="async" width="701" height="264" data-attachment-id="3167" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/rm3_msedge/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Msedge.png?fit=701%2C264&amp;ssl=1" data-orig-size="701,264" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="RM3_Msedge" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Msedge.png?fit=300%2C113&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Msedge.png?fit=701%2C264&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Msedge.png?resize=701%2C264&#038;ssl=1" alt="" class="wp-image-3167" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Msedge.png?w=701&amp;ssl=1 701w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Msedge.png?resize=300%2C113&amp;ssl=1 300w" sizes="(max-width: 701px) 100vw, 701px" data-recalc-dims="1" /></a><figcaption><em>RM3 MsEdge startup module</em></figcaption></figure></div>



<p>This means that 5 browsers are currently targeted:</p>



<ul><li>Internet Explorer</li><li>Microsoft Edge (Original)</li><li>Microsoft Edge (Chromium)</li><li>Mozilla Firefox</li><li>Google Chrome</li></ul>



<p>Currently, RM3 doesn&#8217;t seem to interact with Opera. Given Opera’s low user share and almost non-existent corporate presence, it is not expected that the development of a new module/feature for Opera would have an ROI that was sufficiently attractive to the TAs and <strong>RM3</strong> developers. Any development and debugging would be time consuming and could delay useful updates to existing modules already producing a reliable return.</p>



<h2 class="wp-block-heading">RM3 and its homemade forked SQLITE module</h2>



<p>A lot of this blogpost has been dedicated to discussing the innovative design and features in RM3. But perhaps the best example of the attention to detail displayed in the design and development of this malware is the custom SQLITE3 module that is included with RM3. Presumably driven by the need to extract credentials data from browsers (and related tasks), they have forked the original SQLite3 source code and refactored it to work in <strong>RM3</strong>.</p>



<p>Using SQLite is not a new thing, of course, as it was already noted in the <strong>ISFB</strong> leak.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><a href="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_SQLITE3.png?ssl=1"><img loading="lazy" decoding="async" width="800" height="341" data-attachment-id="3145" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/rm3_sqlite3/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_SQLITE3.png?fit=1041%2C444&amp;ssl=1" data-orig-size="1041,444" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="RM3_SQLITE3" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_SQLITE3.png?fit=300%2C128&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_SQLITE3.png?fit=800%2C341&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_SQLITE3.png?resize=800%2C341&#038;ssl=1" alt="" class="wp-image-3145" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_SQLITE3.png?resize=1024%2C437&amp;ssl=1 1024w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_SQLITE3.png?resize=300%2C128&amp;ssl=1 300w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_SQLITE3.png?resize=768%2C328&amp;ssl=1 768w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_SQLITE3.png?w=1041&amp;ssl=1 1041w" sizes="(max-width: 800px) 100vw, 800px" data-recalc-dims="1" /></a></figure></div>



<p>Interestingly, the RM3 build is based on the original 3.8.6 build and has all the features and functions of the original version.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><a href="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_SQLITE3_Build.png?ssl=1"><img loading="lazy" decoding="async" width="558" height="69" data-attachment-id="3147" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/rm3_sqlite3_build/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_SQLITE3_Build.png?fit=558%2C69&amp;ssl=1" data-orig-size="558,69" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="RM3_SQLITE3_Build" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_SQLITE3_Build.png?fit=300%2C37&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_SQLITE3_Build.png?fit=558%2C69&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_SQLITE3_Build.png?resize=558%2C69&#038;ssl=1" alt="" class="wp-image-3147" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_SQLITE3_Build.png?w=558&amp;ssl=1 558w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_SQLITE3_Build.png?resize=300%2C37&amp;ssl=1 300w" sizes="(max-width: 558px) 100vw, 558px" data-recalc-dims="1" /></a></figure></div>



<p>Because the background loader (bl.dll) is the only module within RM3 technically capable of performing allocation operations, they have simply integrated &#8220;free&#8221;, &#8220;malloc&#8221;, and &#8220;realloc&#8221; API calls with this backbone module.</p>



<h2 class="wp-block-heading">What&#8217;s new with Build 300960?</h2>



<h3 class="wp-block-heading">Goodbye Serpent, Hello AES!</h3>



<p>Around mid-march, <strong>RM3</strong> pushed a major update by replacing the Serpent encryption with the good old AES 128 CBC. All locations where Serpent encryption was used, have been totally reworked so as to work with AES.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><a href="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_AES_Code.png?ssl=1"><img loading="lazy" decoding="async" width="800" height="475" data-attachment-id="3162" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/rm3_aes_code/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_AES_Code.png?fit=846%2C502&amp;ssl=1" data-orig-size="846,502" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="RM3_AES_Code" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_AES_Code.png?fit=300%2C178&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_AES_Code.png?fit=800%2C475&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_AES_Code.png?resize=800%2C475&#038;ssl=1" alt="" class="wp-image-3162" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_AES_Code.png?w=846&amp;ssl=1 846w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_AES_Code.png?resize=300%2C178&amp;ssl=1 300w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_AES_Code.png?resize=768%2C456&amp;ssl=1 768w" sizes="(max-width: 800px) 100vw, 800px" data-recalc-dims="1" /></a><figcaption><em>AES 128 CBC implementation in RM3</em></figcaption></figure></div>



<h3 class="wp-block-heading">RM3 C&amp;C response also reviewed</h3>



<p>Before build 300960, <strong>RM3</strong> treated data received from controllers as described below. Information was split into two encrypted parts (a header and a body) which are treated differently:</p>



<ol type="1"><li>The encrypted head was decrypted with the public RSA key extracted from modules, to extract a Serpent key</li><li>This Serpent key was then used to decrypt the encrypted data in the body (this is a different key from client.ini and loader.ini).</li></ol>



<p>This was the setup before build 300960:</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><a href="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Serpent.png?ssl=1"><img loading="lazy" decoding="async" width="721" height="331" data-attachment-id="3164" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/rm3_serpent/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Serpent.png?fit=721%2C331&amp;ssl=1" data-orig-size="721,331" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="RM3_Serpent" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Serpent.png?fit=300%2C138&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Serpent.png?fit=721%2C331&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Serpent.png?resize=721%2C331&#038;ssl=1" alt="" class="wp-image-3164" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Serpent.png?w=721&amp;ssl=1 721w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_Serpent.png?resize=300%2C138&amp;ssl=1 300w" sizes="(max-width: 721px) 100vw, 721px" data-recalc-dims="1" /></a></figure></div>



<p>Now, in the recently released 300960 build, with Serpent removed and AES implemented instead, the structure of the encrypted header has changed as indicated below:</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><a href="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_AES.png?ssl=1"><img loading="lazy" decoding="async" width="721" height="331" data-attachment-id="3220" data-permalink="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/rm3_aes/" data-orig-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_AES.png?fit=721%2C331&amp;ssl=1" data-orig-size="721,331" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="RM3_AES" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_AES.png?fit=300%2C138&amp;ssl=1" data-large-file="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_AES.png?fit=721%2C331&amp;ssl=1" src="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_AES.png?resize=721%2C331&#038;ssl=1" alt="" class="wp-image-3220" srcset="https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_AES.png?w=721&amp;ssl=1 721w, https://i0.wp.com/blog.fox-it.com/wp-content/uploads/2021/05/RM3_AES.png?resize=300%2C138&amp;ssl=1 300w" sizes="(max-width: 721px) 100vw, 721px" data-recalc-dims="1" /></a></figure></div>



<p>The decrypted body data produced by this process is not in an entirely standard format. In fact, it&#8217;s compressed with the <em>APlib</em> library. But removing the first 0x14 bytes (or sometimes 0x4 bytes) and decompressing it, ensures that the final block is ready for analysis.</p>



<ul><li>If it&#8217;s a DLL, it will be recognised with the PX format</li><li>If it&#8217;s web injects, it&#8217;s an archive that contains .sig files (that is, MAIN.SIG†)</li><li>If it&#8217;s tasks or config updates, these are in a classic raw <strong>ISFB</strong> config format</li></ul>



<p><em>† SIG can probably be taken to mean ‘signature’</em></p>



<h3 class="wp-block-heading">Changes in .ini files</h3>



<p>Two fields have been added in the latest campaigns. Interestingly, these are not new <strong>RM3</strong> features but old ones that have been present for quite some time.</p>



<pre class="wp-block-preformatted">{
&nbsp;&nbsp;&nbsp; "SENDFGKEY": "0",&nbsp;&nbsp;&nbsp; // Send Foreground Key
&nbsp;&nbsp;&nbsp; "SUBDOMAINS": "0",&nbsp;&nbsp; 
}</pre>



<h2 class="wp-block-heading">Appendix</h2>



<h3 class="wp-block-heading">IoCs &#8211; Campaign</h3>



<pre class="wp-block-preformatted">00cd7319a42bbabd0c81a7e9817d2d5071738d5ac36b98b8ff9d7383c3d7e1ba - DE
a7007821b1acbf36ca18cb2ec7d36f388953fe8985589f170be5117548a55c57 - Italy
5ee51dfd1eb41cb6ce8451424540c817dbd804f103229f3ae1b645b320cbb4e8 - Australia/NZ 1
c7552fe5ed044011aa09aebd5769b2b9f3df0faa8adaab42ef3bfff35f5190aa - Australia/NZ 2
261c6f7b7e9d8fc808a4a9db587294202872b2a816b2b98516551949165486c8 - UK 1
2e0b219c5ac3285a08e126f11c07ea3ac60bc96d16d37c2dc24dd8f68c492a74 - UK 2
6818b6b32cb91754fd625e9416e1bc83caac1927148daaa3edaed51a9d04e864 - Worldwide ?

86b670d81a26ea394f7c0edebdc93e8f9bd6ce6e0a8d650e32a0fe36c93f0dee - GoziAT/ISFB RM2</pre>



<h3 class="wp-block-heading"> IoCs &#8211; Modules</h3>



<pre class="wp-block-preformatted">b15c3b93f8de40b745eb1c1df5dcdee3371ba08a1a124c7f20897f87f23bcd55  loader.exe (Build 300932)
ce4fc5dcab919ea40e7915646a3ce345a39a3f81c33758f1ba9c1eae577a5c35  loader.dll (Build 300932)

ba0e9cb3bf25516e2c1f0288e988bd7bd538d275373d36cee28c34dafa7bbd1f  explorer.dll (Build 300932)
accb76e6190358760044d4708e214e546f87b1e644f7e411ba1a67900bcd32a1  bl.dll (Build 300932)
f90ed3d7c437673c3cfa3db8e6fbb3370584914def2c0c2ce1f11f90f199fb4f  ntwrk.dll (Build 300932)
38c9aff9736eae6db5b0d9456ad13d1632b134d654c037fba43086b5816acd58  rt.dll (Build 300932)

2c7cdcf0f9c2930096a561ac6f9c353388a06c339f27f70696d0006687acad5b  browser.dll (Build 300932)
34517a7c78dd66326d0d8fbb2d1524592bbbedb8ed6b595281f7bb3d6a39bc0a  chrome.dll (Build 300932)
59670730341477b0a254ddbfc10df6f1fcd3471a08c0d8ec20e1aa0c560ddee4  firefox.dll (Build 300932)
d927f8793f537b94c6d2299f86fe36e3f751c94edca5cd3ddcdbd65d9143b2b6  iexplorer.dll (Build 300932)
199caec535d640c400d3c6b35806c74912b832ff78cb31fd90fe4712ed194b09  microsoftedgecp.dll (Build 300932)
13635b2582a11e658ab0b959611590005b81178365c12062e77274db1d0b4f0c  msedge.dll (Build 300932)

65a1923e037bce4816ac2654c242921f3e3592e972495945849f155ca69c05e5  loader.dll (Build 300960)

d1f5ef94e14488bf909057e4a0d081ff18dd0ac86f53c42f53b12ea25cdcfe76  cmdshell.dll (Build 300869)
820faca1f9e6e291240e97e5768030e1574b60862d5fce7f6ba519aaa3dbe880  vnc.dll (Build 300869)</pre>



<h3 class="wp-block-heading">Shellcode &#8211; startup module &#8211; bss decrypted</h3>



<pre class="wp-block-preformatted">Windows Security
NTDLL.DLL
RtlExitUserProcess
KERNEL32.DLL
bl.dll - bss decrypted
Microsoft Windows
KERNEL32.DLL
ADVAPI32.DLL
NTDLL.DLL
KERNELBASE
USER32
LdrUnregisterDllNotification
ResolveDelayLoadsFromDll
Software
Wow64EnableWow64FsRedirection
\REGISTRY\USER\%s\%s\
{%08X-%04X-%04X-%04X-%08X%04X}
SetThreadInformation
GetWindowThreadProcessId
%08X-%04X-%04X-%04X-%08X%04X
RtlExitUserThread
S-%u-%u
-%u
Local\
\\.\pipe\
%05u
LdrRegisterDllNotification
NtClose
ZwProtectVirtualMemory
LdrGetProcedureAddress
WaitNamedPipeW
CallNamedPipeW
LdrLoadDll
NtCreateUserProcess
.dll
%08x
GetShellWindow
\KnownDlls\ntdll.dll
%systemroot%\system32\c_1252.NLS
\??\
\\?\</pre>



<h3 class="wp-block-heading"> explorer.dll &#8211; bss decrypted </h3>



<pre class="wp-block-preformatted">indows Security
.jpeg
Main
.gif
.bmp
%APPDATA%\Microsoft\
tasklist.exe /SVC
\Microsoft\Windows\
cmd /C "%s" &gt;&gt; %S0
systeminfo.exe
driverquery.exe
net view
nslookup 127.0.0.1
whoami /all
net localgroup administrators
net group "domain computers" /domain
reg.exe query "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall" /s
cmd /U /C "type %S0 &gt; %S &amp; del %S0"
echo -------- %u
KERNELBASE
.exe
RegGetValueW
0x%S
.DLL
DllRegisterServer
SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Serialize
0x%X,%c%c
Startupdelayinmsec
ICGetInfo
SOFTWARE\Classes\Chrome
DelegateExecute
\\?\
%userprofile%\appdata\local\google\chrome\user data\default\cache
\Software\Microsoft\Windows\CurrentVersion\Run
http\shell\open\command
ICSendMessage
%08x
 | "%s" | %u
msvfw32
ICOpen
ICClose
ICInfo
main
%userprofile%\AppData\Local\Mozilla\Firefox\Profiles
.avi
https://
Video: sec=%u, fps=%u, q=%u
Local\
%userprofile%\appdata\local\microsoft\edge\user data\default\cache
MiniDumpWriteDump
cache2\entries\*.*
%PROGRAMFILES%\Mozilla Firefox
%USERPROFILE%\AppData\Roaming\Mozilla\Firefox\Profiles\*.default*
Software\Classes\CLSID\%s\InProcServer32
open
http://
file://
DBGHELP.DLL
%temp%\rm3.dmp
%u, 0x%x, "%S"
"%S", 0x%p, 0x%x
%APPDATA%
SOFTWARE\Microsoft\Windows NT\CurrentVersion
InstallDate</pre>



<h3 class="wp-block-heading">rt.dll &#8211; bss decrypted  </h3>



<pre class="wp-block-preformatted">Windows Security
%s%02u:%02u:%02u 
:%u
attrib -h -r -s %%1
del %%1
if exist %%1 goto %u
del %%0
Low\
ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/
|$$$}rstuvwxyz{$$$$$$$&gt;?@ABCDEFGHIJKLMNOPQRSTUVW$$$$$$XYZ[\]^_`abcdefghijklmnopq
*.*
.bin
open
%02u-%02u-%02u %02u:%02u:%02u
*.dll
%systemroot%\system32\c_1252.NLS
rundll32 "%s",%S %s
"%s"
cmd /C regsvr32 "%s"
Mb=Lk
Author
n;
QkkXa
M&lt;q</pre>



<h3 class="wp-block-heading">netwrk.dll &#8211; bss decrypted</h3>



<pre class="wp-block-preformatted">&amp;WP
POST
Host
%04x%04x
GET
Windows Security
Content-Type: multipart/form-data; boundary=%s
Content-Type: application/octet-stream
--%s
--%s--
%c%02X
https://
http://
%08x%08x%08x%08x
form
%s=%s&amp;
/images/
.bmp
file://
type=%u&amp;soft=%u&amp;version=%u&amp;user=%08x%08x%08x%08x&amp;group=%u&amp;id=%08x&amp;arc=%u&amp;crc=%08x&amp;size=%u&amp;uptime=%u
index.html
Content-Disposition: form-data; name="%s"
; filename="%s"
&amp;os=%u.%u_%u_%u_x%u
&amp;ip=%s
Mozilla/5.0 (Windows NT %u.%u%s; Trident/7.0; rv:11.0) like Gecko
; Win64; x64
ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/
%08x
|$$$}rstuvwxyz{$$$$$$$&gt;?@ABCDEFGHIJKLMNOPQRSTUVW$$$$$$XYZ[\]^_`abcdefghijklmnopq
F%D,3
overridelink
invalidcert
9*.onion
&amp;sysid=%08x%08x%08x%08x</pre>



<h3 class="wp-block-heading">browser.dll &#8211; bss decrypted</h3>



<pre class="wp-block-preformatted">%c%02X
.php
Windows Security
1.3.6.1.5.5.7.3.2
1.3.6.1.5.5.7.3.1
2.5.29.15
2.5.29.37
2.5.29.1
2.5.29.35
2.5.29.14
2.5.29.10
2.5.29.19
1.3.6.1.5.5.7.1.1
2.5.29.32
1.3.6.1.5.5.7.1.11
1.3.6.1.5.5.7
1.3.6.1.5.5.7.1
2.5.29.31
1.2.840.113549.1.1.11
1.2.840.113549.1.1.5
WS2_32.dll
iexplore.hlp
ConnectEx
Local\
WSOCK32.DLL
WININET.DLL
CRYPT32.DLL
socket
connect
closesocket
getpeername
WSAStartup
WSACleanup
WSAIoctl
User-Agent
Content-Type
Content-Length
Connection
Content-Security-Policy
Content-Security-Policy-Report-Only
X-Frame-Options
Access-Control-Allow-Origin
chunked
WebSocket
Transfer-Encoding
Content-Encoding
Accept-Encoding
Accept-Language
Cookie
identity
gzip, deflate
gzip
Host
://
HTTP/1.1 404 Not Found
Content-Length: 0
://
HTTP/1.1 503 Service Unavailable
Content-Length: 0
http://
https://
Referer
Upgrade
Cache-Control
Last-Modified
Etag
no-cache, no-store, must-revalidate
ocsp
TEXT HTML JSON JAVASCRIPT
SECUR32.DLL
SECURITY.DLL
InitSecurityInterfaceW
BUNNY
SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL
SendTrustedIssuerList
@ID@
URL=
Main
@RANDSTR@
Blocked
@GROUP@
BLOCKCFG=
LOADCFG=
DELCFG=
VIDEO=
VNC=
SOCKS=
CFGON=
CFGOFF=
ENCRYPT=
http
@%s@
http
grabs=
POST
PUT
GET
HEAD
OPTIONS
URL: %s
REF: %s
LANG: %s
AGENT: %s
COOKIE: %s
POST: 
USER: %s
USERID: %s
@*@
***
IE:
:Microsoft Unified Security Protocol Provider
FF:
CR:
ED:
iexplore
firefox
chrome
edge
InitRecv %u, %s%s
CompleteRecv %u, %s%s
LoadUrl %u, %s
NEWGRAB
CertGetCertificateChain
CertVerifyCertificateChainPolicy
NSS_Init
NSS_Shutdown
nss3.dll
PK11_GetInternalKeySlot
PK11_FreeSlot
PK11_Authenticate
PK11SDR_Decrypt
hostname
vaultcli
%PROGRAMFILES%\Mozilla Thunderbird
encryptedUsername
%USERPROFILE%\AppData\Roaming\Thunderbird\Profiles\*.default
encryptedPassword
logins.json
%systemroot%\syswow64\svchost.exe
Software\Microsoft\Internet Explorer\IntelliForms\Storage2
FindCloseUrlCache
VaultEnumerateItems
type=%s, name=%s, address=%s, server=%s, port=%u, ssl=%s, user=%s, password=%s
FindNextUrlCacheEntryW
FindFirstUrlCacheEntryW
DeleteUrlCacheEntryW
VaultEnumerateVaults
VaultOpenVault
VaultCloseVault
VaultFree
VaultGetItem
c:\test\sqlite3.dll
SELECT origin_url, username_value, password_value FROM logins
encrypted_key":"
default\login data
BCryptSetProperty
%userprofile%\appdata\local\google\chrome\user data
local state
DPAPI
v10
BCryptDecrypt
AES
Microsoft Primitive Provider
BCryptDestroyKey
BCryptCloseAlgorithmProvider
ChainingModeGCM
BCryptOpenAlgorithmProvider
BCryptGenerateSymmetricKey
BCRYPT
%userprofile%\appData\local\microsoft\edge\user data</pre>
<div class="sharedaddy sd-sharing-enabled"><div class="robots-nocontent sd-block sd-social sd-social-icon-text sd-sharing"><h3 class="sd-title">Share this:</h3><div class="sd-content"><ul><li class="share-email"><a rel="nofollow noopener noreferrer" data-shared="" class="share-email sd-button share-icon" href="mailto:?subject=%5BShared%20Post%5D%20RM3%20-%20Curiosities%20of%20the%20wildest%20banking%20malware&body=https%3A%2F%2Fblog.fox-it.com%2F2021%2F05%2F04%2Frm3-curiosities-of-the-wildest-banking-malware%2F&share=email" target="_blank" title="Click to email a link to a friend" data-email-share-error-title="Do you have email set up?" data-email-share-error-text="If you&#039;re having problems sharing via email, you might not have email set up for your browser. You may need to create a new email yourself." data-email-share-nonce="c2f6f8e277" data-email-share-track-url="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/?share=email"><span>Email</span></a></li><li class="share-facebook"><a rel="nofollow noopener noreferrer" data-shared="sharing-facebook-3036" class="share-facebook sd-button share-icon" href="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/?share=facebook" target="_blank" title="Click to share on Facebook" ><span>Facebook</span></a></li><li class="share-linkedin"><a rel="nofollow noopener noreferrer" data-shared="sharing-linkedin-3036" class="share-linkedin sd-button share-icon" href="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/?share=linkedin" target="_blank" title="Click to share on LinkedIn" ><span>LinkedIn</span></a></li><li class="share-twitter"><a rel="nofollow noopener noreferrer" data-shared="sharing-twitter-3036" class="share-twitter sd-button share-icon" href="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/?share=twitter" target="_blank" title="Click to share on Twitter" ><span>Twitter</span></a></li><li class="share-pocket"><a rel="nofollow noopener noreferrer" data-shared="" class="share-pocket sd-button share-icon" href="https://blog.fox-it.com/2021/05/04/rm3-curiosities-of-the-wildest-banking-malware/?share=pocket" target="_blank" title="Click to share on Pocket" ><span>Pocket</span></a></li><li class="share-end"></li></ul></div></div></div><div class='sharedaddy sd-block sd-like jetpack-likes-widget-wrapper jetpack-likes-widget-unloaded' id='like-post-wrapper-13954993-3036-6592aa0d2741b' data-src='https://widgets.wp.com/likes/#blog_id=13954993&amp;post_id=3036&amp;origin=blog.fox-it.com&amp;obj_id=13954993-3036-6592aa0d2741b&amp;n=1' data-name='like-post-frame-13954993-3036-6592aa0d2741b' data-title='Like or Reblog'><h3 class="sd-title">Like this:</h3><div class='likes-widget-placeholder post-likes-widget-placeholder' style='height: 55px;'><span class='button'><span>Like</span></span> <span class="loading">Loading...</span></div><span class='sd-text-color'></span><a class='sd-link-color'></a></div>	</div><!-- .entry-content -->

	<div class="entry-footer">
		<ul class="post-tags light-text"><li>Tagged</li><li><a href="https://blog.fox-it.com/tag/rm3/" rel="tag">RM3</a></li></ul><!-- .post-tags -->	</div><!-- .entry-footer -->

	<div class="entry-author-wrapper">
				<div class="site-posted-on">
			<strong>Published</strong>
			<time class="entry-date published" datetime="2021-05-04T16:47:41+02:00">May 4, 2021</time><time class="updated" datetime="2021-05-04T20:14:08+02:00">May 4, 2021</time>		</div><!-- .site-posted-on -->
	</div>
</article><!-- #post-## -->

			
	<nav class="navigation post-navigation" aria-label="Posts">
		<h2 class="screen-reader-text">Post navigation</h2>
		<div class="nav-links"><div class="nav-previous"><a href="https://blog.fox-it.com/2020/11/16/ta505-a-brief-history-of-their-time/" rel="prev"><span class="meta-nav screen-reader-text">Previous Post</span> TA505: A Brief History Of Their Time</a></div><div class="nav-next"><a href="https://blog.fox-it.com/2021/10/11/snapmc-skips-ransomware-steals-data/" rel="next"><span class="meta-nav screen-reader-text">Next Post</span> SnapMC skips ransomware, steals data</a></div></div>
	</nav>
			
		
		</main><!-- #main -->
	</div><!-- #primary -->

		</div><!-- #content -->

		<footer id="colophon" class="site-footer" role="contentinfo">
						<div class="site-info">
				
				
							</div><!-- .site-info -->
		</footer><!-- #colophon -->
	</div><!-- #content-wrapper -->
</div><!-- #page -->

<!--  -->
<style>
			.sd-social-icon .sd-content ul li a.sd-button>span {
				margin-left: 0;
			}
		</style><script defer id="bilmur" data-provider="wordpress.com" data-service="atomic"  src="https://s0.wp.com/wp-content/js/bilmur.min.js?m=202401"></script>
		<div id="jp-carousel-loading-overlay">
			<div id="jp-carousel-loading-wrapper">
				<span id="jp-carousel-library-loading">&nbsp;</span>
			</div>
		</div>
		<div class="jp-carousel-overlay" style="display: none;">

		<div class="jp-carousel-container">
			<!-- The Carousel Swiper -->
			<div
				class="jp-carousel-wrap swiper-container jp-carousel-swiper-container jp-carousel-transitions"
				itemscope
				itemtype="https://schema.org/ImageGallery">
				<div class="jp-carousel swiper-wrapper"></div>
				<div class="jp-swiper-button-prev swiper-button-prev">
					<svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
						<mask id="maskPrev" mask-type="alpha" maskUnits="userSpaceOnUse" x="8" y="6" width="9" height="12">
							<path d="M16.2072 16.59L11.6496 12L16.2072 7.41L14.8041 6L8.8335 12L14.8041 18L16.2072 16.59Z" fill="white"/>
						</mask>
						<g mask="url(#maskPrev)">
							<rect x="0.579102" width="23.8823" height="24" fill="#FFFFFF"/>
						</g>
					</svg>
				</div>
				<div class="jp-swiper-button-next swiper-button-next">
					<svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
						<mask id="maskNext" mask-type="alpha" maskUnits="userSpaceOnUse" x="8" y="6" width="8" height="12">
							<path d="M8.59814 16.59L13.1557 12L8.59814 7.41L10.0012 6L15.9718 12L10.0012 18L8.59814 16.59Z" fill="white"/>
						</mask>
						<g mask="url(#maskNext)">
							<rect x="0.34375" width="23.8822" height="24" fill="#FFFFFF"/>
						</g>
					</svg>
				</div>
			</div>
			<!-- The main close buton -->
			<div class="jp-carousel-close-hint">
				<svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
					<mask id="maskClose" mask-type="alpha" maskUnits="userSpaceOnUse" x="5" y="5" width="15" height="14">
						<path d="M19.3166 6.41L17.9135 5L12.3509 10.59L6.78834 5L5.38525 6.41L10.9478 12L5.38525 17.59L6.78834 19L12.3509 13.41L17.9135 19L19.3166 17.59L13.754 12L19.3166 6.41Z" fill="white"/>
					</mask>
					<g mask="url(#maskClose)">
						<rect x="0.409668" width="23.8823" height="24" fill="#FFFFFF"/>
					</g>
				</svg>
			</div>
			<!-- Image info, comments and meta -->
			<div class="jp-carousel-info">
				<div class="jp-carousel-info-footer">
					<div class="jp-carousel-pagination-container">
						<div class="jp-swiper-pagination swiper-pagination"></div>
						<div class="jp-carousel-pagination"></div>
					</div>
					<div class="jp-carousel-photo-title-container">
						<h2 class="jp-carousel-photo-caption"></h2>
					</div>
					<div class="jp-carousel-photo-icons-container">
						<a href="#" class="jp-carousel-icon-btn jp-carousel-icon-info" aria-label="Toggle photo metadata visibility">
							<span class="jp-carousel-icon">
								<svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
									<mask id="maskInfo" mask-type="alpha" maskUnits="userSpaceOnUse" x="2" y="2" width="21" height="20">
										<path fill-rule="evenodd" clip-rule="evenodd" d="M12.7537 2C7.26076 2 2.80273 6.48 2.80273 12C2.80273 17.52 7.26076 22 12.7537 22C18.2466 22 22.7046 17.52 22.7046 12C22.7046 6.48 18.2466 2 12.7537 2ZM11.7586 7V9H13.7488V7H11.7586ZM11.7586 11V17H13.7488V11H11.7586ZM4.79292 12C4.79292 16.41 8.36531 20 12.7537 20C17.142 20 20.7144 16.41 20.7144 12C20.7144 7.59 17.142 4 12.7537 4C8.36531 4 4.79292 7.59 4.79292 12Z" fill="white"/>
									</mask>
									<g mask="url(#maskInfo)">
										<rect x="0.8125" width="23.8823" height="24" fill="#FFFFFF"/>
									</g>
								</svg>
							</span>
						</a>
												<a href="#" class="jp-carousel-icon-btn jp-carousel-icon-comments" aria-label="Toggle photo comments visibility">
							<span class="jp-carousel-icon">
								<svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
									<mask id="maskComments" mask-type="alpha" maskUnits="userSpaceOnUse" x="2" y="2" width="21" height="20">
										<path fill-rule="evenodd" clip-rule="evenodd" d="M4.3271 2H20.2486C21.3432 2 22.2388 2.9 22.2388 4V16C22.2388 17.1 21.3432 18 20.2486 18H6.31729L2.33691 22V4C2.33691 2.9 3.2325 2 4.3271 2ZM6.31729 16H20.2486V4H4.3271V18L6.31729 16Z" fill="white"/>
									</mask>
									<g mask="url(#maskComments)">
										<rect x="0.34668" width="23.8823" height="24" fill="#FFFFFF"/>
									</g>
								</svg>

								<span class="jp-carousel-has-comments-indicator" aria-label="This image has comments."></span>
							</span>
						</a>
											</div>
				</div>
				<div class="jp-carousel-info-extra">
					<div class="jp-carousel-info-content-wrapper">
						<div class="jp-carousel-photo-title-container">
							<h2 class="jp-carousel-photo-title"></h2>
						</div>
						<div class="jp-carousel-comments-wrapper">
															<div id="jp-carousel-comments-loading">
									<span>Loading Comments...</span>
								</div>
								<div class="jp-carousel-comments"></div>
								<div id="jp-carousel-comment-form-container">
									<span id="jp-carousel-comment-form-spinner">&nbsp;</span>
									<div id="jp-carousel-comment-post-results"></div>
																														<form id="jp-carousel-comment-form">
												<label for="jp-carousel-comment-form-comment-field" class="screen-reader-text">Write a Comment...</label>
												<textarea
													name="comment"
													class="jp-carousel-comment-form-field jp-carousel-comment-form-textarea"
													id="jp-carousel-comment-form-comment-field"
													placeholder="Write a Comment..."
												></textarea>
												<div id="jp-carousel-comment-form-submit-and-info-wrapper">
													<div id="jp-carousel-comment-form-commenting-as">
																													<fieldset>
																<label for="jp-carousel-comment-form-email-field">Email (Required)</label>
																<input type="text" name="email" class="jp-carousel-comment-form-field jp-carousel-comment-form-text-field" id="jp-carousel-comment-form-email-field" />
															</fieldset>
															<fieldset>
																<label for="jp-carousel-comment-form-author-field">Name (Required)</label>
																<input type="text" name="author" class="jp-carousel-comment-form-field jp-carousel-comment-form-text-field" id="jp-carousel-comment-form-author-field" />
															</fieldset>
															<fieldset>
																<label for="jp-carousel-comment-form-url-field">Website</label>
																<input type="text" name="url" class="jp-carousel-comment-form-field jp-carousel-comment-form-text-field" id="jp-carousel-comment-form-url-field" />
															</fieldset>
																											</div>
													<input
														type="submit"
														name="submit"
														class="jp-carousel-comment-form-button"
														id="jp-carousel-comment-form-button-submit"
														value="Post Comment" />
												</div>
											</form>
																											</div>
													</div>
						<div class="jp-carousel-image-meta">
							<div class="jp-carousel-title-and-caption">
								<div class="jp-carousel-photo-info">
									<h3 class="jp-carousel-caption" itemprop="caption description"></h3>
								</div>

								<div class="jp-carousel-photo-description"></div>
							</div>
							<ul class="jp-carousel-image-exif" style="display: none;"></ul>
							<a class="jp-carousel-image-download" href="#" target="_blank" style="display: none;">
								<svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
									<mask id="mask0" mask-type="alpha" maskUnits="userSpaceOnUse" x="3" y="3" width="19" height="18">
										<path fill-rule="evenodd" clip-rule="evenodd" d="M5.84615 5V19H19.7775V12H21.7677V19C21.7677 20.1 20.8721 21 19.7775 21H5.84615C4.74159 21 3.85596 20.1 3.85596 19V5C3.85596 3.9 4.74159 3 5.84615 3H12.8118V5H5.84615ZM14.802 5V3H21.7677V10H19.7775V6.41L9.99569 16.24L8.59261 14.83L18.3744 5H14.802Z" fill="white"/>
									</mask>
									<g mask="url(#mask0)">
										<rect x="0.870605" width="23.8823" height="24" fill="#FFFFFF"/>
									</g>
								</svg>
								<span class="jp-carousel-download-text"></span>
							</a>
							<div class="jp-carousel-image-map" style="display: none;"></div>
						</div>
					</div>
				</div>
			</div>
		</div>

		</div>
		
	<script type="text/javascript">
		window.WPCOM_sharing_counts = {"https:\/\/blog.fox-it.com\/2021\/05\/04\/rm3-curiosities-of-the-wildest-banking-malware\/":3036};
	</script>
				<link rel='stylesheet' id='all-css-6a27d52917a03aef636928d0d671f91d' href='https://blog.fox-it.com/_static/??-eJyVjFsKgCAQAC+ULQaZP9FZTJewfOG6eP0I6gD9zjDTi7A5NUwNSuDDJ4ITWzH2gpgdBySwpmYmDEDdF6xi5+QCjpZo6D/qV4gPPIMtrlItk5y1VvoGzj40MA==' type='text/css' media='all' />
<style id='core-block-supports-inline-css'>
.wp-container-core-columns-layout-1.wp-container-core-columns-layout-1{flex-wrap:nowrap;}.wp-container-core-columns-layout-2.wp-container-core-columns-layout-2{flex-wrap:nowrap;}.wp-container-core-columns-layout-3.wp-container-core-columns-layout-3{flex-wrap:nowrap;}.wp-container-core-columns-layout-4.wp-container-core-columns-layout-4{flex-wrap:nowrap;}.wp-container-core-columns-layout-5.wp-container-core-columns-layout-5{flex-wrap:nowrap;}.wp-container-core-columns-layout-6.wp-container-core-columns-layout-6{flex-wrap:nowrap;}.wp-container-core-columns-layout-7.wp-container-core-columns-layout-7{flex-wrap:nowrap;}.wp-container-core-columns-layout-8.wp-container-core-columns-layout-8{flex-wrap:nowrap;}
</style>
<script type="text/javascript" id="coblocks-tinyswiper-initializer-js-extra">
/* <![CDATA[ */
var coblocksTinyswiper = {"carouselPrevButtonAriaLabel":"Previous","carouselNextButtonAriaLabel":"Next","sliderImageAriaLabel":"Image"};
/* ]]> */
</script>
<script type='text/javascript'  src='https://blog.fox-it.com/_static/??-eJyVktFOwzAMRX+IEFY0IR4QnzKlSdbeNnFC7azA15OqKjyMCfoUxfY5tizPWdlE4kl0DqUDsR68ZGPH7T1dPLk0aVMkRSMCu2UUoum8so60A4v+/t4PfDdfi21qQ7Ijr9XDT0AZqqwg/ZtcZ2ItoA/FM7Kfdjdd2BVVIAhMwOeVRnofPWuQ87n2rCGVSxvAfcWaxUfmgu634f9Gb6R2e3hEVgE0qnOyhdUZ7/scIKvZTsii5mxTvLHL7TJOS31bEJwOGKv3rfjie0Mu1AVGLJt4jS+Hp4fH4/Px0DRfc2HpCQ=='></script>
<script defer type="text/javascript" src="https://stats.wp.com/e-202401.js" id="jetpack-stats-js"></script>
<script type="text/javascript" id="jetpack-stats-js-after">
/* <![CDATA[ */
_stq = window._stq || [];
_stq.push([ "view", JSON.parse("{\"v\":\"ext\",\"blog\":\"13954993\",\"post\":\"3036\",\"tz\":\"2\",\"srv\":\"blog.fox-it.com\",\"hp\":\"atomic\",\"ac\":\"2\",\"amp\":\"0\",\"j\":\"1:13.0-a.10\"}") ]);
_stq.push([ "clickTrackerInit", "13954993", "3036" ]);
/* ]]> */
</script>
<script type="text/javascript" id="jetpack-carousel-js-extra">
/* <![CDATA[ */
var jetpackSwiperLibraryPath = {"url":"https:\/\/blog.fox-it.com\/wp-content\/plugins\/jetpack\/_inc\/build\/carousel\/swiper-bundle.min.js"};
var jetpackCarouselStrings = {"widths":[370,700,1000,1200,1400,2000],"is_logged_in":"","lang":"en","ajaxurl":"https:\/\/blog.fox-it.com\/wp-admin\/admin-ajax.php","nonce":"9c0a314044","display_exif":"1","display_comments":"1","single_image_gallery":"1","single_image_gallery_media_file":"","background_color":"black","comment":"Comment","post_comment":"Post Comment","write_comment":"Write a Comment...","loading_comments":"Loading Comments...","download_original":"View full size <span class=\"photo-size\">{0}<span class=\"photo-size-times\">\u00d7<\/span>{1}<\/span>","no_comment_text":"Please be sure to submit some text with your comment.","no_comment_email":"Please provide an email address to comment.","no_comment_author":"Please provide your name to comment.","comment_post_error":"Sorry, but there was an error posting your comment. Please try again later.","comment_approved":"Your comment was approved.","comment_unapproved":"Your comment is in moderation.","camera":"Camera","aperture":"Aperture","shutter_speed":"Shutter Speed","focal_length":"Focal Length","copyright":"Copyright","comment_registration":"0","require_name_email":"1","login_url":"https:\/\/blog.fox-it.com\/wp-login.php?redirect_to=https%3A%2F%2Fblog.fox-it.com%2F2021%2F05%2F04%2Frm3-curiosities-of-the-wildest-banking-malware%2F","blog_id":"1","meta_data":["camera","aperture","shutter_speed","focal_length","copyright"]};
/* ]]> */
</script>
<script type='text/javascript'  src='https://blog.fox-it.com/wp-content/plugins/jetpack/_inc/build/carousel/jetpack-carousel.min.js?m=1702916724'></script>
<script type="text/javascript" id="sharing-js-js-extra">
/* <![CDATA[ */
var sharing_js_options = {"lang":"en","counts":"1","is_stats_active":"1"};
/* ]]> */
</script>
<script type="text/javascript" src="https://blog.fox-it.com/wp-content/plugins/jetpack/_inc/build/sharedaddy/sharing.min.js?ver=13.0-a.10" id="sharing-js-js"></script>
<script type="text/javascript" id="sharing-js-js-after">
/* <![CDATA[ */
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-facebook' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-facebook' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomfacebook', 'menubar=1,resizable=1,width=600,height=400' );
						return false;
					}
				} );
			} )();
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-linkedin' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-linkedin' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomlinkedin', 'menubar=1,resizable=1,width=580,height=450' );
						return false;
					}
				} );
			} )();
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-twitter' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-twitter' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomtwitter', 'menubar=1,resizable=1,width=600,height=350' );
						return false;
					}
				} );
			} )();
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-pocket' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-pocket' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcompocket', 'menubar=1,resizable=1,width=450,height=450' );
						return false;
					}
				} );
			} )();
/* ]]> */
</script>
	<iframe src='https://widgets.wp.com/likes/master.html?ver=202401#ver=202401&#038;n=1' scrolling='no' id='likes-master' name='likes-master' style='display:none;'></iframe>
	<div id='likes-other-gravatars' class='wpl-new-layout'><div class="likes-text"><span>%d</span></div><ul class="wpl-avatars sd-like-gravatars"></ul></div>
	
</body>
</html>
<!--
	generated in 0.388 seconds
	228645 bytes batcached for 300 seconds
-->
