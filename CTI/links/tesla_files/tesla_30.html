
<!doctype html>
<html lang="en-US">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="apple-touch-icon" sizes="180x180" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v5/favicon/icon-Unit42-180x180.png">
	<link rel="icon" type="image/png" sizes="32x32" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v5/favicon/icon-Unit42-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v5/favicon/icon-Unit42-16x16.png">
	<link rel="manifest" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v5/favicon/site.webmanifest">
	<link rel="mask-icon" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v5/favicon/safari-pinned-tab.svg" color="#000000">
	<meta name="msapplication-TileColor" content="#000000">
	<meta name="theme-color" content="#000">
        <script type="text/javascript">
var main_site_url = 'https://www.paloaltonetworks.com';
var maindomain_lang = 'https://www.paloaltonetworks.com';
function getParameterByName(name, url) {
		if(url == null){
		  url = window.location.href;
		}
	    name = name.replace(/[\[\]]/g, '\\$&');
	    var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
		results = regex.exec(url);
	    if (!results) return null;
	    if (!results[2]) return '';
	    return decodeURIComponent(results[2].replace(/\+/g, ' '));
	}
	var container_q = getParameterByName('container');
	var d_lang = 'en';	
	if(container_q != '' && container_q != null){	    
	    sessionStorage.setItem('container',container_q);
	    	    location.href = 'https://unit42.paloaltonetworks.com/excel-add-ins-malicious-xll-files-agent-tesla';
	}
</script>
<style type="text/css">
@font-face{font-family:'Merriweather';font-style:normal;font-weight:300;font-display:swap;src:url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/merriweather/merriweather-v21-latin-300.eot');src:local('Merriweather Light'),local('Merriweather-Light'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/merriweather/merriweather-v21-latin-300.eot?#iefix') format('embedded-opentype'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/merriweather/merriweather-v21-latin-300.woff2') format('woff2'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/merriweather/merriweather-v21-latin-300.woff') format('woff'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/merriweather/merriweather-v21-latin-300.ttf') format('truetype'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/merriweather/merriweather-v21-latin-300.svg#Merriweather') format('svg')}
@font-face{font-family:'Merriweather';font-style:italic;font-weight:300;font-display:swap;src:url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/merriweather/merriweather-v21-latin-300italic.eot');src:local('Merriweather Light Italic'),local('Merriweather-LightItalic'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/merriweather/merriweather-v21-latin-300italic.eot?#iefix') format('embedded-opentype'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/merriweather/merriweather-v21-latin-300italic.woff2') format('woff2'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/merriweather/merriweather-v21-latin-300italic.woff') format('woff'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/merriweather/merriweather-v21-latin-300italic.ttf') format('truetype'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/merriweather/merriweather-v21-latin-300italic.svg#Merriweather') format('svg')}
@font-face{font-family:'Merriweather';font-style:normal;font-weight:400;font-display:swap;src:url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/merriweather/merriweather-v21-latin-regular.eot');src:local('Merriweather Regular'),local('Merriweather-Regular'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/merriweather/merriweather-v21-latin-regular.eot?#iefix') format('embedded-opentype'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/merriweather/merriweather-v21-latin-regular.woff2') format('woff2'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/merriweather/merriweather-v21-latin-regular.woff') format('woff'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/merriweather/merriweather-v21-latin-regular.ttf') format('truetype'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/merriweather/merriweather-v21-latin-regular.svg#Merriweather') format('svg')}
@font-face{font-family:'Merriweather';font-style:italic;font-weight:400;font-display:swap;src:url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/merriweather/merriweather-v21-latin-italic.eot');src:local('Merriweather Italic'),local('Merriweather-Italic'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/merriweather/merriweather-v21-latin-italic.eot?#iefix') format('embedded-opentype'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/merriweather/merriweather-v21-latin-italic.woff2') format('woff2'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/merriweather/merriweather-v21-latin-italic.woff') format('woff'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/merriweather/merriweather-v21-latin-italic.ttf') format('truetype'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/merriweather/merriweather-v21-latin-italic.svg#Merriweather') format('svg')}
@font-face{font-family:'Merriweather';font-style:normal;font-weight:700;font-display:swap;src:url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/merriweather/merriweather-v21-latin-700.eot');src:local('Merriweather Bold'),local('Merriweather-Bold'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/merriweather/merriweather-v21-latin-700.eot?#iefix') format('embedded-opentype'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/merriweather/merriweather-v21-latin-700.woff2') format('woff2'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/merriweather/merriweather-v21-latin-700.woff') format('woff'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/merriweather/merriweather-v21-latin-700.ttf') format('truetype'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/merriweather/merriweather-v21-latin-700.svg#Merriweather') format('svg')}
@font-face{font-family:'Merriweather';font-style:italic;font-weight:700;font-display:swap;src:url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/merriweather/merriweather-v21-latin-700italic.eot');src:local('Merriweather Bold Italic'),local('Merriweather-BoldItalic'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/merriweather/merriweather-v21-latin-700italic.eot?#iefix') format('embedded-opentype'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/merriweather/merriweather-v21-latin-700italic.woff2') format('woff2'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/merriweather/merriweather-v21-latin-700italic.woff') format('woff'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/merriweather/merriweather-v21-latin-700italic.ttf') format('truetype'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/merriweather/merriweather-v21-latin-700italic.svg#Merriweather') format('svg')}


@font-face{font-family:'Decimal';font-style:normal;font-weight:500;font-display:swap;src:local('Decimal Medium'),local('Decimal-Medium'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/decimal/Decimal-Medium-Pro_Web.woff2') format('woff2'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/decimal/Decimal-Medium-Pro_Web.woff') format('woff'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/decimal/Decimal-Medium-Pro.otf') format('opentype')}
@font-face{font-family:'Decimal';font-style:italic;font-weight:500;font-display:swap;src:local('Decimal Medium'),local('Decimal-Medium'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/decimal/Decimal-MediumItalic-Pro_Web.woff2') format('woff2'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/decimal/Decimal-MediumItalic-Pro_Web.woff') format('woff'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/decimal/Decimal-MediumItalic-Pro.otf') format('opentype')}
@font-face{font-family:'Decimal';font-style:normal;font-weight:600;font-display:swap;src:local('Decimal SemiBold'),local('Decimal-SemiBold'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/decimal/Decimal-Semibold-Pro_Web.woff2') format('woff2'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/decimal/Decimal-Semibold-Pro_Web.woff') format('woff'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/decimal/Decimal-Semibold-Pro.otf') format('opentype')}
@font-face{font-family:'Decimal';font-style:italic;font-weight:600;font-display:swap;src:local('Decimal SemiBold'),local('Decimal-SemiBold'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/decimal/Decimal-SemiboldItalic-Pro_Web.woff2') format('woff2'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/decimal/Decimal-SemiboldItalic-Pro_Web.woff') format('woff'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/decimal/Decimal-SemiboldItalic-Pro.otf') format('opentype')}
@font-face{font-family:'Decimal';font-style:normal;font-weight:700;font-display:swap;src:local('Decimal Bold'),local('Decimal-Bold'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/decimal/Decimal-Bold-Pro_Web.woff2') format('woff2'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/decimal/Decimal-Bold-Pro_Web.woff') format('woff'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/decimal/Decimal-Bold-Pro.otf') format('opentype')}
@font-face{font-family:'Decimal';font-style:italic;font-weight:700;font-display:swap;src:local('Decimal Bold'),local('Decimal-Bold'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/decimal/Decimal-BoldItalic-Pro_Web.woff2') format('woff2'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/decimal/Decimal-BoldItalic-Pro_Web.woff') format('woff'),url('https://www.paloaltonetworks.com/etc/clientlibs/clean/dependencies/fonts/decimal/Decimal-BoldItalic-Pro.otf') format('opentype')}    

.nav {
    display: flex;
    flex-wrap: wrap;
    padding-left: 0;
    margin-bottom: 0;
    list-style: none;
}
dl, ol, ul {
    margin-top: 0;
    margin-bottom: 1rem;
}
.nav-link {
    display: block;
    padding: .5rem 1rem;
}
.productNav2021Component .btn {
    flex-grow: 0;
    flex-shrink: 0;
    display: inline-block;
    font-family: Decimal,Arial,"Helvetica Neue",Helvetica,sans-serif;
    font-weight: 600;
    color: #141414;
    text-align: center;
    vertical-align: middle;
    user-select: none;
    background-color: transparent;
    border: 2px solid transparent;
    border-radius: 50px;
    transition: box-shadow .15s ease-in-out;
}

.productNav2021Component .btn-primary{
    display: inline-flex;
    align-items: center;
    text-decoration: none;
    max-width: 100%;
    text-align: left;
    background-color: #fa582d;
    color: #141414;
    position: relative;
}
.productNav2021Component .btn-primary.focus,.productNav2021Component  .btn-primary:focus{
    color: #141414;
    border-color: #00c0e8;
}
.productNav2021Component .btn-primary:hover, .productNav2021Component .btn-primary-outline:hover,  .productNav2021Component .btn-black:hover, .productNav2021Component .btn-white:hover {
    background-color: #fb7652;
}
.productNav2021Component .btn{
    height:auto;
}
.productNav2021Component .btn:hover {
    color: #141414;
    text-decoration: none;
    border-color: transparent;
}
.productNav2021Component .btn-dark,.productNav2021Component .btn-outline-dark{
    display: inline-flex;
    align-items: center;
    text-decoration: none;
    max-width: 100%;
    text-align: left;
    background: 0;
    color: #fff;
    position: relative;
}
.productNav2021Component .btn-dark i, .productNav2021Component .btn-outline-dark i {
    width: 20px;
    height: 20px;
    margin-left: 15px;
    flex-grow: 0;
    flex-shrink: 0;
    display: inline-block;
    background-size: contain;
    background-position: center;
    background-repeat: no-repeat;
    background-image: url('https://www.paloaltonetworks.com/etc/clientlibs/clean/imgs/arrow-right-white.svg');
}
.productNav2021Component .btn-dark:hover{
    color: #999;
}
.productNav2021Component .btn-dark:not(:disabled):not(.disabled):active,.productNav2021Component .btn-dark:hover{
    background-color: transparent;
    border-color: transparent;
}
.productNav2021Component .btn-dark:not(:disabled):not(.disabled):active:focus{
    box-shadow: none;
}
.productNav2021Component .display-2{
    font-family: Merriweather,Georgia,serif;
    font-weight: 400;
    color: #5f5f5f;
    font-size: 14px;
    line-height: 24px;
} 
.panClean .ar-1-1 img,.panClean .ar-4-3 img,.panClean .ar-3-2 img,.panClean .ar-3-4 img,.panClean .ar-12-17 img,.panClean .ar-16-7 img,.panClean .ar-16-9 img{
    position:absolute;
    width:100%;
    height:100%;
    object-fit:contain;
    font-family:'object-fit: contain;'
}
.panClean .ar-3-2{padding-bottom:66.6666667%}
.panClean .ar-1-1,.panClean .ar-4-3,.panClean .ar-3-2,.panClean .ar-3-4,.panClean .ar-12-17,.panClean .ar-16-7,.panClean .ar-16-9{display:inline-block;width:100%;height:0;overflow:hidden;position:relative;margin:0}
.panClean .ar-16-9{padding-bottom:52.25%}
.panClean .ar-3-4{padding-bottom:133.3333333%}
.productNav2021Component .container,.productNav2021Component .container-fluid,.productNav2021Component .container-sm,.productNav2021Component .container-md,.productNav2021Component .container-lg,.productNav2021Component .container-xl{width:100%;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto}

/** [Start] custom css, not copied from main site **/
.productNav2021Component a, button, input[type=reset], input[type=submit]{
    transition: none;
}
.panClean .productNav2021Component .prisma-2021-nav-main .btn.btn-primary {
    height: auto;
}
.pan-search-coveo-header .magic-box-clear{
    display: block!important;
}
.no-scroll{overflow:hidden !important}
/** [End] custom css, not copied from main site **/
@media (min-width: 576px){
.productNav2021Component .container-fluid {
    width: auto;
    margin-left: 7.14285714%;
    margin-right: 7.14285714%;
}
}
@media(min-width:768px){.productNav2021Component .btn{padding:13px 24px;font-size:16px;line-height:20px}}
@media(min-width:768px){.productNav2021Component .btn{padding:13px 24px;font-size:16px;line-height:20px}
.productNav2021Component .btn-light,.productNav2021Component .btn-dark{padding-left:0;padding-right:0}
.productNav2021Component .btn-link{padding:5px 0}
.productNav2021Component .btn-lg,.productNav2021Component .btn-group-lg>.btn{padding:20px 40px;font-size:18px}
.productNav2021Component .btn-sm,.productNav2021Component .btn-group-sm>.btn{padding:10px 20px;font-size:14px}
}
@media(max-width:767.98px){.productNav2021Component .btn{padding:10px 20px;font-size:14px;line-height:18px;}}
@media(max-width:767.98px){
    .productNav2021Component .btn-dark{padding-left:0;padding-right:0}
}    
.wpp-meta {
    display: none !important;
}
</style>   
<link rel='stylesheet'  href='https://www.paloaltonetworks.com/etc.clientlibs/panClean/components/mainNavigationComp/clientlibs/panClean/criticalTop.min.css' type='text/css' media='all' />
<!--<link rel='stylesheet' href='https://www.paloaltonetworks.com/etc.clientlibs/panClean/components/mainNavigationComp/clientlibs/panClean/defered.min.css' media='all' />
<link rel='stylesheet' href='https://www.paloaltonetworks.com/etc/clientlibs/clean/panClean/prisma/defered.min.css' media='all' />-->
<link rel='stylesheet' href='https://www.paloaltonetworks.com/etc.clientlibs/panClean/components/mainNavigationComp/clientlibs/panClean/criticalTopProductNav.min.css' media='all' />
<link rel='stylesheet' href='https://www.paloaltonetworks.com/etc.clientlibs/panClean/components/mainNavigationComp/clientlibs/panClean/deferedProductNav.min.css' media='all' />
    <meta name='robots' content='index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1' />
<link rel="alternate" hreflang="en" href="https://unit42.paloaltonetworks.com/excel-add-ins-malicious-xll-files-agent-tesla/" />
<link rel="alternate" hreflang="ja" href="https://unit42.paloaltonetworks.jp/excel-add-ins-malicious-xll-files-agent-tesla/" />
<link rel="alternate" hreflang="x-default" href="https://unit42.paloaltonetworks.com/excel-add-ins-malicious-xll-files-agent-tesla/" />

	<!-- This site is optimized with the Yoast SEO Premium plugin v21.0 (Yoast SEO v21.0) - https://yoast.com/wordpress/plugins/seo/ -->
	<title>Weaponization of Excel Add-Ins Part 1: Malicious XLL Files and Agent Tesla Case Studies</title>
	<meta name="description" content="We observed a new surge of Agent Tesla and Dridex malware samples dropped by malicious Excel add-ins (XLL files). We focus here on Agent Tesla." />
	<link rel="canonical" href="https://unit42.paloaltonetworks.com/excel-add-ins-malicious-xll-files-agent-tesla/" />
	<meta property="og:locale" content="en_US" />
	<meta property="og:type" content="article" />
	<meta property="og:title" content="Weaponization of Excel Add-Ins Part 1: Malicious XLL Files and Agent Tesla Case Studies" />
	<meta property="og:description" content="We observed a new surge of Agent Tesla and Dridex malware samples dropped by malicious Excel add-ins (XLL files). We focus here on Agent Tesla." />
	<meta property="og:url" content="https://unit42.paloaltonetworks.com/excel-add-ins-malicious-xll-files-agent-tesla/" />
	<meta property="og:site_name" content="Unit 42" />
	<meta property="article:published_time" content="2022-01-25T14:00:56+00:00" />
	<meta property="article:modified_time" content="2022-05-12T16:11:58+00:00" />
	<meta property="og:image" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2022/01/Unit42-blog-2by1-characters-r4d1-2020_Targeted-Attacks-v1.png" />
	<meta property="og:image:width" content="600" />
	<meta property="og:image:height" content="300" />
	<meta property="og:image:type" content="image/png" />
	<meta name="author" content="Yaron Samuel" />
	<meta name="twitter:card" content="summary_large_image" />
	<!-- / Yoast SEO Premium plugin. -->


<link rel='dns-prefetch' href='//www.google.com' />
<link rel="alternate" type="application/rss+xml" title="Unit 42 &raquo; Weaponization of Excel Add-Ins Part 1: Malicious XLL Files and Agent Tesla Case Studies Comments Feed" href="https://unit42.paloaltonetworks.com/excel-add-ins-malicious-xll-files-agent-tesla/feed/" />
<script type="text/javascript">
var globalConfig = {};
globalConfig.buildName = "UniqueResourceAssetsID_DEC022022";
</script>
<meta property="og:likes" content="8"/>
<meta property="og:readtime" content="8"/>
<meta property="og:views" content="67,626"/>
<meta property="og:date_created" content="January 25, 2022 at 6:00 AM"/>
<meta property="og:post_length" content="2063"/>
<meta property="og:category" content="Malware"/>
<meta property="og:category_link" content="https://unit42.paloaltonetworks.com/category/malware-2/"/>
<meta property="og:author" content="Yaron Samuel"/>
<meta property="og:authorlink" content="https://unit42.paloaltonetworks.com/author/yaron-samuel/"/>
<meta property="og:author_image_link" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/11/unit-news-meta.svg"/>
<meta name="post_tags" content="AgentTesla,Cortex,Dridex,Macros,Microsoft Excel,next-generation firewall,WildFire"/>
<meta property="og:post_image" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2022/01/Unit42-blog-2by1-characters-r4d1-2020_Targeted-Attacks-v1.png"/>
<script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"BlogPosting","headline":"Weaponization of Excel Add-Ins Part 1: Malicious XLL Files and Agent Tesla Case Studies","name":"Weaponization of Excel Add-Ins Part 1: Malicious XLL Files and Agent Tesla Case Studies","description":"We observed a new surge of Agent Tesla and Dridex malware samples dropped by malicious Excel add-ins (XLL files). We focus here on Agent Tesla.","url":"https:\/\/unit42.paloaltonetworks.com\/excel-add-ins-malicious-xll-files-agent-tesla\/","mainEntityOfPage":"https:\/\/unit42.paloaltonetworks.com\/excel-add-ins-malicious-xll-files-agent-tesla\/","datePublished":"January 25, 2022","articleBody":"Executive Summary\r\nBetween July 27 and Dec. 1, 2021, Unit 42 researchers observed a new surge of Agent Tesla and Dridex malware samples, which have been dropped by Excel add-ins (XLL) and Office 4.0 macros. We have found that the Excel 4.0 macro dropper is mainly used to drop Dridex, while the XLL droppers are used to drop both Agent Tesla and Dridex. While malicious XLL files have been known for quite some time, their reappearance in the threat landscape is a new trend and possibly indicates a shift toward this infection vector.\r\n\r\nThe XLL files we observed were mainly distributed via emails that contain price quote luring contents sent from an abcovid[.]tech email address with the email subject \u201cINQUIRY.\u201d Targets of these emails include organizations in the following sectors: manufacturing; retail; federal, state and local government; finance; pharmaceuticals; transportation; education; and several others across the United States, Europe and Southeast Asia. Furthermore, some of the malicious XLL files we have seen abuse a legitimate open-source Excel add-in framework named Excel-DNA.\r\n\r\nThis blog is the first of a two-part series. Here, we take a look into the XLL file attributes, the abused legitimate open-source framework and the final Agent Tesla payload. The second part of the series will deal with the other infection flows, the XLL and Excel 4 (XLM) droppers that deliver Dridex samples.\r\n\r\nPalo Alto Networks customers receive protections against the attacks discussed here through Cortex XDR or the WildFire cloud-delivered security subscription for the Next-Generation Firewall.\r\n\r\n\r\n\r\nTypes of Attacks Covered\r\nMalware, Agent Tesla\r\n\r\n\r\nRelated Unit 42 Topics\r\nDridex, Macros\r\n\r\n\r\n\r\nTable of Contents\r\nChains of Infection\r\nWhat Is XLL Again?\r\nMalicious Excel Add-In (XLL) Dropper\r\n\u2022 Excel-DNA\r\n\u2022 Jack Resource\r\nFinal Payload \u2013\u00a0Agent Tesla\r\n\u2022 String Decryption\r\n\u2022 Windows Vault\r\nConclusion\r\nIndicators of Compromise\r\nAdditional Resources\r\nAppendix A: Deobfuscated Code of the Function That Reads Windows Vault\r\nChains of Infection\r\nThe flow chart in Figure 1 shows the two possible chains of events we have observed during our investigation:\r\n\r\n \tA victim receives an email with a malicious attachment.\r\n \tThe attachment is either a malicious XLL or XLM file.\r\n \tIn the case of an XLL, when run it will either:\r\n\r\n \tDrop an intermediate dropper that in turn will drop an Agent Tesla payload.\r\n \tDownload Agent Tesla payload from Discord.\r\n \tDownload Dridex payload from Discord.\r\n\r\n\r\n \tIn the case of an XLM, when run it will drop a VBS downloader that downloads and executes a Dridex sample from Discord.\r\n\r\nWhile Agent Tesla and Dridex infection chains are not necessarily distributed by the same actor, they seem to be part of a new trend of infection vectors.\r\n\r\n[caption id=\"attachment_121709\" align=\"aligncenter\" width=\"746\"] Figure 1. Chains of infection.[\/caption]\r\nWhat Is XLL Again?\r\nXLL is an extension for Excel add-ins. In reality, XLL is just a regular PE-DLL file. The XLL file extension is associated with an icon very similar to other Excel-supported extensions. In turn, the average user won\u2019t notice any difference between XLL and other Excel file formats and can be lured to open it. This may be surprising, but Excel will gladly load and execute an XLL file upon double-clicking.\r\n\r\n[caption id=\"attachment_121711\" align=\"aligncenter\" width=\"88\"] Figure 2. XLL icon.[\/caption]\r\n\r\nOnce the XLL is loaded by Excel, it will invoke the export functions of the XLL file based on the defined XLL interface. Two of these interface functions stand out: xlAutoOpen and xlAutoClose. These functions get called once the add-in gets activated or deactivated, respectively. These functions can be used to load malicious code, similar to the methods Auto_Open and Auto_Close in classic VBA macros.\r\n\r\nOne disadvantage of XLL files is that they can only be loaded by Excel with the correct bitness. For example, a 64-bit XLL can only be loaded by the 64-bit version of Excel. The same goes for 32-bit versions. Therefore, malware authors have to rely on the Excel version that is installed on the victim\u2019s machine.\r\n\r\nLike with VBA macros, Excel will warn the user about the security concern arising from executing the add-in. In that aspect, it has no advantage for malware compared to VBA macros.\r\n\r\n[caption id=\"attachment_121713\" align=\"aligncenter\" width=\"430\"] Figure 3. Warning by Excel while trying to execute an XLL file.[\/caption]\r\n\r\nFor the reasons described, XLL files can be a good choice for adversaries seeking to gain an initial foothold on a victim machine. An attacker can get code packaged into a DLL loaded by Excel, which in turn may mislead security products that are not prepared to deal with this scenario.\r\n\r\nFigure 4 shows an example of an XLL file in a PE editor. Among other exported functions, we can find the xlAutoOpen and xlAutoClose functions.\r\n\r\n[caption id=\"attachment_121715\" align=\"aligncenter\" width=\"853\"] Figure 4. Excel add-in exports as shown by the PE header editor CFF Explorer.[\/caption]\r\nMalicious Excel Add-In (XLL) Dropper\r\nWe have observed malicious emails with the following XLL samples attached:\r\n\r\nSHA256: 7a6f8590d4be989faccb34cd393e713fd80fa17e92d7613f33061d647d0e6d12\r\nSHA256: fbc94ba5952a58e9dfa6b74fc59c21d830ed4e021d47559040926b8b96a937d0\r\nExcel-DNA\r\nThe XLL sample we encountered utilizes a legitimate open-source framework for Excel add-in development called Excel-DNA. The framework has several features that also suit malware authors. One is the ability to load a compressed .NET assembly packaged in the PE resources directly to memory without \u201ctouching\u201d the disk. Therefore, despite being a legitimate framework, Excel-DNA has functionality that resembles malicious loaders and can be abused as a loader.\r\n\r\nExcel-DNA has another attribute that may hinder coverage with Yara, likely unknown even to the malware authors. For some reason, many Excel-DNA samples have slightly more than 10,000 exported functions, most of them without any meaningful functionality. The Yara PE module export function parsing limit is only 8,192. Therefore, a Yara rule that targets a certain export name located at an index higher than 8192 will not match against the sample.\r\n\r\nWhen we look at the resources of our Excel-DNA XLL, we can see an XML resource named __MAIN__. This resource contains information about which module gets loaded by Excel-DNA. In our case, the specified module will be decompressed from a resource named JACK.\r\n\r\nThe resource will be decompressed using the LZMA algorithm and subsequently loaded to memory.\r\n\r\n[caption id=\"attachment_121717\" align=\"aligncenter\" width=\"520\"] Figure 5. Excel-DNA resources.[\/caption]\r\n\r\nWe have created Python code for the extraction of such assemblies from an Excel-DNA add-in. You can find this script on the Unit 42 GitHub repo.\r\nJACK Resource\r\nThe loaded module is a simple dropper. Upon loading the module, the AutoOpen method will be invoked. The malicious code in this method drops the final payload executable into %AppData%\\service.exe and executes it (see Figure 6). It\u2019s worth noting that the module contained in Jack is configurable, meaning in other versions it may download a payload instead of dropping it, as well as dropping a real Excel template and executing it.\r\n\r\nThe configuration is displayed in Figure 7, which contains the following options:\r\n\r\n \tbDown - Download the payload.\r\n \ttemplateEnabled - Drop and open an Excel template.\r\n \tpayload - Contains the payload to be dropped.\r\n\r\n[caption id=\"attachment_121719\" align=\"aligncenter\" width=\"652\"] Figure 6. Decompiled code of the JACK dropper module with the AutoOpen method, as shown by dnSpy.[\/caption]\r\n\r\n[caption id=\"attachment_121721\" align=\"aligncenter\" width=\"329\"] Figure 7. Dropper configuration variables and the final payload contained in a byte array.[\/caption]\r\nFinal Payload \u2013 Agent Tesla\r\nSHA256: AB5444F001B8F9E06EBF12BC8FDC200EE5F4185EE52666D69F7D996317EA38F3\r\n\r\nThe final payload is an obfuscated Agent Tesla sample. In terms of features, Agent Tesla is extensively documented. Our sample exfiltrates the stolen data to the email phantom1248@yandex[.]com using the SMTP protocol. Figure 8 shows the decompiled entry point of our Agent Tesla sample. It is structured in a similar way to other Agent Tesla samples.\r\n\r\n[caption id=\"attachment_121723\" align=\"aligncenter\" width=\"874\"] Figure 8. Agent Tesla\u2019s decompiled main function.[\/caption]\r\nString Decryption\r\nThe Agent Tesla sample stores all of its strings in an encrypted form within a large array of characters.\r\n\r\nUpon initialization, the sample XORs each byte of the \u201clarge byte array\u201d with the hard coded byte 170 and the index (trimmed to byte size) of the character in the \u201clarge byte array.\u201d Next, the sample fills an array that stores all the strings, by splicing the decrypted array in known offsets and corresponding lengths. For instance, let\u2019s examine the eight bytes in the offset 665:\r\n\r\n\r\n\r\nBefore execution (encrypted form)\r\n28, 92, 94, 81, 25, 64, 88, 122\r\n\r\n\r\nUpon initialization\u00a0\r\n\r\n(after decryption, XORed with the index and 170)\r\n47, 108, 111, 103, 46, 116, 109, 112\r\n\r\n\r\nASCII form after decryption\r\n\/log.tmp\r\n\r\n\r\n\r\nThe code below assigns the 53rd member of the string\u2019s array the eight bytes at offset 665 of the decrypted byte-array.\r\n\r\n[caption id=\"attachment_121725\" align=\"aligncenter\" width=\"900\"] Figure 9. String assignment code.[\/caption]\r\n\r\nExamining the decrypted string array reveals the various targets that Agent Tesla aims to steal:\r\n\r\n \tSensitive browser information and cookies.\r\n \tMail, FTP and VPN client information.\r\n \tCredentials from Windows Vault.\r\n \tRecorded keystrokes and screenshots.\r\n \tClipboard information.\r\n\r\nWindows Vault\r\nTo steal information from the Windows Vault, it appears that the Agent Tesla authors converted a PowerSploit script into C# to build a .NET assembly.\r\n\r\nIt uses P\/Invoke to call API functions from the vaultcli.dll library. At first, VaultEnumerateItems will be called to get all available vaults. Next, each vault will be opened using VaultOpenVault. Once a vault is open, the contained items will be enumerated using VaultEnumerateItems. Finally, the attributes of the items are read using VaultGetItem. Agent Tesla records the queries as items in its own list (manually deobfuscated code shown in Figure 10). The curious reader can find the fully deobfuscated method in Appendix A.\r\n\r\n[caption id=\"attachment_121727\" align=\"aligncenter\" width=\"818\"] Figure 10. Deobfuscated Agent Tesla code for recording extracted Windows Vault items.[\/caption]\r\n\r\nBelow is the list of Windows Vault GUIDs (and corresponding descriptions) that Agent Tesla uses to steal information:\r\n\r\n\r\n\r\nGUID\r\nDescription\r\n\r\n\r\n2F1A6504-0641-44CF-8BB5-3612D865F2E5\r\nWindows Secure Note\r\n\r\n\r\n3CCD5499-87A8-4B10-A215-608888DD3B55\r\nWindows Web Password Credential\r\n\r\n\r\n154E23D0-C644-4E6F-8CE6-5069272F999F\r\nWindows Credential Picker Protector\r\n\r\n\r\n4BF4C442-9B8A-41A0-B380-DD4A704DDB28\r\nWeb Credentials\r\n\r\n\r\n77BC582B-F0A6-4E15-4E80-61736B6F3B29\r\nWindows Credentials\r\n\r\n\r\nE69D7838-91B5-4FC9-89D5-230D4D4CC2BC\r\nWindows Domain Certificate Credential\r\n\r\n\r\n3E0E35BE-1B77-43E7-B873-AED901B6275B\r\nWindows Domain Password Credential\r\n\r\n\r\n3C886FF3-2669-4AA2-A8FB-3F6759A77548\r\nWindows Extended Credential\r\n\r\n\r\n\r\nConclusion\r\nFor the recent surge of malware we observed, we analyzed the infection chain that uses Excel add-ins (XLL). We also described how the malware author abuses the legitimate Excel-DNA framework for the creation of these malicious XLLs. Lastly, we briefly described the final Agent Tesla payload and which information it tries to exfiltrate from a victim\u2019s system, with a focus on the Windows Vault data. The usage of Excel add-ins in recent attacks may indicate a new trend in the threat landscape.\r\n\r\nIn the next part of this series, we will describe the other infection chain, which involves using Excel 4.0 macros to deliver Dridex.\r\n\r\nPalo Alto Networks customers receive protections against the attacks discussed here through Cortex XDR or the WildFire cloud-delivered security subscription for the Next-Generation Firewall.\r\n\r\nIf you think you may have been compromised or have an urgent matter, get in touch with the Unit 42 Incident Response team or call North America Toll-Free: 866.486.4842 (866.4.UNIT42), EMEA: +31.20.299.3130, APAC: +65.6983.8730, or Japan: +81.50.1790.0200.\r\n\r\nPalo Alto Networks has shared these findings, including file samples and indicators of compromise, with our fellow Cyber Threat Alliance members. CTA members use this intelligence to rapidly deploy protections to their customers and to systematically disrupt malicious cyber actors. Learn more about the Cyber Threat Alliance. \r\nIndicators of Compromise\r\n\r\n\r\n\r\nSample hash (SHA256)\r\nDescription\u00a0\r\n\r\n\r\n7a6f8590d4be989faccb34cd393e713fd80fa17e92d7613f33061d647d0e6d12\r\nXLL dropper\r\n\r\n\r\nfbc94ba5952a58e9dfa6b74fc59c21d830ed4e021d47559040926b8b96a937d0\r\nXLL dropper\r\n\r\n\r\nbfc32aab4f7ec31e03a723e0efd839afc2f861cc615a889561b38430c396dcfe\r\nIntermediate dropper (Jack)\r\n\r\n\r\nAB5444F001B8F9E06EBF12BC8FDC200EE5F4185EE52666D69F7D996317EA38F3\r\nFinal Agent Tesla payload\r\n\r\n\r\n\r\nAdditional Resources\r\n\r\n \tAgent Tesla Infostealer - ThreatVector Blog, BlackBerry\r\n \tAgent Tesla amps up information stealing attacks - Sophos\r\n\r\nAppendix A: Deobfuscated Code of the Function That Reads Windows Vault\r\nSee more information on GitHub.\r\n\r\n&nbsp;","publisher":{"@type":"Organization","@id":"#panworg"},"image":{"@type":"ImageObject","url":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/uploads\/2022\/01\/Unit42-blog-2by1-characters-r4d1-2020_Targeted-Attacks-v1.png","width":150,"height":75},"author":[{"@type":"Person","name":"Yaron Samuel"}]}</script><link rel='stylesheet' id='crayon-css' href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='wp-block-library-css' href='https://unit42.paloaltonetworks.com/wp-includes/css/dist/block-library/style.min.css?ver=6.3' type='text/css' media='all' />
<style id='classic-theme-styles-inline-css' type='text/css'>
/*! This file is auto-generated */
.wp-block-button__link{color:#fff;background-color:#32373c;border-radius:9999px;box-shadow:none;text-decoration:none;padding:calc(.667em + 2px) calc(1.333em + 2px);font-size:1.125em}.wp-block-file__button{background:#32373c;color:#fff;text-decoration:none}
</style>
<style id='global-styles-inline-css' type='text/css'>
body{--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;--wp--preset--shadow--natural: 6px 6px 9px rgba(0, 0, 0, 0.2);--wp--preset--shadow--deep: 12px 12px 50px rgba(0, 0, 0, 0.4);--wp--preset--shadow--sharp: 6px 6px 0px rgba(0, 0, 0, 0.2);--wp--preset--shadow--outlined: 6px 6px 0px -3px rgba(255, 255, 255, 1), 6px 6px rgba(0, 0, 0, 1);--wp--preset--shadow--crisp: 6px 6px 0px rgba(0, 0, 0, 1);}:where(.is-layout-flex){gap: 0.5em;}:where(.is-layout-grid){gap: 0.5em;}body .is-layout-flow > .alignleft{float: left;margin-inline-start: 0;margin-inline-end: 2em;}body .is-layout-flow > .alignright{float: right;margin-inline-start: 2em;margin-inline-end: 0;}body .is-layout-flow > .aligncenter{margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > .alignleft{float: left;margin-inline-start: 0;margin-inline-end: 2em;}body .is-layout-constrained > .alignright{float: right;margin-inline-start: 2em;margin-inline-end: 0;}body .is-layout-constrained > .aligncenter{margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > :where(:not(.alignleft):not(.alignright):not(.alignfull)){max-width: var(--wp--style--global--content-size);margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > .alignwide{max-width: var(--wp--style--global--wide-size);}body .is-layout-flex{display: flex;}body .is-layout-flex{flex-wrap: wrap;align-items: center;}body .is-layout-flex > *{margin: 0;}body .is-layout-grid{display: grid;}body .is-layout-grid > *{margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
.wp-block-navigation a:where(:not(.wp-element-button)){color: inherit;}
:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}
:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}
.wp-block-pullquote{font-size: 1.5em;line-height: 1.6;}
</style>
<link rel='stylesheet' id='dashicons-css' href='https://unit42.paloaltonetworks.com/wp-includes/css/dashicons.min.css?ver=6.3' type='text/css' media='all' />
<link rel='stylesheet' id='post-views-counter-frontend-css' href='https://unit42.paloaltonetworks.com/wp-content/plugins/post-views-counter/css/frontend.min.css?ver=1.3.13' type='text/css' media='all' />
<link rel='stylesheet' id='ppress-frontend-css' href='https://unit42.paloaltonetworks.com/wp-content/plugins/wp-user-avatar/assets/css/frontend.min.css?ver=4.13.0' type='text/css' media='all' />
<link rel='stylesheet' id='ppress-flatpickr-css' href='https://unit42.paloaltonetworks.com/wp-content/plugins/wp-user-avatar/assets/flatpickr/flatpickr.min.css?ver=4.13.0' type='text/css' media='all' />
<link rel='stylesheet' id='ppress-select2-css' href='https://unit42.paloaltonetworks.com/wp-content/plugins/wp-user-avatar/assets/select2/select2.min.css?ver=6.3' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-horizontal-list-0-css' href='https://unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-list-horizontal/style.min.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-post-translations-0-css' href='https://unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-post-translations/style.min.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wordpress-popular-posts-css-css' href='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/css/wpp.css?ver=5.5.1' type='text/css' media='all' />
<link rel='stylesheet' id='unit42/css-css' href='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v5/dist/styles/main.css?v2' type='text/css' media='all' />
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery.min.js?ver=3.7.0' id='jquery-core-js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=3.4.1' id='jquery-migrate-js'></script>
<script type='text/javascript' id='crayon_js-js-extra'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta' id='crayon_js-js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/wp-user-avatar/assets/flatpickr/flatpickr.min.js?ver=4.13.0' id='ppress-flatpickr-js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/wp-user-avatar/assets/select2/select2.min.js?ver=4.13.0' id='ppress-select2-js'></script>
<script id="wpp-json" type="application/json">
{"sampling_active":0,"sampling_rate":100,"ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-json\/wordpress-popular-posts\/v1\/popular-posts","api_url":"https:\/\/unit42.paloaltonetworks.com\/wp-json\/wordpress-popular-posts","ID":121706,"token":"525fab1ac5","lang":0,"debug":0}
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/js/wpp.min.js?ver=5.5.1' id='wpp-js-js'></script>
<script type='text/javascript' id='wpml-xdomain-data-js-extra'>
/* <![CDATA[ */
var wpml_xdomain_data = {"css_selector":"wpml-ls-item","ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","current_lang":"en","_nonce":"b0f4a5a4ca"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/res/js/xdomain-data.js?ver=4.6.5' id='wpml-xdomain-data-js'></script>
<link rel="https://api.w.org/" href="https://unit42.paloaltonetworks.com/wp-json/" /><link rel="alternate" type="application/json" href="https://unit42.paloaltonetworks.com/wp-json/wp/v2/posts/121706" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://unit42.paloaltonetworks.com/xmlrpc.php?rsd" />
<meta name="generator" content="WordPress 6.3" />
<link rel='shortlink' href='https://unit42.paloaltonetworks.com/?p=121706' />
<link rel="alternate" type="application/json+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Fexcel-add-ins-malicious-xll-files-agent-tesla%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Fexcel-add-ins-malicious-xll-files-agent-tesla%2F&#038;format=xml" />
<meta name="generator" content="WPML ver:4.6.5 stt:1,28;" />
<meta name="google-site-verification" content="zHZtYOWm9hm4SZgsH7wqiYcOwmsAsxDUDU4UD1QxB40" /><style>#wpdevart_lb_overlay{background-color:#000000;} #wpdevart_lb_overlay.wpdevart_opacity{opacity:0.8 !important;} #wpdevart_lb_main_desc{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;} #wpdevart_lb_information_content{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;}
		#wpdevart_lb_information_content{
			width:100%;	
			padding-top:0px;
			padding-bottom:0px;
		}
		#wpdevart_info_counter_of_imgs{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_caption{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_title{
			    display: inline-block;
				padding-left:5px;
				padding-right:5px;
				font-size:15px;
				color:#000000;
		}
		@-webkit-keyframes rotate {
			to   {-webkit-transform: rotate(360deg);}
			from  {-webkit-transform: rotate(0deg);}
		}
		@keyframes rotate {
			to   {transform: rotate(360deg);}
			from  {transform: rotate(0deg);}
		}
		#wpdevart_lb_loading_img,#wpdevart_lb_loading_img_first{
			-webkit-animation: rotate 2s linear  infinite;
    		animation: rotate 2s linear infinite;
		}
	  </style>                  <style id="wpp-loading-animation-styles">@-webkit-keyframes bgslide{from{background-position-x:0}to{background-position-x:-200%}}@keyframes bgslide{from{background-position-x:0}to{background-position-x:-200%}}.wpp-widget-placeholder,.wpp-widget-block-placeholder{margin:0 auto;width:60px;height:3px;background:#dd3737;background:linear-gradient(90deg,#dd3737 0%,#571313 10%,#dd3737 100%);background-size:200% auto;border-radius:3px;-webkit-animation:bgslide 1s infinite linear;animation:bgslide 1s infinite linear}</style>
              <script>var $ = jQuery;</script>
  
  
<script type="text/javascript">
;(function(win, doc, style, timeout) {
var STYLE_ID = 'at-body-style';
function getParent() {
return doc.getElementsByTagName('head')[0];
}
function addStyle(parent, id, def) {
if (!parent) {
return;
}
var style = doc.createElement('style');
style.id = id;
style.innerHTML = def;
parent.appendChild(style);
}
function removeStyle(parent, id) {
if (!parent) {
return;
}
var style = doc.getElementById(id);
if (!style) {
return;
}
parent.removeChild(style);
}
addStyle(getParent(), STYLE_ID, style);
setTimeout(function() {
removeStyle(getParent(), STYLE_ID);
}, timeout);
}(window, document, "body {visibility:hidden !important}", 3000));
</script>

<script src="//assets.adobedtm.com/9273d4aedcd2/0d76ae0322d7/launch-425c423d843b.min.js" async></script>
<script type="text/javascript" src="https://www.paloaltonetworks.com/content/dam/pan/en_US/includes/attribution.js"></script>
  

<script type="text/javascript">
    var isIE11 = !!navigator.userAgent.match(/Trident.*rv\:11\./);
if(isIE11){
    var polyfill = 'https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v5/dist/scripts/polyfill.min.js';
    document.write('<script type="text/javascript" src="'+polyfill+'">\x3C/script>');

}
    /**
 * String.prototype.replaceAll() polyfill
 * https://gomakethings.com/how-to-replace-a-section-of-a-string-with-another-one-with-vanilla-js/
 * @author Chris Ferdinandi
 * @license MIT
 */
if (!String.prototype.replaceAll) {
	String.prototype.replaceAll = function(str, newStr){

		// If a regex pattern
		if (Object.prototype.toString.call(str).toLowerCase() === '[object regexp]') {
			return this.replace(str, newStr);
		}

		// If a string
		return this.replace(new RegExp(str, 'g'), newStr);

	};
}


    /*! lozad.js - v1.16.0 - 2020-09-06 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.lozad=e()}(this,function(){"use strict";
/**
   * Detect IE browser
   * @const {boolean}
   * @private
   */var g="undefined"!=typeof document&&document.documentMode,f={rootMargin:"0px",threshold:0,load:function(t){if("picture"===t.nodeName.toLowerCase()){var e=t.querySelector("img"),r=!1;null===e&&(e=document.createElement("img"),r=!0),g&&t.getAttribute("data-iesrc")&&(e.src=t.getAttribute("data-iesrc")),t.getAttribute("data-alt")&&(e.alt=t.getAttribute("data-alt")),r&&t.append(e)}if("video"===t.nodeName.toLowerCase()&&!t.getAttribute("data-src")&&t.children){for(var a=t.children,o=void 0,i=0;i<=a.length-1;i++)(o=a[i].getAttribute("data-src"))&&(a[i].src=o);t.load()}t.getAttribute("data-poster")&&(t.poster=t.getAttribute("data-poster")),t.getAttribute("data-src")&&(t.src=t.getAttribute("data-src")),t.getAttribute("data-srcset")&&t.setAttribute("srcset",t.getAttribute("data-srcset"));var n=",";if(t.getAttribute("data-background-delimiter")&&(n=t.getAttribute("data-background-delimiter")),t.getAttribute("data-background-image"))t.style.backgroundImage="url('"+t.getAttribute("data-background-image").split(n).join("'),url('")+"')";else if(t.getAttribute("data-background-image-set")){var d=t.getAttribute("data-background-image-set").split(n),u=d[0].substr(0,d[0].indexOf(" "))||d[0];// Substring before ... 1x
u=-1===u.indexOf("url(")?"url("+u+")":u,1===d.length?t.style.backgroundImage=u:t.setAttribute("style",(t.getAttribute("style")||"")+"background-image: "+u+"; background-image: -webkit-image-set("+d+"); background-image: image-set("+d+")")}t.getAttribute("data-toggle-class")&&t.classList.toggle(t.getAttribute("data-toggle-class"))},loaded:function(){}};function A(t){t.setAttribute("data-loaded",!0)}var m=function(t){return"true"===t.getAttribute("data-loaded")},v=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:document;return t instanceof Element?[t]:t instanceof NodeList?t:e.querySelectorAll(t)};return function(){var r,a,o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:".lozad",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},e=Object.assign({},f,t),i=e.root,n=e.rootMargin,d=e.threshold,u=e.load,g=e.loaded,s=void 0;"undefined"!=typeof window&&window.IntersectionObserver&&(s=new IntersectionObserver((r=u,a=g,function(t,e){t.forEach(function(t){(0<t.intersectionRatio||t.isIntersecting)&&(e.unobserve(t.target),m(t.target)||(r(t.target),A(t.target),a(t.target)))})}),{root:i,rootMargin:n,threshold:d}));for(var c,l=v(o,i),b=0;b<l.length;b++)(c=l[b]).getAttribute("data-placeholder-background")&&(c.style.background=c.getAttribute("data-placeholder-background"));return{observe:function(){for(var t=v(o,i),e=0;e<t.length;e++)m(t[e])||(s?s.observe(t[e]):(u(t[e]),A(t[e]),g(t[e])))},triggerLoad:function(t){m(t)||(u(t),A(t),g(t))},observer:s}}});

</script>
<script type="text/javascript">
var webData =

{ 

   channel : "unit42", //Place the site section the user is in

   property : "unit42.paloaltonetworks.com", //Place domain or sub-domain

   pageType : "blogs",

   language : "en_us",

   pageName : "unit42:Weaponization of Excel Add-Ins Part 1: Malicious XLL Files and Agent Tesla Case Studies", //Place the page name the user is viewing - every page needs a unique page name

   pageURL : "https://unit42.paloaltonetworks.com/excel-add-ins-malicious-xll-files-agent-tesla/" //Place the url the user is viewing with no parameters

}
webData.resourceAssetID = "d91a175f16c16f1a31176457e29e21f9";
if(sessionStorage.getItem("container") && webData){
	webData.container=sessionStorage.getItem("container");
}

</script>
</head>
  <body class="post-template-default single single-post postid-121706 single-format-standard">
    <!--[if IE]>
      <div class="alert alert-warning">
        You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.      </div>
    <![endif]-->
    <style type="text/css">
	.pan-page-alert {
		height: 60px;
	    width: 100%;
	    background-color: #f4f4f2;
	    text-align: center;
	    position: relative;
	    top: 0;
	    left: 0;
	    right: 0;
	    line-height: 20px;
	    display: flex;
	    align-items: center;
	    justify-content: space-between;
	    z-index: 999;
	    padding: 0;
	    display: none;
	}
	.pan-page-alert.open {
		display: flex;
		z-index: 1;
	}
	.pan-page-alert .pan-page-alert-text {
		flex-grow: 1;
	    color: #141414;
	    font-family: Decimal,Arial,"Helvetica Neue",Helvetica,sans-serif;
	    font-style: normal;
	    font-weight: 600;
	    line-height: 20px;
	}
	.pan-page-alert .pan-page-alert-text a {
		color: #bd4122;
		text-decoration: none;
		border-bottom: 2px solid #bd4122;
	}
	.pan-page-alert .pan-page-alert-close {
		margin: 0 15px;
		width: 24px;
		height: 24px;
		border-radius: 24px;
		background-size: contain;
		background-repeat: no-repeat;
		background-position: center;
		/**background-image: url(https://www.paloaltonetworks.com/etc/clientlibs/clean/imgs/x-black.svg);
		 * */
		border: 0;
		background-color: transparent;
	}
	
	@media(max-width: 1199.98px){
		.panClean .pan-page-alert .pan-page-alert-text {
			text-align: left;
			padding-left: calc(7.14285714vw + 15px);
		}
		.pan-page-alert .pan-page-alert-text {
	    	font-size: 14px;
	    }
	}
	.productNav2021Component .btn-light i, .productNav2021Component .btn-outline-light i {
	    width: 20px;
	    height: 20px;
	    margin-left: 15px;
	    flex-grow: 0;
	    flex-shrink: 0;
	    display: inline-block;
	    background-size: contain;
	    background-position: center;
	    background-repeat: no-repeat;
	    background-image: url(https://www.paloaltonetworks.com/etc/clientlibs/clean/imgs/arrow-right-black.svg);
	}
	.productNav2021Component .btn-light, .productNav2021Component .btn-outline-light {
	    display: inline-flex;
	    align-items: center;
	    text-decoration: none;
	    max-width: 100%;
	    text-align: left;
	    background: 0;
	    color: #141414;
	    position: relative;
	}
	.productNav2021Component .btn-light:hover, .productNav2021Component .btn-outline-light:hover {
	    color: #7a7a7a;
	}
	.productNav2021Component .btn{
	   white-space: normal; 
	}
	.productNav2021Component .btn-light:hover i, .productNav2021Component .btn-outline-light:hover i{
	    opacity: .6;
	}
	@media(min-width: 1200px){
		.pan-page-alert .pan-page-alert-text {
	    	font-size: 16px;
	    }
	}
</style>

	<!--<div class="pan-page-alert pan-page-alert-light" id="info-alert-top1">
                <div class="pan-page-alert-text"><a href="https://www.paloaltonetworks.com/russia-ukraine-cyber-resources" target="_blank" style="color:#bd4122;border-color:#bd4122;" data-page-track="true" data-page-track-value="russiaukrainerapidresponse:unit42site:topnav:ticker">Protect Against Russia-Ukraine Cyber Activity</a></div>
		<button type="button" class="pan-page-alert-close" aria-label="page alert close">
            <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M1 1L6 6M6 6L11 1M6 6L1 11M6 6L11 11" stroke="#727272" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
          </button>
    </div>
    <script type="text/javascript">
        
        //Hide/Show top ribbon
          if(localStorage.getItem('top_ribbon_closed') == null){
            document.getElementById('info-alert-top1').classList.add("open");            
          }
          
          $(".pan-page-alert-close").click(function(){
            $("#nav-mobile").css("top", "72px");
          });
          
        $(".pan-page-alert-close").click(function(){
        		$( "#nav-mobile" ).addClass( "add-nav-height" );
  		});
  
          $(document).on('click', '.pan-page-alert .pan-page-alert-close', function (ev) {            
		document.getElementById('info-alert-top1').classList.remove("open");            
		localStorage.setItem('top_ribbon_closed', "yes");
	});
          
    </script>-->
<header class="haeder py-15 position-relative z-index-2" style="display: none;">
  <div class="container px-sm-30 px-35">
    <div class="row">
      <div class="first-logo col-sm-auto col-6 mb-sm-0 mb-40 text-sm-center order-1">
                  <a href="https://www.paloaltonetworks.com/">
<!--<img src="/wp-content/uploads/2019/07/paloaltonetwork.svg" class="attachment-full size-full" alt="" height="43" width="124" />-->
<img src="/wp-content/uploads/2021/07/PANW_Parent.png" width="140px" alt="Logo" />

</a>

      </div>

      <div class="col-sm-auto col-6 text-sm-center order-sm-2 order-4 second-logo-unit">
        <a href="https://unit42.paloaltonetworks.com/">
            <!--<img src="/wp-content/uploads/2019/07/unit42.svg" class="attachment-full size-full" alt="" height="35" width="105" />-->
            <img src="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v5/dist/images/svg/unit42-logo-white.svg" class="attachment-full size-full" alt="Unit42 Logo"  width="150" height="35"/>
        </a>
      </div>

      <div class="col-auto d-sm-none ml-auto mb-40 order-2">
        <button class="btn__search" data-toggle="collapse" data-target="#search" aria-label="search"><i class="ui ui-1"></i></button>
      </div>

      <div id="search" class="collapse d-sm-block col-sm-auto col-12 ml-auto order-3">
        <div class="pt-sm-0 pt-20 pb-sm-0 pb-40 mt-sm-0 mt-n30">
                      <input type="search" placeholder="Search Unit 42" id="innerSearch" class="header__search" value="" required aria-label="Inner Search">
                  </div>
      </div>

      <div class="col-auto d-sm-none d-flex ml-auto align-items-center order-5">
        <button class="btn__menu rounded" data-toggle="collapse" data-target="#navigation">Menu</button>
      </div>
    </div>
  </div>
</header>

<nav id="navigation" class="site-nav collapse d-sm-block pb-20 mt-sm-10"  style="display: none!important;">
  <div class="container px-sm-30">
    <ul id="menu-primary-navigation" class="main-menu d-sm-flex font-weight-medium"><li id="menu-item-97290" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-97290"><a href="https://unit42.paloaltonetworks.com/tools/">Tools</a></li>
<li id="menu-item-41" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-41"><a href="https://unit42.paloaltonetworks.com/atoms/">ATOMs</a></li>
<li id="menu-item-119884" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-119884"><a target="_blank" rel="noopener" href="https://www.paloaltonetworks.com/unit42">Security Consulting</a></li>
<li id="menu-item-81229" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-81229"><a href="https://unit42.paloaltonetworks.com/about-unit-42/">About Us</a></li>
<li id="menu-item-121229" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-121229"><a href="https://start.paloaltonetworks.com/contact-unit42.html"><b style="color:#C84727">Under Attack?</b></a></li>
</ul>  </div>
</nav>
<div class="panClean pan-template-home" id="main-nav-menu-cont" style="display:none;">
    <div class="cleanHeader mainNavigationComp baseComponent parbase">
        <div class="productNav2021Component dark default" id="PAN_2021_NAV_ASYNC"></div>

  </div>
<div class="cleanTopHtml htmlComp baseComponent parbase"><div class="base-component-spacer spacer-none  "></div>
</div>


</div>
<script type="text/javascript">
	function getCookie(cname) {
	 	var name = cname + "=";
  		var decodedCookie = decodeURIComponent(document.cookie);
		var ca = decodedCookie.split(';');
  		for(var i = 0; i <ca.length; i++) {
    			var c = ca[i];
    			while (c.charAt(0) == ' ') {
     				 c = c.substring(1);
    			}
    			if (c.indexOf(name) == 0) {
    				 return c.substring(name.length, c.length);
    			}
  		}
  		return "";
	}

	var referer = "";//sessionStorage.container;
	var pcontainer = sessionStorage.getItem("container");
	var searchResultsPagePath = "";
	/**
	if(document.location.host==='unit42.paloaltonetworks.com'){
		window.initialContainer = "Unit";
		window.supportedContainer = ["Prisma","Sase","Cortex","Unit"];
	}
	**/
	
	
	if(((pcontainer) && pcontainer.indexOf('Prisma')!=-1)){
	    referer = 'Prisma' ;
	}
        else if(((pcontainer) && pcontainer.indexOf('Cortex')!=-1)){
	    referer = 'Cortex' ;
	}
        else if(((pcontainer) && pcontainer.indexOf('Sase')!=-1)){
	    referer = 'Sase' ;
	}
	else if(((pcontainer) && pcontainer.indexOf('Unit')!=-1)){
	    referer = 'Unit' ;
	}
	else if(((pcontainer) && pcontainer.indexOf('Ngfw')!=-1)){
	    referer = 'Ngfw' ;
	}
        var fromRef = document.referrer;
	var nContainer = getCookie("navContainer");
        if(nContainer){//If user is coming from main site, we need to reset the container		
		if(fromRef  && fromRef.indexOf("prismacloud.io")!=-1){
                        referer = 'Prisma' ;
                        sessionStorage.setItem("container","Prisma");
                } else if(fromRef.indexOf("paloaltonetworks.com")!=-1 || fromRef.indexOf("paloaltonetworks.jp")!=-1 ){
                        if(nContainer.indexOf('Prisma') != -1){
                            referer = 'Prisma' ;
                            sessionStorage.setItem("container","Prisma");
                        }
                        if(nContainer.indexOf('Cortex') != -1){
                            referer = 'Cortex' ;
                            sessionStorage.setItem("container","Cortex");
                        }
			if(nContainer.indexOf('Sase') != -1){
                            referer = 'Sase' ;
                            sessionStorage.setItem("container","Sase");
                        }
			if(nContainer.indexOf('Unit') != -1){
                            referer = 'Unit' ;
                            sessionStorage.setItem("container","Unit");
                        }
			if(nContainer.indexOf('Ngfw') != -1){
                            referer = 'Ngfw' ;
                            sessionStorage.setItem("container","Ngfw");
                        }
			document.cookie = 'navContainer=; path=/; domain=.paloaltonetworks.com; expires=' + new Date(0).toUTCString();
		}
	}
    //var referer = "Prisma";//sessionStorage.container;
        console.log("referer"+referer);
        if(referer != "Prisma" && referer != "Cortex" && referer != "Sase" && referer != "Unit" && referer != "Ngfw"){
	    		referer = 'Unit' ;
                sessionStorage.setItem("container","Unit");  		    
	  
        }
function callMainSitePrismaNavHTML(){
    
   //var menu_url = 'https://www.paloaltonetworks.com/_jcr_content/globals/cleanHeaderPrisma.prismaRenderer.html';
   var referrer_domain = 'https://www.paloaltonetworks.com';
   sessionStorage.setItem("domain",referrer_domain);
   if(referer == 'Prisma'){
        var menu_url = referrer_domain+'/_jcr_content/globals/cleanHeaderPrisma.prismaRenderer.html';
		searchResultsPagePath = referrer_domain+"/search/prismasearch";
	    }
    if(referer == 'Cortex'){
        var menu_url = referrer_domain+'/_jcr_content/globals/cleanHeaderCortex.cortexRenderer.html';	
	searchResultsPagePath = referrer_domain+"/search/cortexsearch";	
    }
    if(referer == 'Sase'){
        var menu_url = referrer_domain+'/_jcr_content/globals/cleanHeaderSase.saseRenderer.html';
	searchResultsPagePath = referrer_domain+"/search/sasesearch";
    }
    if(referer == 'Unit'){
        //var menu_url = referrer_domain+'/_jcr_content/globals/cleanHeaderUnit.unitRenderer.html';
	var menu_url = 'https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v5/unit-nav-renderer.php';
	searchResultsPagePath = referrer_domain+"/content/pan/en_US/search/unit42search";
    }
    if(referer == 'Ngfw'){
        //var menu_url = referrer_domain+'/_jcr_content/globals/cleanHeaderNgfw.ngfwRenderer.html';
	var menu_url = 'https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v5/ngfw-cdss-nav-renderer.php';
	searchResultsPagePath = referrer_domain+"/search/ngfwcdsssearch";
    }
    httpGet(menu_url,'menu_html');
    document.getElementById('main-nav-menu-cont').removeAttribute("style");
}
function addStyle(styles) {
              
    /* Create style document */
    var css = document.createElement('style');
    css.type = 'text/css';

    if (css.styleSheet) 
        css.styleSheet.cssText = styles;
    else 
        css.appendChild(document.createTextNode(styles));

    /* Append style to the tag name */
    document.getElementsByTagName("head")[0].appendChild(css);
}
    function httpGet(theUrl,req_type)
    {
        if (window.XMLHttpRequest)
        {// code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp=new XMLHttpRequest();
        }
        else
        {// code for IE6, IE5
            xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlhttp.onreadystatechange=function()
        {
            if (xmlhttp.readyState==4 && xmlhttp.status==200)
            {
                //console.log();
                //return xmlhttp.responseText;
                
                if(req_type == 'menu_html'){
		    var nav_text = xmlhttp.responseText.replaceAll('https://static.cloud.coveo.com/searchui/v2.9159/js/CoveoJsSearch.Lazy.min.js', '');

                    nav_text = nav_text.replaceAll('src="/', 'src="'+maindomain_lang+'/');
		    nav_text = nav_text.replaceAll("'/content", "'"+maindomain_lang+"/content");
		                        
                    document.getElementById("PAN_2021_NAV_ASYNC").innerHTML = nav_text.replaceAll('href="/', 'href="'+maindomain_lang+'/');
		    
		    var lozad_back = document.getElementsByClassName('lozad-background');
		    Array.prototype.forEach.call(lozad_back, function(el) {
			// Do stuff here
			var el_back_img_path = el.getAttribute('data-background-image');
			var first_pos = el_back_img_path.indexOf("'");
			var last_pos = el_back_img_path.indexOf("'",first_pos+1);
			el_back_img_path = el_back_img_path.substring(first_pos+1,last_pos);
			el.setAttribute("data-background-image",main_site_url+el_back_img_path);
		    });
                }
                if(req_type == 'head_inline_css'){
                    addStyle(xmlhttp.responseText);
                }
                //document.getElementsByTagName("header")[1].removeAttribute("style");
                //document.getElementsByTagName("header")[1].classList.add("light");
            }
        }
        xmlhttp.open("GET", theUrl, false );
        xmlhttp.send();    
    }    
    
    if(referer == 'Prisma' || referer == 'Cortex' || referer == 'Sase' || referer == 'Unit' || referer == 'Ngfw'){
        const article = document.querySelector('#PAN_2021_NAV_ASYNC');
        if(referer == 'Prisma'){
            article.dataset.type = 'prisma';
	    $('#PAN_2021_NAV_ASYNC').removeClass('default').addClass('defaultRedesigned');
        }
        else if(referer == 'Cortex'){
            article.dataset.type = 'cortex';
        }
        else if(referer == 'Sase'){
            article.dataset.type = 'sase';
        }
	else if(referer == 'Unit'){
            article.dataset.type = 'unit';
        }
	else if(referer == 'Ngfw'){
            article.dataset.type = 'ngfw';
        }
	//set class to default
	if(referer == 'Unit' || referer == 'Ngfw'){
	   
	   $('#PAN_2021_NAV_ASYNC').removeClass('default').addClass('defaultRedesigned');
	}
        callMainSitePrismaNavHTML();        
    }
</script>


  <article class="article overflow-hidden">
    
<header class="article__header py-sm-25 pt-40 pb-25 bg-gray-700">
  <div class="container">
    
    <h1 class="article__header__title mb-sm-30 mb-40">Weaponization of Excel Add-Ins Part 1: Malicious XLL Files and Agent Tesla Case Studies</h1>

    <ul class="article__entry-meta d-flex flex-wrap align-items-center text-black">
      <li class="mr-10 mb-10 px-20 rounded-pill d-flex bg-gray-200"><div class="post-views content-post post-121706 entry-meta">
				<span class="post-views-count">67,626</span>
			</div> <span class="ml-5">people reacted</span></li>
      <li class="d-sm-none col-12 p-0"></li>
      <li class="mr-10 mb-10 px-20 rounded-pill bg-gray-200"><span class="ldc-ul_cont idc_ul_cont_not_liked_inner" onclick="alter_ul_post_values(this,'121706','like')"><i class="ui ui-2"></i><span class="ml-5">8</span></span></li>
      <li class="mb-10 px-20 rounded-pill bg-gray-200"><span class="span-reading-time rt-reading-time"><span class="rt-label rt-prefix"></span> <span class="rt-time"> 8</span> <span class="rt-label rt-postfix"></span></span> min. read</li>
    </ul>

    <div class="article__share position-relative">
      <div class="dropdown dropdown-right">
        <button type="button" class="px-25 text-black bg-white text-uppercase rounded-pill" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Share <i class="ui ui-6 ml-10 align-text-top"></i>
        </button>
        <div class="dropdown-menu rounded-pill" role="toolbar">
          <div class="share-dropdown px-20 py-10 text-black font-size-sm">
            <div class="row align-items-center flex-nowrap">
              <div class="col">
                <div class="d-flex align-items-center">
                  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Funit42.paloaltonetworks.com%2Fexcel-add-ins-malicious-xll-files-agent-tesla%2F" target="_blank" aria-label="facebbok"><i class="ui ui-7"></i></a>
                  <a href="https://twitter.com/home?status=https%3A%2F%2Funit42.paloaltonetworks.com%2Fexcel-add-ins-malicious-xll-files-agent-tesla%2F+-+Weaponization+of+Excel+Add-Ins+Part+1%3A+Malicious+XLL+Files+and+Agent+Tesla+Case+Studies" target="_blank" aria-label="twitter"><i class="ui ui-8"></i></a>
                  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Funit42.paloaltonetworks.com%2Fexcel-add-ins-malicious-xll-files-agent-tesla%2F&title=Weaponization+of+Excel+Add-Ins+Part+1%3A+Malicious+XLL+Files+and+Agent+Tesla+Case+Studies&summary=&source=" target="_blank" aria-label="linkedin"><i class="ui ui-9"></i></a>
                  <a href="//www.reddit.com/submit?url=https://unit42.paloaltonetworks.com/excel-add-ins-malicious-xll-files-agent-tesla/" target="_blank" aria-label="reddit"><i class="ui ui-10"></i></a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>    <div class="article__summary py-25 text-gray-500 font-size-sm">
  <div class="container">
    <div class="row align-items-center no-gutters">
      <div class="col-sm-auto col-12 mb-sm-0 mb-35">
        <i class="ui ui-11 text-gray-700 mr-sm-20"></i>
      </div>
  
      <div class="col-sm col-12">
        <p>
          By <a href="https://unit42.paloaltonetworks.com/author/yaron-samuel/" title="Posts by Yaron Samuel" class="author url fn" rel="author">Yaron Samuel</a>        </p>
        <p><time datetime="2022-01-25T14:00:56+00:00">January 25, 2022 at 6:00 AM</time></p>
        <p>Category: <a href="https://unit42.paloaltonetworks.com/category/malware-2/" rel="category tag">Malware</a></p>
        <p>Tags: <a href="https://unit42.paloaltonetworks.com/tag/agenttesla/" rel="tag">AgentTesla</a>, <a href="https://unit42.paloaltonetworks.com/tag/cortex/" rel="tag">Cortex</a>, <a href="https://unit42.paloaltonetworks.com/tag/dridex/" rel="tag">Dridex</a>, <a href="https://unit42.paloaltonetworks.com/tag/macros/" rel="tag">Macros</a>, <a href="https://unit42.paloaltonetworks.com/tag/microsoft-excel/" rel="tag">Microsoft Excel</a>, <a href="https://unit42.paloaltonetworks.com/tag/next-generation-firewall/" rel="tag">next-generation firewall</a>, <a href="https://unit42.paloaltonetworks.com/tag/wildfire/" rel="tag">WildFire</a></p>
      </div>
    </div>
  </div>
</div>    <div class="py-30 bg-white">
      <div class="container">
        <div class="article__content pb-30">
                      <figure class="mb-30 text-center">
              <img width="600" height="300" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2022/01/Unit42-blog-2by1-characters-r4d1-2020_Targeted-Attacks-v1.png" class="attachment-single size-single" alt="A conceptual image representing targeted attacks, including the type of malware discussed here, dropped by Excel add-ins and Office 4.0 macros." decoding="async" loading="lazy" />            </figure>
                    <p class="wpml-ls-statics-post_translations wpml-ls">This post is also available in: 
    <span class="wpml-ls-slot-post_translations wpml-ls-item wpml-ls-item-ja wpml-ls-first-item wpml-ls-last-item wpml-ls-item-legacy-post-translations"><a href="https://unit42.paloaltonetworks.jp/excel-add-ins-malicious-xll-files-agent-tesla/" class="wpml-ls-link"><span class="wpml-ls-native" lang="ja"></span><span class="wpml-ls-display"><span class="wpml-ls-bracket"> (</span>Japanese<span class="wpml-ls-bracket">)</span></span></a></span></p><h2><a id="post-121706-_s5vfxaxh5n4c"></a>Executive Summary</h2>
<p>Between July 27 and Dec. 1, 2021, Unit 42 researchers observed a new surge of Agent Tesla and Dridex malware samples, which have been dropped by Excel add-ins (XLL) and Office 4.0 macros. We have found that the Excel 4.0 macro dropper is mainly used to drop Dridex, while the XLL droppers are used to drop both Agent Tesla and Dridex. While malicious XLL files have been known for quite some time, their reappearance in the threat landscape is a new trend and possibly indicates a shift toward this infection vector.</p>
<p>The XLL files we observed were mainly distributed via emails that contain price quote luring contents sent from an abcovid[.]tech email address with the email subject INQUIRY. Targets of these emails include organizations in the following sectors: manufacturing; retail; federal, state and local government; finance; pharmaceuticals; transportation; education; and several others across the United States, Europe and Southeast Asia. Furthermore, some of the malicious XLL files we have seen abuse a legitimate open-source Excel add-in framework named <a href="https://excel-dna.net/">Excel-DNA</a>.</p>
<p>This blog is the first of a two-part series. Here, we take a look into the XLL file attributes, the abused legitimate open-source framework and the final Agent Tesla payload. The second part of the series will deal with the other infection flows, the XLL and Excel 4 (XLM) droppers that deliver Dridex samples.</p>
<p>Palo Alto Networks customers receive protections against the attacks discussed here through <a href="https://www.paloaltonetworks.com/cortex/cortex-xdr">Cortex XDR</a> or the <a href="https://www.paloaltonetworks.com/products/secure-the-network/wildfire">WildFire</a> cloud-delivered security subscription for the <a href="https://www.paloaltonetworks.com/network-security/next-generation-firewall">Next-Generation Firewall</a>.</p>
<table style="width: 101.716%;">
<tbody>
<tr>
<td style="width: 52.4355%;"><span style="font-weight: 400;">Types of Attacks Covered</span></td>
<td style="width: 348.711%;"><a href="https://unit42.paloaltonetworks.com/category/malware-2/"><span style="font-weight: 400;">Malware</span></a><span style="font-weight: 400;">, </span><a href="https://unit42.paloaltonetworks.com/tag/agenttesla/"><span style="font-weight: 400;">Agent Tesla</span></a></td>
</tr>
<tr>
<td style="width: 52.4355%;"><span style="font-weight: 400;">Related Unit 42 Topics</span></td>
<td style="width: 348.711%;"><a href="https://unit42.paloaltonetworks.com/tag/dridex/"><span style="font-weight: 400;">Dridex</span></a><span style="font-weight: 400;">, </span><a href="https://unit42.paloaltonetworks.com/tag/macros/"><span style="font-weight: 400;">Macros</span></a></td>
</tr>
</tbody>
</table>
<h2><a id="post-121706-_ityilpf6fsuw"></a>Table of Contents</h2>
<p><a href="#Chains-of-Infection">Chains of Infection</a><br />
<a href="#What-Is-XLL-Again?">What Is XLL Again?</a><br />
<a href="#Malicious-Excel-Add-In-(XLL)-Dropper">Malicious Excel Add-In (XLL) Dropper</a><br />
 <a href="#Excel-DNA">Excel-DNA</a><br />
 <a href="#Jack-Resource">Jack Resource</a><br />
<a href="#Final-Payload-Agent-Tesla">Final Payload Agent Tesla</a><br />
 <a href="#String-Decryption">String Decryption</a><br />
 <a href="#Windows-Vault">Windows Vault</a><br />
<a href="#Conclusion">Conclusion</a><br />
<a href="#Indicators-of-Compromise">Indicators of Compromise</a><br />
<a href="#Additional-Resources">Additional Resources</a><br />
<a href="#Appendix-A-Deobfuscated-Code-of-the-Function-That-Reads-Windows-Vault">Appendix A: Deobfuscated Code of the Function That Reads Windows Vault</a></p>
<h2><a id="Chains-of-Infection"></a>Chains of Infection</h2>
<p>The flow chart in Figure 1 shows the two possible chains of events we have observed during our investigation:</p>
<ul>
<li>A victim receives an email with a malicious attachment.</li>
<li>The attachment is either a malicious XLL or XLM file.</li>
<li>In the case of an XLL, when run it will either:
<ul>
<li>Drop an intermediate dropper that in turn will drop an Agent Tesla payload.</li>
<li>Download <a href="https://yoroi.company/research/office-documents-may-the-xll-technique-change-the-threat-landscape-in-2022/">Agent Tesla payload from Discord</a>.</li>
<li>Download Dridex payload from Discord.</li>
</ul>
</li>
<li>In the case of an XLM, when run it will drop a VBS downloader that downloads and executes a Dridex sample from Discord.</li>
</ul>
<p>While Agent Tesla and Dridex infection chains are not necessarily distributed by the same actor, they seem to be part of a new trend of infection vectors.</p>
<figure id="attachment_121709" aria-describedby="caption-attachment-121709" style="width: 746px" class="wp-caption aligncenter"><img decoding="async" fetchpriority="high" class="wp-image-121709" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2022/01/word-image.jpeg" alt="The flow chart shows two possible chains of infections observed recently. Flow 1 concerns a piece of malspam that drops an XLL file. From there, it may drop an Agent Tesla payload or download an Agent Tesla or Dridex payload from Discord. Flow 2 concerns an XLM file. When run, it will drop a VBS downloader that downloads and executes a Dridex sample from Discord. " width="746" height="741" /><figcaption id="caption-attachment-121709" class="wp-caption-text">Figure 1. Chains of infection.</figcaption></figure>
<h2><a id="What-Is-XLL-Again?"></a>What Is XLL Again?</h2>
<p>XLL is an extension for Excel add-ins. In reality, XLL is just a regular PE-DLL file. The XLL file extension is associated with an icon very similar to other Excel-supported extensions. In turn, the average user wont notice any difference between XLL and other Excel file formats and can be lured to open it. This may be surprising, but Excel will gladly load and execute an XLL file upon double-clicking.</p>
<figure id="attachment_121711" aria-describedby="caption-attachment-121711" style="width: 88px" class="wp-caption aligncenter"><img decoding="async" class="wp-image-121711" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2022/01/word-image-68.png" alt="The XLL icon as it appears on a user's desktop. " width="88" height="94" /><figcaption id="caption-attachment-121711" class="wp-caption-text">Figure 2. XLL icon.</figcaption></figure>
<p>Once the XLL is loaded by Excel, it will invoke the export functions of the XLL file based on the defined <a href="https://docs.microsoft.com/en-us/office/client-developer/excel/add-in-manager-and-xll-interface-functions">XLL interface</a>. Two of these interface functions stand out: <span style="font-family: 'courier new', courier, monospace;">xlAutoOpen</span> and <span style="font-family: 'courier new', courier, monospace;">xlAutoClose</span>. These functions get called once the add-in gets activated or deactivated, respectively. These functions can be used to load malicious code, similar to the methods <span style="font-family: 'courier new', courier, monospace;">Auto_Open</span> and <span style="font-family: 'courier new', courier, monospace;">Auto_Close</span> in classic VBA macros.</p>
<p>One disadvantage of XLL files is that they can only be loaded by Excel with the correct bitness. For example, a 64-bit XLL can only be loaded by the 64-bit version of Excel. The same goes for 32-bit versions. Therefore, malware authors have to rely on the Excel version that is installed on the victims machine.</p>
<p>Like with VBA macros, Excel will warn the user about the security concern arising from executing the add-in. In that aspect, it has no advantage for malware compared to VBA macros.</p>
<figure id="attachment_121713" aria-describedby="caption-attachment-121713" style="width: 430px" class="wp-caption aligncenter"><img decoding="async" class="wp-image-121713" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2022/01/word-image-69.png" alt="The screenshot shows an example of a warning from Excel while trying to execute an XLL file. The alert says, &quot;Microsoft Office has identified a potential security concern.&quot; It warns that no digital signature is available and displays the file path. The user has the option to enable the add-in or leave it disabled. " width="430" height="244" /><figcaption id="caption-attachment-121713" class="wp-caption-text">Figure 3. Warning by Excel while trying to execute an XLL file.</figcaption></figure>
<p>For the reasons described, XLL files can be a good choice for adversaries seeking to gain an initial foothold on a victim machine. An attacker can get code packaged into a DLL loaded by Excel, which in turn may mislead security products that are not prepared to deal with this scenario.</p>
<p>Figure 4 shows an example of an XLL file in a PE editor. Among other exported functions, we can find the <span style="font-family: 'courier new', courier, monospace;">xlAutoOpen</span> and <span style="font-family: 'courier new', courier, monospace;">xlAutoClose</span> functions.</p>
<figure id="attachment_121715" aria-describedby="caption-attachment-121715" style="width: 853px" class="wp-caption aligncenter"><img decoding="async" loading="lazy" class="wp-image-121715" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2022/01/word-image-70.png" alt="The screenshot shows an example of an XLL file in a PE editor. Among other exported functions, we can find the xlAutoOpen and xlAutoClose functions. " width="853" height="739" /><figcaption id="caption-attachment-121715" class="wp-caption-text">Figure 4. Excel add-in exports as shown by the PE header editor CFF Explorer.</figcaption></figure>
<h2><a id="Malicious-Excel-Add-In-(XLL)-Dropper"></a>Malicious Excel Add-In (XLL) Dropper</h2>
<p>We have observed malicious emails with the following XLL samples attached:</p>
<p>SHA256: <span style="font-family: 'courier new', courier, monospace;">7a6f8590d4be989faccb34cd393e713fd80fa17e92d7613f33061d647d0e6d12<br />
</span>SHA256: <span style="font-family: 'courier new', courier, monospace;">fbc94ba5952a58e9dfa6b74fc59c21d830ed4e021d47559040926b8b96a937d0</span></p>
<h3><a id="Excel-DNA"></a>Excel-DNA</h3>
<p>The XLL sample we encountered utilizes a legitimate open-source framework for Excel add-in development called <a href="https://excel-dna.net/">Excel-DNA</a>. The framework has several features that also suit malware authors. One is the ability to load a compressed .NET assembly packaged in the PE resources directly to memory without touching the disk. Therefore, despite being a legitimate framework, Excel-DNA has functionality that resembles malicious loaders and can be abused as a loader.</p>
<p>Excel-DNA has another attribute that may hinder coverage with Yara, likely unknown even to the malware authors. For some reason, many Excel-DNA samples have slightly more than 10,000 exported functions, most of them without any meaningful functionality. The Yara PE module export function parsing limit is only <a href="https://github.com/VirusTotal/yara/blob/master/libyara/modules/pe/pe.c#L98">8,192</a>. Therefore, a Yara rule that targets a certain export name located at an index higher than 8192 will not match against the sample.</p>
<p>When we look at the resources of our Excel-DNA XLL, we can see an XML resource named <span style="font-family: 'courier new', courier, monospace;">__MAIN__</span>. This resource contains information about which module gets loaded by Excel-DNA. In our case, the specified module will be decompressed from a resource named <span style="font-family: 'courier new', courier, monospace;">JACK</span>.</p>
<p>The resource will be decompressed using the LZMA algorithm and subsequently loaded to memory.</p>
<figure id="attachment_121717" aria-describedby="caption-attachment-121717" style="width: 520px" class="wp-caption aligncenter"><img decoding="async" loading="lazy" class="wp-image-121717" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2022/01/word-image-71.png" alt="When we look at the resources of our Excel-DNA XLL, we can see an XML resource named __MAIN__. This resource contains information about which module gets loaded by Excel-DNA. In our case, the specified module will be decompressed from a resource named JACK." width="520" height="427" /><figcaption id="caption-attachment-121717" class="wp-caption-text">Figure 5. Excel-DNA resources.</figcaption></figure>
<p>We have created Python code for the extraction of such assemblies from an Excel-DNA add-in. You can find this script on the<a href="https://github.com/pan-unit42/iocs/tree/master/agent_tesla"> Unit 42 GitHub repo</a>.</p>
<h3><a id="Jack-Resource"></a><span style="font-family: georgia, palatino, serif;">JACK</span> Resource</h3>
<p>The loaded module is a simple dropper. Upon loading the module, the <span style="font-family: 'courier new', courier, monospace;">AutoOpen</span> method will be invoked. The malicious code in this method drops the final payload executable into <span style="font-family: 'courier new', courier, monospace;">%AppData%\service.exe</span> and executes it (see Figure 6). Its worth noting that the module contained in <span style="font-family: 'courier new', courier, monospace;">Jack</span> is configurable, meaning in other versions it may download a payload instead of dropping it, as well as dropping a real Excel template and executing it.</p>
<p>The configuration is displayed in Figure 7, which contains the following options:</p>
<ul>
<li><span style="font-family: 'courier new', courier, monospace;">bDown</span> - Download the payload.</li>
<li><span style="font-family: 'courier new', courier, monospace;">templateEnabled</span> - Drop and open an Excel template.</li>
<li><span style="font-family: 'courier new', courier, monospace;">payload</span> - Contains the payload to be dropped.</li>
</ul>
<figure id="attachment_121719" aria-describedby="caption-attachment-121719" style="width: 652px" class="wp-caption aligncenter"><img decoding="async" loading="lazy" class="wp-image-121719" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2022/01/word-image-72.png" alt="The loaded module is a simple dropper. Upon loading the module, the AutoOpen method will be invoked. The malicious code in this method drops the final payload executable into %AppData%\service.exe and executes it." width="652" height="374" /><figcaption id="caption-attachment-121719" class="wp-caption-text">Figure 6. Decompiled code of the JACK dropper module with the AutoOpen method, as shown by dnSpy.</figcaption></figure>
<figure id="attachment_121721" aria-describedby="caption-attachment-121721" style="width: 329px" class="wp-caption aligncenter"><img decoding="async" loading="lazy" class="wp-image-121721" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2022/01/word-image-73.png" alt="The configuration is displayed here, containing the following options: bDown - Download the payload, templateEnabled - Drop and open an Excel template, payload - Contains the payload to be dropped." width="329" height="330" /><figcaption id="caption-attachment-121721" class="wp-caption-text">Figure 7. Dropper configuration variables and the final payload contained in a byte array.</figcaption></figure>
<h2><a id="Final-Payload-Agent-Tesla"></a>Final Payload  Agent Tesla</h2>
<p>SHA256: <span style="font-family: 'courier new', courier, monospace;">AB5444F001B8F9E06EBF12BC8FDC200EE5F4185EE52666D69F7D996317EA38F3</span></p>
<p>The final payload is an obfuscated Agent Tesla sample. In terms of features, Agent Tesla is <a href="https://news.sophos.com/en-us/2021/02/02/agent-tesla-amps-up-information-stealing-attacks/">extensively</a> <a href="https://www.fortinet.com/blog/threat-research/new-agent-tesla-variant-spreading-by-phishing">documented</a>. Our sample exfiltrates the stolen data to the email <span style="font-family: 'courier new', courier, monospace;">phantom1248@yandex[.]com</span> using the SMTP protocol. Figure 8 shows the decompiled entry point of our Agent Tesla sample. It is structured in a similar way to other Agent Tesla samples.</p>
<figure id="attachment_121723" aria-describedby="caption-attachment-121723" style="width: 874px" class="wp-caption aligncenter"><img decoding="async" loading="lazy" class="wp-image-121723" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2022/01/word-image-74.png" alt="This shows the decompiled entry point of our Agent Tesla sample. It is structured in a similar way to other Agent Tesla samples." width="874" height="455" /><figcaption id="caption-attachment-121723" class="wp-caption-text">Figure 8. Agent Teslas decompiled main function.</figcaption></figure>
<h3><a id="String-Decryption"></a>String Decryption</h3>
<p>The Agent Tesla sample stores all of its strings in an encrypted form within a large array of characters.</p>
<p>Upon initialization, the sample XORs each byte of the large byte array with the hard coded byte 170 and the index (trimmed to byte size) of the character in the large byte array. Next, the sample fills an array that stores all the strings, by splicing the decrypted array in known offsets and corresponding lengths. For instance, lets examine the eight bytes in the offset 665:</p>
<table style="width: 100.68%;">
<tbody>
<tr>
<td style="width: 58.6667%;"><span style="font-weight: 400;">Before execution (encrypted form)</span></td>
<td style="width: 174.167%;"><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">28, 92, 94, 81, 25, 64, 88, 122</span></td>
</tr>
<tr>
<td style="width: 58.6667%;"><span style="font-weight: 400;">Upon initialization</span></p>
<p><span style="font-weight: 400;">(after decryption, XORed with the index and </span><span style="font-weight: 400;">170</span><span style="font-weight: 400;">)</span></td>
<td style="width: 174.167%;"><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">47, 108, 111, 103, 46, 116, 109, 112</span></td>
</tr>
<tr>
<td style="width: 58.6667%;"><span style="font-weight: 400;">ASCII form after decryption</span></td>
<td style="width: 174.167%;"><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">/log.tmp</span></td>
</tr>
</tbody>
</table>
<p>The code below assigns the <strong>53</strong>rd member of the strings array the eight bytes at offset 665 of the decrypted byte-array.</p>
<figure id="attachment_121725" aria-describedby="caption-attachment-121725" style="width: 900px" class="wp-caption aligncenter"><img decoding="async" loading="lazy" class="wp-image-121725" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2022/01/word-image-75.png" alt="The code shown here assigns the 53rd member of the string's array the eight bytes at offset 665 of the decrypted byte-array. " width="900" height="83" /><figcaption id="caption-attachment-121725" class="wp-caption-text">Figure 9. String assignment code.</figcaption></figure>
<p>Examining the decrypted string array reveals the various targets that Agent Tesla aims to steal:</p>
<ul>
<li>Sensitive browser information and cookies.</li>
<li>Mail, FTP and VPN client information.</li>
<li>Credentials from Windows Vault.</li>
<li>Recorded keystrokes and screenshots.</li>
<li>Clipboard information.</li>
</ul>
<h3><a id="Windows-Vault"></a>Windows Vault</h3>
<p>To steal information from the Windows Vault, it appears that the Agent Tesla authors converted a <a href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Exfiltration/Get-VaultCredential.ps1#L265">PowerSploit script</a> into C# to build a .NET assembly.</p>
<p>It uses <a href="https://docs.microsoft.com/en-us/dotnet/standard/native-interop/pinvoke">P/Invoke</a> to call API functions from the <span style="font-family: 'courier new', courier, monospace;">vaultcli.dll</span> library. At first, <span style="font-family: 'courier new', courier, monospace;">VaultEnumerateItems</span> will be called to get all available vaults. Next, each vault will be opened using <span style="font-family: 'courier new', courier, monospace;">VaultOpenVault</span>. Once a vault is open, the contained items will be enumerated using <span style="font-family: 'courier new', courier, monospace;">VaultEnumerateItems</span>. Finally, the attributes of the items are read using <span style="font-family: 'courier new', courier, monospace;">VaultGetItem</span>. Agent Tesla records the queries as items in its own list (manually deobfuscated code shown in Figure 10). The curious reader can find the fully deobfuscated method in Appendix A.</p>
<figure id="attachment_121727" aria-describedby="caption-attachment-121727" style="width: 818px" class="wp-caption aligncenter"><img decoding="async" loading="lazy" class="wp-image-121727" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2022/01/word-image-76.png" alt="Deobfuscated Agent Tesla code for recording extracted Windows Vault items." width="818" height="225" /><figcaption id="caption-attachment-121727" class="wp-caption-text">Figure 10. Deobfuscated Agent Tesla code for recording extracted Windows Vault items.</figcaption></figure>
<p>Below is the list of Windows Vault GUIDs (and corresponding descriptions) that Agent Tesla uses to steal information:</p>
<table style="width: 99.1485%;">
<tbody>
<tr>
<td style="width: 53.8217%;"><strong>GUID</strong></td>
<td style="width: 167.834%;"><strong>Description</strong></td>
</tr>
<tr>
<td style="width: 53.8217%;"><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">2F1A6504-0641-44CF-8BB5-3612D865F2E5</span></td>
<td style="width: 167.834%;"><span style="font-weight: 400;">Windows Secure Note</span></td>
</tr>
<tr>
<td style="width: 53.8217%;"><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">3CCD5499-87A8-4B10-A215-608888DD3B55</span></td>
<td style="width: 167.834%;"><span style="font-weight: 400;">Windows Web Password Credential</span></td>
</tr>
<tr>
<td style="width: 53.8217%;"><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">154E23D0-C644-4E6F-8CE6-5069272F999F</span></td>
<td style="width: 167.834%;"><span style="font-weight: 400;">Windows Credential Picker Protector</span></td>
</tr>
<tr>
<td style="width: 53.8217%;"><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">4BF4C442-9B8A-41A0-B380-DD4A704DDB28</span></td>
<td style="width: 167.834%;"><span style="font-weight: 400;">Web Credentials</span></td>
</tr>
<tr>
<td style="width: 53.8217%;"><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">77BC582B-F0A6-4E15-4E80-61736B6F3B29</span></td>
<td style="width: 167.834%;"><span style="font-weight: 400;">Windows Credentials</span></td>
</tr>
<tr>
<td style="width: 53.8217%;"><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">E69D7838-91B5-4FC9-89D5-230D4D4CC2BC</span></td>
<td style="width: 167.834%;"><span style="font-weight: 400;">Windows Domain Certificate Credential</span></td>
</tr>
<tr>
<td style="width: 53.8217%;"><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">3E0E35BE-1B77-43E7-B873-AED901B6275B</span></td>
<td style="width: 167.834%;"><span style="font-weight: 400;">Windows Domain Password Credential</span></td>
</tr>
<tr>
<td style="width: 53.8217%;"><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">3C886FF3-2669-4AA2-A8FB-3F6759A77548</span></td>
<td style="width: 167.834%;"><span style="font-weight: 400;">Windows Extended Credential</span></td>
</tr>
</tbody>
</table>
<h2><a id="Conclusion"></a>Conclusion</h2>
<p>For the recent surge of malware we observed, we analyzed the infection chain that uses Excel add-ins (XLL). We also described how the malware author abuses the legitimate Excel-DNA framework for the creation of these malicious XLLs. Lastly, we briefly described the final Agent Tesla payload and which information it tries to exfiltrate from a victims system, with a focus on the Windows Vault data. The usage of Excel add-ins in recent attacks may indicate a new trend in the threat landscape.</p>
<p>In the next part of this series, we will describe the other infection chain, which involves using Excel 4.0 macros to deliver Dridex.</p>
<p>Palo Alto Networks customers receive protections against the attacks discussed here through <a href="https://www.paloaltonetworks.com/cortex/cortex-xdr">Cortex XDR</a> or the <a href="https://www.paloaltonetworks.com/products/secure-the-network/wildfire">WildFire</a> cloud-delivered security subscription for the <a href="https://www.paloaltonetworks.com/network-security/next-generation-firewall">Next-Generation Firewall</a>.</p>
<p>If you think you may have been compromised or have an urgent matter, get in touch with the <a href="https://start.paloaltonetworks.com/contact-unit42.html">Unit 42 Incident Response team</a> or call North America Toll-Free: 866.486.4842 (866.4.UNIT42), EMEA: +31.20.299.3130, APAC: +65.6983.8730, or Japan: +81.50.1790.0200.</p>
<p><span style="font-weight: 400;">Palo Alto Networks has shared these findings, including file samples and indicators of compromise, with our fellow Cyber Threat Alliance members. CTA members use this intelligence to rapidly deploy protections to their customers and to systematically disrupt malicious cyber actors. Learn more about the </span><a href="https://www.cyberthreatalliance.org"><span style="font-weight: 400;">Cyber Threat Alliance</span></a><span style="font-weight: 400;">. </span></p>
<h3><a id="Indicators-of-Compromise"></a>Indicators of Compromise</h3>
<table style="width: 101.004%; height: 280px;">
<tbody>
<tr style="height: 56px;">
<td style="width: 74.0291%; height: 56px;"><strong>Sample hash (SHA256)</strong></td>
<td style="width: 95.8738%; height: 56px;"><span style="font-weight: 400;"><strong>Description</strong></span></td>
</tr>
<tr style="height: 56px;">
<td style="width: 74.0291%; height: 56px;"><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">7a6f8590d4be989faccb34cd393e713fd80fa17e92d7613f33061d647d0e6d12</span></td>
<td style="width: 95.8738%; height: 56px;"><span style="font-weight: 400;">XLL dropper</span></td>
</tr>
<tr style="height: 56px;">
<td style="width: 74.0291%; height: 56px;"><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">fbc94ba5952a58e9dfa6b74fc59c21d830ed4e021d47559040926b8b96a937d0</span></td>
<td style="width: 95.8738%; height: 56px;"><span style="font-weight: 400;">XLL dropper</span></td>
</tr>
<tr style="height: 56px;">
<td style="width: 74.0291%; height: 56px;"><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">bfc32aab4f7ec31e03a723e0efd839afc2f861cc615a889561b38430c396dcfe</span></td>
<td style="width: 95.8738%; height: 56px;"><span style="font-weight: 400;">Intermediate dropper (Jack)</span></td>
</tr>
<tr style="height: 56px;">
<td style="width: 74.0291%; height: 56px;"><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">AB5444F001B8F9E06EBF12BC8FDC200EE5F4185EE52666D69F7D996317EA38F3</span></td>
<td style="width: 95.8738%; height: 56px;"><span style="font-weight: 400;">Final Agent Tesla payload</span></td>
</tr>
</tbody>
</table>
<h3><a id="Additional-Resources"></a>Additional Resources</h3>
<ul>
<li><a href="https://blogs.blackberry.com/en/2021/06/threat-thursday-agent-tesla-infostealer-malware">Agent Tesla Infostealer</a> - ThreatVector Blog, BlackBerry</li>
<li><a href="https://news.sophos.com/en-us/2021/02/02/agent-tesla-amps-up-information-stealing-attacks/">Agent Tesla amps up information stealing attacks</a> - Sophos</li>
</ul>
<h3><a id="Appendix-A-Deobfuscated-Code-of-the-Function-That-Reads-Windows-Vault"></a>Appendix A: Deobfuscated Code of the Function That Reads Windows Vault</h3>
<p>See more information on <a href="https://github.com/pan-unit42/iocs/tree/master/agent_tesla">GitHub</a>.</p>
<p>&nbsp;</p>
          <div class="article__subscribe mb-40 text-gray-400 bg-gray-200 rounded-lg">
  <h4 class="h3 mb-10 text-black">Get updates from <br class="d-sm-none"> Palo Alto<br class="d-sm-none"> Networks!</h4>
  <p>Sign up to receive the latest news, cyber threat intelligence and research from us</p>
  <!-- <form action="https://app-guse4001.marketo.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe"> -->
  <form action="https://www.paloaltonetworks.com/apps/pan/public/formsubmithandler.submitform.json" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe">
    <input type="hidden" name="emailFormMask" value="">
    <input type="hidden" value="1086" name="formid">
    <!-- <input type="hidden" value="818-CZC-273" name="munchkinId"> -->
    <input type="hidden" value="531-OCS-018" name="munchkinId">
    <input type="hidden" value="2141" name="lpId">
	<input type="hidden" value="1203" name="programId">  
    <input type="hidden" value="1086" name="formVid">
    <input type="hidden" name="mkto_optinunit42" value="true">
    <input type="hidden" name="mkto_opt-in" value="true">
    <div class="row">
      <div class="col-sm col-12 mb-sm-0 mb-15">
        <input type="email" name="Email" placeholder="Email address" class="subscribe-field d-block w-100 px-sm-25 px-15 bg-white" aria-label="Email">
        <p class="error-mail d-none mt-15 text-danger" style="color: #dc3545">Please enter your email address!</p>
      </div>
      <div class="col-sm-auto col-12">
          <input type="submit" value="Subscribe" class="btn btn--black btn--sm w-100" disabled="disabled">
      </div>
    </div>

    <div class="google-recapth mt-15">
      <div class="g-recaptcha" data-expired-callback="captchaExpires" data-callback="captchaComplete" data-sitekey="6Lc5EhgTAAAAAJa-DzE7EeWABasWg4LKv-R3ao6o"></div>
      <p class="error-recaptcha d-none mt-15 text-danger" style="color: #dc3545">Please mark, I'm not a robot!</p>
    </div>
  </form>

  <div class="font-size-ex-sm col-sm-7 p-0">
    <p>By submitting this form, you agree to our <a href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a> and acknowledge our <a href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy Statement</a>.</p>
  </div>
</div>


        </div>
      </div>
    </div>
  </article>
<footer class="site-footer px-sm-0 px-15">
  <div class="pt-40">
    <div class="container pt-sm-30">
      <div class="row justify-content-lg-center">
        <div class="col-lg-11 col-12">
          <div class="row">
            <div class="col-lg-4 col-sm-3 col-12 order-sm-2">
              <nav class="footer-socials mb-sm-0 mb-25 text-white text-sm-right" aria-label="Footer Socials">
                                                <a href="https://twitter.com/Unit42_Intel" target="_blank" aria-label="Twitter"><span class="ui ui-4"></span></a>
                <a href="https://github.com/pan-unit42" target="_blank" aria-label="Github"><span class="ui ui-5"></span></a>
              </nav>
            </div>

            <div class="col-lg-8 col-sm-9 col-12 order-sm-1">
              <div class="row">
                <div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Popular Resources</h4><div class="menu-footer-company-phase-container"><ul id="menu-footer-company-phase" class="menu"><li id="menu-item-97096" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97096"><a target="_blank" href="https://www.paloaltonetworks.com/resources">Resource Center</a></li>
<li id="menu-item-97097" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97097"><a target="_blank" href="https://www.paloaltonetworks.com/blog/">Blog</a></li>
<li id="menu-item-97098" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97098"><a target="_blank" href="https://www.paloaltonetworks.com/communities">Communities</a></li>
<li id="menu-item-97099" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97099"><a target="_blank" href="https://docs.paloaltonetworks.com/">Tech Docs</a></li>
<li id="menu-item-97100" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-97100"><a href="https://unit42.paloaltonetworks.com/">Unit 42</a></li>
<li id="menu-item-97101" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97101"><a target="_blank" href="https://www.paloaltonetworks.com/sitemap">Sitemap</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Legal Notices</h4><div class="menu-footer-legal-notices-phase-container"><ul id="menu-footer-legal-notices-phase" class="menu"><li id="menu-item-97093" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97093"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy</a></li>
<li id="menu-item-97094" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97094"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a></li>
<li id="menu-item-97095" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97095"><a target="_blank" href="https://www.paloaltonetworks.com/legal">Documents</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Account</h4><div class="menu-footer-trending-topics-phase-container"><ul id="menu-footer-trending-topics-phase" class="menu"><li id="menu-item-97102" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97102"><a href="https://start.paloaltonetworks.com/preference-center">Manage Subscriptions</a></li>
<li id="menu-item-97103" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97103"><a href="#" aria-label="menu-item">&nbsp;</a></li>
<li id="menu-item-97104" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97104"><a href="https://www.paloaltonetworks.com/security-disclosure">Report a Vulnerability</a></li>
</ul></div></div>              </div>
            </div>
          </div>

          
            <div class="copyrights py-25 mt-40">
               <p> 2024 Palo Alto Networks, Inc. All rights reserved.</p>
            </div>
          
        </div>
      </div>
    </div>
  </div>
</footer>
<form method="post">
<input type="hidden" id="_wpnonce" name="_wpnonce" value="c4f6a23be5" /><input type="hidden" name="_wp_http_referer" value="/excel-add-ins-malicious-xll-files-agent-tesla/" /></form>
<script type="text/javascript">
    const observer_lozad = lozad('.lozad, .lozad-background'); // lazy loads elements with default selector as '.lozad'
      observer_lozad.observe();
        if(referer == "Prisma" || referer == "Cortex" || referer == "Sase" || referer == "Unit" || referer == "Ngfw"){
	var Coveo_organizationId = "paloaltonetworksintranet";        
        var techDocsPagePath = "https://docs.paloaltonetworks.com/search.html#hd=All%20Prisma%20Cloud%20Documentation&hq=%40panproductcategory%3D%3D(%22Prisma%20Cloud%22)&sort=relevancy&layout=card&numberOfResults=25";
        var languageFromPath="en_US";
        window.Granite = window.Granite || {};
	Granite.I18n = (function() {
		var self = {};
		self.setLocale = function(locale) { };
		self.get = function(text, snippets, note) {
        	var out = "";
        	if(text){
        		if(text ==="coveo.clear"){
        			out = "Clear";
        		}else if(text ==="coveo.noresultsfound"){
        			out = "No results found for this search term.";
        		}
        	}
        	return out;
        };
        return self
	}());
}
/*
    var Coveo_organizationId = "paloaltonetworksintranetsandbox1";
    var searchResultsPagePath = "https://www.paloaltonetworks.com/search/prismasearch";
    var techDocsPagePath = "https://docs.paloaltonetworks.com/search";
    var languageFromPath="en_US";
    */
       	var main_site_critical_top = maindomain_lang+'/etc.clientlibs/panClean/components/mainNavigationComp/clientlibs/panClean/criticalTop.min.js';
	var main_site_defered = maindomain_lang+'/etc.clientlibs/panClean/components/mainNavigationComp/clientlibs/panClean/defered.min.js';
	var main_site_criticalTopBase = maindomain_lang+'/etc.clientlibs/panClean/components/mainNavigationComp/clientlibs/panClean/criticalTopBase.min.js';
	var main_site_criticalTopProductNav = maindomain_lang+'/etc.clientlibs/panClean/components/mainNavigationComp/clientlibs/panClean/criticalTopProductNav.min.js';
        window.PAN_MainNavAsyncUrl = maindomain_lang+"/_jcr_content/globals/cleanHeaderPrisma.prismaRenderer.html";

function loadScript(url, defer){
        var script1 = document.createElement('script');
        script1.setAttribute('type', 'text/javascript');
        script1.setAttribute('src',url);
        if(defer == true){
            script1.setAttribute('defer','defer');
        }
        document.head.appendChild(script1);
}
function loadScript1(url, callback){

        var script = document.createElement("script")
        script.type = "text/javascript";

        if (script.readyState){  //IE
            script.onreadystatechange = function(){
                if (script.readyState == "loaded" || script.readyState == "complete"){
                    script.onreadystatechange = null;
                    callback();
                }
            };
        } else {  //Others
            script.onload = function(){
                callback();
            };
        }

        script.src = url;
        document.getElementsByTagName("head")[0].appendChild(script);
}
if(referer == "Prisma" || referer == "Cortex" || referer == "Sase" || referer == "Unit" || referer == "Ngfw"){
	if(referer == "Unit"){
		loadScript(main_site_criticalTopBase, false);
		loadScript1(main_site_criticalTopProductNav, function(){
			window.PAN_initializeProduct2021Nav();
		});
		loadScript(main_site_defered, false);
	}
	else{
		loadScript1(main_site_critical_top, function(){
			window.PAN_initializeProduct2021Nav();
		});
		loadScript(main_site_defered, false);
	}
}
</script>
    <script type="text/javascript">
	var isProcessing = false; 
    function alter_ul_post_values(obj,post_id,ul_type){
	
		if (isProcessing)    
		return;  
		isProcessing = true;   
		var like_nonce = jQuery('#_wpnonce').val();
		jQuery(obj).find("span").html("..");
                jQuery.ajax({
                    type: "POST",
                    url: "https://unit42.paloaltonetworks.com/wp-content/plugins/like-dislike-counter-for-posts-pages-and-comments/ajax_counter.php",
                    data: "post_id="+post_id+"&up_type="+ul_type+"&ul_nonce="+like_nonce,
                    success: function(msg){
                            jQuery(obj).find("span").html(msg);
                            isProcessing = false; 
                            jQuery(obj).find('svg').children('path').attr('stroke','#0050FF');
                            jQuery(obj).removeClass('idc_ul_cont_not_liked idc_ul_cont_not_liked_inner');
                    }
 		});
	}
	</script>
    <link rel='stylesheet' id='wpdevart_lightbox_front_end_css-css' href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/wpdevart_lightbox_front.css?ver=6.3' type='text/css' media='all' />
<link rel='stylesheet' id='wpdevart_lightbox_effects-css' href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/effects_lightbox.css?ver=6.3' type='text/css' media='all' />
<script id="post-views-counter-frontend-js-before" type="text/javascript">
var pvcArgsFrontend = {"mode":"js","postID":121706,"requestURL":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","nonce":"8779151d12"};
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/post-views-counter/js/frontend.min.js?ver=1.3.13' id='post-views-counter-frontend-js'></script>
<script type='text/javascript' id='ppress-frontend-script-js-extra'>
/* <![CDATA[ */
var pp_ajax_form = {"ajaxurl":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","confirm_delete":"Are you sure?","deleting_text":"Deleting...","deleting_error":"An error occurred. Please try again.","nonce":"6af7f1c526","disable_ajax_form":"false","is_checkout":"0","is_checkout_tax_enabled":"0"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/wp-user-avatar/assets/js/frontend.min.js?ver=4.13.0' id='ppress-frontend-script-js'></script>
<script type='text/javascript' src='https://www.google.com/recaptcha/api.js' id='google/api-js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v5/dist/scripts/fancybox.js' id='unit42/fancybox-js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v5/dist/scripts/main.js' id='unit42/js-js'></script>
<script type='text/javascript' id='wpdevart_lightbox_front_end_js-js-extra'>
/* <![CDATA[ */
var wpdevart_lb_variables = {"eneble_lightbox_content":"enable","overlay_transparency_prancent":"80","enable_video_popuping":"enable","popup_background_color":"#000000","popup_loading_image":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/popup_loading.png","popup_initial_width":"350","popup_initial_height":"300","popup_youtube_width":"640","popup_youtube_height":"410","popup_vimeo_width":"500","popup_vimeo_height":"410","popup_max_width":"5000","popup_max_height":"5000","popup_position":"5","popup_fixed_position":"true","popup_outside_margin":"0","popup_border_width":"2","popup_border_color":"#000000","popup_border_radius":"10","control_buttons_show":"true","control_buttons_show_in_content":"false","control_buttons_height":"30","control_buttons_line_bg_color":"#000000","control_button_prev_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev.png","control_button_prev_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev_hover.png","control_button_next_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next.png","control_button_next_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next_hover.png","control_button_download_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download.png","control_button_download_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download_hover.png","control_button_innewwindow_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow.png","control_button_innewwindow_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow_hover.png","control_button_fullwidth_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth.png","control_button_fullwidht_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth_hover.png","control_button_fullwidthrest_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset.png","control_button_fullwidhtrest_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset_hover.png","control_button_close_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close.png","control_button_close_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close_hover.png","information_panel_show":"false","information_panel_padding_top":"0","information_panel_padding_bottom":"0","information_panel_show_in_content":"false","information_panel_bg_color":"#000000","information_panel_default_transparency":"100","information_panel_hover_trancparency":"100","information_panel_count_image_after_text":"Image","information_panel_count_image_middle_text":"of","information_panel_count_padding_left":"15","information_panel_count_padding_right":"4","information_panel_count_font_size":"20","information_panel_desc_padding_left":"15","information_panel_desc_padding_right":"4","information_panel_desc_font_size":"20","information_panel_desc_show_if_not":"true","information_panel_text_for_no_caption":"No Caption","information_panel_title_padding_left":"5","information_panel_title_padding_right":"5","information_panel_title_font_size":"15","information_panel_title_show_if_not":"true","information_panel_text_for_no_title":"No Title","information_panel_ordering":"{\"count\":[1,\"count\"],\"title\":[0,\"title\"],\"caption\":[0,\"caption\"]}"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/javascript/wpdevart_lightbox_front.js?ver=1.0' id='wpdevart_lightbox_front_end_js-js'></script>
          
  </body>
</html>
