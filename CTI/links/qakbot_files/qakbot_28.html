<!DOCTYPE html>
<html lang="en-GB">
<head >
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<!-- Author Meta Tags by Molongui Authorship, visit: https://wordpress.org/plugins/molongui-authorship/ -->
<meta name="author" content="PEko">
<!-- /Molongui Authorship -->

<title>Bypassing Qakbot Anti-Analysis</title>
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="lab52 &raquo; Feed" href="https://lab52.io/blog/feed/" />
<link rel="alternate" type="application/rss+xml" title="lab52 &raquo; Comments Feed" href="https://lab52.io/blog/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="lab52 &raquo; Bypassing Qakbot Anti-Analysis Comments Feed" href="https://lab52.io/blog/bypassing-qakbot-anti-analysis-tactics/feed/" />
<link rel="canonical" href="https://lab52.io/blog/bypassing-qakbot-anti-analysis-tactics/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.0\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/lab52.io\/blog\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.5.13"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([55357,56424,8205,55356,57212],[55357,56424,8203,55356,57212])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='atomic-blocks-fontawesome-css'  href='https://lab52.io/blog/wp-content/plugins/atomic-blocks/dist/assets/fontawesome/css/all.min.css?ver=1598525594' type='text/css' media='all' />
<link rel='stylesheet' id='genesis-sample-css'  href='https://lab52.io/blog/wp-content/themes/genesis-sample-develop/style.css?ver=2.9.2-dev' type='text/css' media='all' />
<style id='genesis-sample-inline-css' type='text/css'>

		.wp-custom-logo .title-area {
			padding-top: 7px;
		}
		
</style>
<link rel='stylesheet' id='wp-block-library-css'  href='https://lab52.io/blog/wp-includes/css/dist/block-library/style.min.css?ver=5.5.13' type='text/css' media='all' />
<link rel='stylesheet' id='atomic-blocks-style-css-css'  href='https://lab52.io/blog/wp-content/plugins/atomic-blocks/dist/blocks.style.build.css?ver=1598525594' type='text/css' media='all' />
<link rel='stylesheet' id='dashicons-css'  href='https://lab52.io/blog/wp-includes/css/dashicons.min.css?ver=5.5.13' type='text/css' media='all' />
<link rel='stylesheet' id='genesis-sample-gutenberg-css'  href='https://lab52.io/blog/wp-content/themes/genesis-sample-develop/lib/gutenberg/front-end.css?ver=2.9.2-dev' type='text/css' media='all' />
<style id='genesis-sample-gutenberg-inline-css' type='text/css'>
.ab-block-post-grid .ab-post-grid-items h2 a:hover {
	color: #0073e5;
}

.site-container .wp-block-button .wp-block-button__link {
	background-color: #0073e5;
}

.wp-block-button .wp-block-button__link:not(.has-background),
.wp-block-button .wp-block-button__link:not(.has-background):focus,
.wp-block-button .wp-block-button__link:not(.has-background):hover {
	color: #ffffff;
}

.site-container .wp-block-button.is-style-outline .wp-block-button__link {
	color: #0073e5;
}

.site-container .wp-block-button.is-style-outline .wp-block-button__link:focus,
.site-container .wp-block-button.is-style-outline .wp-block-button__link:hover {
	color: #2396ff;
}		.site-container .has-small-font-size {
			font-size: 12px;
		}		.site-container .has-normal-font-size {
			font-size: 18px;
		}		.site-container .has-large-font-size {
			font-size: 20px;
		}		.site-container .has-larger-font-size {
			font-size: 24px;
		}		.site-container .has-theme-primary-color,
		.site-container .wp-block-button .wp-block-button__link.has-theme-primary-color,
		.site-container .wp-block-button.is-style-outline .wp-block-button__link.has-theme-primary-color {
			color: #0073e5;
		}

		.site-container .has-theme-primary-background-color,
		.site-container .wp-block-button .wp-block-button__link.has-theme-primary-background-color,
		.site-container .wp-block-pullquote.is-style-solid-color.has-theme-primary-background-color {
			background-color: #0073e5;
		}		.site-container .has-theme-secondary-color,
		.site-container .wp-block-button .wp-block-button__link.has-theme-secondary-color,
		.site-container .wp-block-button.is-style-outline .wp-block-button__link.has-theme-secondary-color {
			color: #0073e5;
		}

		.site-container .has-theme-secondary-background-color,
		.site-container .wp-block-button .wp-block-button__link.has-theme-secondary-background-color,
		.site-container .wp-block-pullquote.is-style-solid-color.has-theme-secondary-background-color {
			background-color: #0073e5;
		}
</style>
<link rel='stylesheet' id='simple-social-icons-font-css'  href='https://lab52.io/blog/wp-content/plugins/simple-social-icons/css/style.css?ver=3.0.2' type='text/css' media='all' />
<link rel='stylesheet' id='wpgdprc.css-css'  href='https://lab52.io/blog/wp-content/plugins/wp-gdpr-compliance/assets/css/front.min.css?ver=1592813009' type='text/css' media='all' />
<style id='wpgdprc.css-inline-css' type='text/css'>

            div.wpgdprc .wpgdprc-switch .wpgdprc-switch-inner:before { content: 'Yes'; }
            div.wpgdprc .wpgdprc-switch .wpgdprc-switch-inner:after { content: 'No'; }
        
</style>
<script type='text/javascript' src='https://lab52.io/blog/wp-includes/js/jquery/jquery.js?ver=1.12.4-wp' id='jquery-core-js'></script>
<script type='text/javascript' src='https://lab52.io/blog/wp-content/plugins/simple-social-icons/svgxuse.js?ver=1.1.21' id='svg-x-use-js'></script>
<link rel="https://api.w.org/" href="https://lab52.io/blog/wp-json/" /><link rel="alternate" type="application/json" href="https://lab52.io/blog/wp-json/wp/v2/posts/1839" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://lab52.io/blog/xmlrpc.php?rsd" />
<link rel="alternate" type="application/json+oembed" href="https://lab52.io/blog/wp-json/oembed/1.0/embed?url=https%3A%2F%2Flab52.io%2Fblog%2Fbypassing-qakbot-anti-analysis-tactics%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://lab52.io/blog/wp-json/oembed/1.0/embed?url=https%3A%2F%2Flab52.io%2Fblog%2Fbypassing-qakbot-anti-analysis-tactics%2F&#038;format=xml" />
<style type="text/css"> .enews .screenread {
	height: 1px;
    left: -1000em;
    overflow: hidden;
    position: absolute;
    top: -1000em;
    width: 1px; } </style>        <style>
            .molongui-disabled-link
            {
                border-bottom: none !important;
                text-decoration: none !important;
                color: inherit !important;
                cursor: inherit !important;
            }
            .molongui-disabled-link:hover,
            .molongui-disabled-link:hover span
            {
                border-bottom: none !important;
                text-decoration: none !important;
                color: inherit !important;
                cursor: inherit !important;
            }
        </style>
        <link rel="pingback" href="https://lab52.io/blog/xmlrpc.php" />
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-95M8JQNZBF"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-95M8JQNZBF');
</script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-138573737-1');
</script>
<link rel="stylesheet" id="custom" href="/blog/wp-content/themes/genesis-sample-develop/custom.css" type="text/css" media="all">


<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>

<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#edeff5",
      "text": "#838391"
    },
    "button": {
      "background": "#4b81e8"
    }
  },
  "theme": "classic",
  "content": {
    "message": "We use our own and third-party cookies to improve and analyze your use of our site. You can change the settings, reject them or get more information about our cookie policy",
    "href": "/cookie_policy"
  }
})});
</script><link rel="icon" href="https://lab52.io/blog/wp-content/uploads/2019/03/cropped-logo-Lab52-32x32.png" sizes="32x32" />
<link rel="icon" href="https://lab52.io/blog/wp-content/uploads/2019/03/cropped-logo-Lab52-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon" href="https://lab52.io/blog/wp-content/uploads/2019/03/cropped-logo-Lab52-180x180.png" />
<meta name="msapplication-TileImage" content="https://lab52.io/blog/wp-content/uploads/2019/03/cropped-logo-Lab52-270x270.png" />
</head>
<body class="post-template-default single single-post postid-1839 single-format-standard wp-custom-logo wp-embed-responsive header-full-width full-width-content genesis-breadcrumbs-hidden genesis-footer-widgets-visible first-block-core-paragraph" itemscope itemtype="https://schema.org/WebPage"><div class="site-container"><ul class="genesis-skip-link"><li><a href="#genesis-nav-primary" class="screen-reader-shortcut"> Skip to primary navigation</a></li><li><a href="#genesis-content" class="screen-reader-shortcut"> Skip to main content</a></li><li><a href="#genesis-footer-widgets" class="screen-reader-shortcut"> Skip to footer</a></li></ul><header class="site-header" itemscope itemtype="https://schema.org/WPHeader"><div class="wrap"><div class="title-area"><a href="https://lab52.io/blog/" class="custom-logo-link" rel="home"><img width="150" height="56" src="https://lab52.io/blog/wp-content/uploads/2019/03/lab52.png" class="custom-logo" alt="lab52" /></a><p class="site-title" itemprop="headline"><a href="https://lab52.io/blog/">lab52</a></p><p class="site-description" itemprop="description">The threat intelligence division of S2 Grupo</p></div><nav class="nav-primary" aria-label="Main" itemscope itemtype="https://schema.org/SiteNavigationElement" id="genesis-nav-primary"><div class="wrap"><ul id="menu-header-menu" class="menu genesis-nav-menu menu-primary js-superfish"><li id="menu-item-35" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-35"><a href="/" itemprop="url"><span itemprop="name">Home</span></a></li>
<li id="menu-item-36" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-36"><a href="/faq" itemprop="url"><span itemprop="name">Faq</span></a></li>
<li id="menu-item-167" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-167"><a href="/blog" itemprop="url"><span itemprop="name">Blog</span></a></li>
<li id="menu-item-38" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-38"><a href="/about" itemprop="url"><span itemprop="name">About</span></a></li>
<li id="menu-item-39" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-39"><a href="/contact" itemprop="url"><span itemprop="name">Contact</span></a></li>
</ul></div></nav></div></header><div class="site-inner"><div class="content-sidebar-wrap"><main class="content" id="genesis-content"><article class="post-1839 post type-post status-publish format-standard has-post-thumbnail category-uncategorised tag-malware tag-qakbot entry" aria-label="Bypassing Qakbot Anti-Analysis" itemscope itemtype="https://schema.org/CreativeWork"><header class="entry-header"><h1 class="entry-title" itemprop="headline">Bypassing Qakbot Anti-Analysis</h1>
<p class="entry-meta"><time class="entry-time" itemprop="datePublished" datetime="2023-03-24T12:16:50+01:00">March 24, 2023</time></p></header><div class="entry-content" itemprop="text">
<p>QakBot is a banking trojan that has been evolving since its first version was discovered in 2008. According to the 2022 report published by CISA,<a href="https://www.splunk.com/en_us/blog/security/cisa-top-malware-summary.html"> it was one of the most active variants in 2021</a>, and during 2022 and so far in 2023 it has remained quite active. Taking a brief look at the latests news of QakBot it has been updating its tactics constantly, for example, using a Windows zero-day to <a rel="noreferrer noopener" href="https://www.bleepingcomputer.com/news/security/new-attacks-use-windows-security-bypass-zero-day-to-drop-malware/" data-type="URL" data-id="https://www.bleepingcomputer.com/news/security/new-attacks-use-windows-security-bypass-zero-day-to-drop-malware/" target="_blank">avoid displaying the MoTW</a> or the most recent one, using <a rel="noreferrer noopener" href="https://www.bleepingcomputer.com/news/security/how-to-prevent-microsoft-onenote-files-from-infecting-windows-with-malware/" data-type="URL" data-id="https://www.bleepingcomputer.com/news/security/how-to-prevent-microsoft-onenote-files-from-infecting-windows-with-malware/" target="_blank">OneNote files to drop QakBot</a>.</p>



<p>In this case we are particularly interested in the <strong>anti-analysis techniques used by QakBot during the early stages of its execution</strong>. These techniques can make malware analysis harder if they are not known, so learning to identify and bypass them is essential to get to see the malwareâ€™s operation at its full potential. Furthermore, there are techniques that can replicate / adopt different types of malware, so knowking them opens the door to the study of different samples.</p>



<p>This article is structured according to the verifications carried out using the following sample, focusing of those aspects that are most remarkable.<br></p>



<figure class="wp-block-table"><table><tbody><tr><td>md5</td><td>58e1c32eeb0130da19625e55ee48cf1e</td></tr><tr><td>sha1</td><td>00ae1c5066f67e5e71285de99bea8d8b67085743</td></tr><tr><td>sha256</td><td>f5ff6dbf5206cc2db098b41f5af14303f6dc43e36c5ec02604a50d5cfecf4790</td></tr><tr></tr><tr></tr><tr></tr><tr></tr><tr></tr><tr></tr><tr></tr><tr></tr><tr></tr></tbody></table></figure>



<p>The following image summarizes the checks performed by QakBot before executing its payload. This article is structured following this chain of checks, which corresponds to the anti-analysis techniques used by the sample.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" width="427" height="400" src="https://lab52.io/blog/wp-content/uploads/2023/03/qakbot-1.png" alt="" class="wp-image-1886" srcset="https://lab52.io/blog/wp-content/uploads/2023/03/qakbot-1.png 427w, https://lab52.io/blog/wp-content/uploads/2023/03/qakbot-1-300x281.png 300w" sizes="(max-width: 427px) 100vw, 427px" /><figcaption>Anti-analyis checks performed by Qakbot</figcaption></figure></div>



<h1>Windows Defender</h1>



<p>At the beginning of the program execution, QakBot will perform a first inevitable check since this sample is intended for Windows systems: to verify if Windows Defender is active. QakBot will perform this check by searching for <strong>representative files</strong>.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" width="456" height="117" src="https://lab52.io/blog/wp-content/uploads/2023/03/image-3.png" alt="" class="wp-image-1849" srcset="https://lab52.io/blog/wp-content/uploads/2023/03/image-3.png 456w, https://lab52.io/blog/wp-content/uploads/2023/03/image-3-300x77.png 300w" sizes="(max-width: 456px) 100vw, 456px" /><figcaption><em>llustration 1 Call to the first check function</em></figcaption></figure></div>



<p>Inside the function we can observe a mov to the EAX register and then a call to a function used recurrently during the whole execution of the program. This function has been renamed to <strong>mw_decode</strong> since its objective is to decode text strings, taking the EAX register as parameter and performing the XOR operation.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" width="405" height="185" src="https://lab52.io/blog/wp-content/uploads/2023/03/image-2.png" alt="" class="wp-image-1848" srcset="https://lab52.io/blog/wp-content/uploads/2023/03/image-2.png 405w, https://lab52.io/blog/wp-content/uploads/2023/03/image-2-300x137.png 300w" sizes="(max-width: 405px) 100vw, 405px" /><figcaption><em>Illustration 2 Call to mw_decode</em></figcaption></figure></div>



<div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" width="468" height="227" src="https://lab52.io/blog/wp-content/uploads/2023/03/image-4.png" alt="" class="wp-image-1850" srcset="https://lab52.io/blog/wp-content/uploads/2023/03/image-4.png 468w, https://lab52.io/blog/wp-content/uploads/2023/03/image-4-300x146.png 300w" sizes="(max-width: 468px) 100vw, 468px" /><figcaption><em>Illustration 3 mw_decode content</em></figcaption></figure></div>



<p>After performing all iterations of the loop, the decrypted string is visible when looking at the address of the ECX register. During all the checks performed by QakBot, this behavior can be seen.<br>In this case, the string refers to Windows Defender, since it is part of the empty files created by this utility.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" width="335" height="375" src="https://lab52.io/blog/wp-content/uploads/2023/03/image-5.png" alt="" class="wp-image-1851" srcset="https://lab52.io/blog/wp-content/uploads/2023/03/image-5.png 335w, https://lab52.io/blog/wp-content/uploads/2023/03/image-5-268x300.png 268w" sizes="(max-width: 335px) 100vw, 335px" /><figcaption><em>Illustration 4 Decrypted string related to Windows Defender: C:\INTERNAL\_empty</em></figcaption></figure></div>



<p>From here, taking the value <strong>C:\INTERNAL\_empty</strong> as a parameter, it makes a call to the function GetFileAttributesA of the Windows API. Then, checks if this file already exists in the system.<br><br>This check is made to know if Windows Defender is present in the system, since the file C:\INTERNAL_empty is part of the files that Windows Defender creates.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" width="795" height="320" src="https://lab52.io/blog/wp-content/uploads/2023/03/image-6.png" alt="" class="wp-image-1852" srcset="https://lab52.io/blog/wp-content/uploads/2023/03/image-6.png 795w, https://lab52.io/blog/wp-content/uploads/2023/03/image-6-300x121.png 300w, https://lab52.io/blog/wp-content/uploads/2023/03/image-6-768x309.png 768w" sizes="(max-width: 795px) 100vw, 795px" /><figcaption><em>Illustration 5 Call to GetFileAttributesA with representative string</em></figcaption></figure></div>



<p>In case, after making the API call, it detects that the Windows Defender-related file is present in the system, the sample execution will be stopped. Otherwise, QakBot will continue with its execution, to continue with the checks.</p>



<h1>Representative processes in execution</h1>



<p>The next check is on the system processes. The main objective is to evaluate if there is any security application that can be used to detect or to anlyse malware, such as antivirus applications or applications used by reserarchers, or in sandboxes. In order to do so, Qakbot analyses the list of process and compares it with known representative names of processes. </p>



<p>The first thing Qakbot will do is to load several hexadecimal values.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" width="340" height="392" src="https://lab52.io/blog/wp-content/uploads/2023/03/image-7.png" alt="" class="wp-image-1855" srcset="https://lab52.io/blog/wp-content/uploads/2023/03/image-7.png 340w, https://lab52.io/blog/wp-content/uploads/2023/03/image-7-260x300.png 260w" sizes="(max-width: 340px) 100vw, 340px" /><figcaption><em>Illustration 6 Loading values in hexadecimal</em></figcaption></figure></div>



<p>As mentioned before, <strong>mw_decode </strong>will continue to be used to decode the strings used by the malware, so the hexadecimal value 0x621, seen before at the start of the function, is saved in the EAX register.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" width="299" height="148" src="https://lab52.io/blog/wp-content/uploads/2023/03/image-8.png" alt="" class="wp-image-1856"/><figcaption><em>Illustration 7 Call to mw_decode with value 0x621 entered as a parameter</em></figcaption></figure></div>



<p>After calling the function in charge of decrypting the strings, it will start a loop to obtain all the processes names for which it will check their existence in the system.</p>



<p>For example, the following image shows a list of processes subject to check with the names: avgcsrvx.exe, avgsvcx.exe and avgcsrva.exe. These are representative processes of <a rel="noreferrer noopener" href="https://www.avg.com/es-es/homepage#pc" data-type="URL" data-id="https://www.avg.com/es-es/homepage#pc" target="_blank">AVG Free Antivirus</a>.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" width="796" height="315" src="https://lab52.io/blog/wp-content/uploads/2023/03/image-9.png" alt="" class="wp-image-1857" srcset="https://lab52.io/blog/wp-content/uploads/2023/03/image-9.png 796w, https://lab52.io/blog/wp-content/uploads/2023/03/image-9-300x119.png 300w, https://lab52.io/blog/wp-content/uploads/2023/03/image-9-768x304.png 768w" sizes="(max-width: 796px) 100vw, 796px" /><figcaption><em>Illustration 8 Some names of processes that will be checked</em></figcaption></figure></div>



<p>Once it has the strings to check, to obtain the first running process in the system it proceeds with calls to the CreateToolhelp32Snapshot and Process32First functions.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" width="465" height="409" src="https://lab52.io/blog/wp-content/uploads/2023/03/image-10.png" alt="" class="wp-image-1858" srcset="https://lab52.io/blog/wp-content/uploads/2023/03/image-10.png 465w, https://lab52.io/blog/wp-content/uploads/2023/03/image-10-300x264.png 300w" sizes="(max-width: 465px) 100vw, 465px" /><figcaption><em>Illustration 9 Calls to CreatToolhelp32Snapshot and Process32First</em></figcaption></figure></div>



<p>Qakbot then checks if the processes names obtained above match any currently active process in the system.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" width="879" height="340" src="https://lab52.io/blog/wp-content/uploads/2023/03/image-11.png" alt="" class="wp-image-1860" srcset="https://lab52.io/blog/wp-content/uploads/2023/03/image-11.png 879w, https://lab52.io/blog/wp-content/uploads/2023/03/image-11-300x116.png 300w, https://lab52.io/blog/wp-content/uploads/2023/03/image-11-768x297.png 768w" sizes="(max-width: 879px) 100vw, 879px" /><figcaption><em>Illustration 10 Iteration to compare processes names</em></figcaption></figure></div>



<p>It will perform this operation with all the processes, if any of them is equal to the ones it has defined, it will terminate the execution. In particular, the following processes names have been found to be subject to analysis. They are ordered with relation to the type of application in the following table.</p>



<figure class="wp-block-table is-style-regular"><table><tbody><tr><td><strong>Type</strong></td><td><strong>Name of process</strong></td></tr><tr><td>Antivirus</td><td>Avgcsrvx.exe Avgsvcx.exe Avgcsrva.exe ccSvcHst.exe MsMpEng.exe mcshield.exe Avp.exe kavtray.exe Egui.exe ekrn.exe Bdagent.exe Vsserv.exe vsservppl.exe AvastSvc.exe coreServiceShell.exe PccNTMon.exe NTRTScan.exe SAVAdminService.exe SavService.exe fshoster32.exe WRSA.exe Vkise.exe Isesrv.exe cmdagent.exe ByteFence.exe MBAMService.exe mbamgui.exe fmon.exe Dwengine.exe Dwarkdaemon.exe dwwatcher.exe bds-vision-agent-nai.exe bds-vision-apis.exe bds-vision-agent-app.exe</td></tr><tr><td>Malware Analysis</td><td>Fiddler.exe lordpe.exe regshot.exe Autoruns.exe Dsniff.exe HashMyFiles.exe ProcessHacker.exe Procmon.exe Procmon64.exe Netmon.exe pr0c3xp.exe ProcessHacker.exe CFF Explorer.exe dumpcap.exe Wireshark.exe idaq.exe Idaq64.exe ResourceHacker.exe MultiAnalysis_v1.0.294.exe x32dbg.exe Tcpview.exe OLLYDBG.EXE windbg.exe samp1e.exe sample.exe runsample.exe</td></tr><tr><td>Virtualization Environments</td><td>VBoxTray.exe vmtoolsd.exe vm3dservice.exe VGAuthService.exe TPAutoConnect.exe vmacthlp.exe VBoxTray.exe VboxService.exe</td></tr></tbody></table></figure>



<p>As anticipated, this point groups together checks involving both user protection and analysis tools. It is to be expected that successive versions of QakBot will update the previous list.<br>If QakBot does not find any process with the above names, it continues its execution with the next check.</p>



<h1>Modules </h1>



<p>If it passes the above check, it will make use of the Module32First and Module32Next APIs to get all the modules for each of the processes in the system.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" width="620" height="381" src="https://lab52.io/blog/wp-content/uploads/2023/03/image-12.png" alt="" class="wp-image-1862" srcset="https://lab52.io/blog/wp-content/uploads/2023/03/image-12.png 620w, https://lab52.io/blog/wp-content/uploads/2023/03/image-12-300x184.png 300w" sizes="(max-width: 620px) 100vw, 620px" /><figcaption><em>Illustration 11 Use of Module32First</em></figcaption></figure></div>



<p>If any of the system modules contain the string<strong> ivm-inject.dll</strong> or <strong>SbieDll.dll </strong>it will terminate its execution.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" width="592" height="187" src="https://lab52.io/blog/wp-content/uploads/2023/03/image-13.png" alt="" class="wp-image-1863" srcset="https://lab52.io/blog/wp-content/uploads/2023/03/image-13.png 592w, https://lab52.io/blog/wp-content/uploads/2023/03/image-13-300x95.png 300w" sizes="(max-width: 592px) 100vw, 592px" /><figcaption><em>Illustration 12 String ivm-inject.dll</em></figcaption></figure></div>



<div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" width="677" height="184" src="https://lab52.io/blog/wp-content/uploads/2023/03/image-14.png" alt="" class="wp-image-1864" srcset="https://lab52.io/blog/wp-content/uploads/2023/03/image-14.png 677w, https://lab52.io/blog/wp-content/uploads/2023/03/image-14-300x82.png 300w" sizes="(max-width: 677px) 100vw, 677px" /><figcaption><em>Illustration 13 String SbieDll.dll</em></figcaption></figure></div>



<p>The names of the DLLs have been identified as part of the <a href="https://sandboxie-plus.com/sandboxie/" target="_blank" rel="noreferrer noopener">Sandboxie</a> program, used to run programs in isolated environments. If any program uses these modules, it could be an indication that this analysis tool is on the system, and QakBot would stop its execution.</p>



<p>It is worth noting, for example, that the <a rel="noreferrer noopener" href="https://github.com/sandboxie-plus/Sandboxie" target="_blank">Sandboxie-Plus version</a> could incorporate utilities to hide the presence of SbieDll.dll.</p>



<h1>Characteristic names given to the sample</h1>



<p>Analysts have some habits that QakBot will check. In this case, it will check if in the name of the binary itself (the malware) is present any of the characteristic strings that could be used by analysts to rename the sample, before its execution, such as &#8220;sample&#8221;, &#8220;mlwr_sm&#8221;, &#8220;artifact.exe&#8221;. Again, these strings will be observed after the execution of mw_decode.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" width="538" height="183" src="https://lab52.io/blog/wp-content/uploads/2023/03/image-15.png" alt="" class="wp-image-1865" srcset="https://lab52.io/blog/wp-content/uploads/2023/03/image-15.png 538w, https://lab52.io/blog/wp-content/uploads/2023/03/image-15-300x102.png 300w" sizes="(max-width: 538px) 100vw, 538px" /><figcaption><em>Illustration 14 String sample</em></figcaption></figure></div>



<p>If any of these strings are found as part of the filename, it will stop the execution of the program. In addition, this check is not case-sensitive, i.e. it does not distinguish between upper and lower case.<br>It is curious, for example, that it does not also check that the name of the binary may correspond to a sha256 pattern, since samples downloaded from platforms such as VirusTotal or other systems retain in their name the hash of the binary, which the analyst may or may not rename.</p>



<h1>Anti-VM Techniques</h1>



<p>QakBot performs specific checks to determine if it is running in a virtual environment. These checks are described below.</p>



<h2>VMware version</h2>



<p>The malware will evaluate whether it is running within a VMWare virtual machine. To do that, QakBot will make use of a special VMWare I/O port. In particular, the verification at this point focuses on the port used by the official VMWare tools to perform the communications.<br>VMWare uses I/O port <strong>0x5658 </strong>to communicate internally with the deployed virtual machines, so the first step executed by QakBot is to save in the <strong>DX </strong>register the value corresponding to the I/O port. After this step, the value <strong>0x564D5868 </strong>is stored in EAX. This value corresponds to the string &#8216;<strong>VMXh</strong>&#8216;, which is the VMWare magic number.<br>Finally, the internal VMWare command is specified. In this case <strong>0x0A </strong>is used, which corresponds to the command to obtain information from VMWare.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" width="500" height="366" src="https://lab52.io/blog/wp-content/uploads/2023/03/image-16.png" alt="" class="wp-image-1866" srcset="https://lab52.io/blog/wp-content/uploads/2023/03/image-16.png 500w, https://lab52.io/blog/wp-content/uploads/2023/03/image-16-300x220.png 300w" sizes="(max-width: 500px) 100vw, 500px" /><figcaption><em>Illustration 15 Check code: VMware</em></figcaption></figure></div>



<p>After performing the &#8220;<strong>in</strong>&#8221; instruction, the EBX and ECX registers will be modified.<br>In the EBX register the magic number of Vmware will be written, while in the ECX register the value corresponding to VMWare products will be stored. The following values are known:<br>&#8211; 01h = Express<br>&#8211; 02h = ESX Server<br>&#8211; 03h = GSX Server<br>&#8211; 04h = Workstation</p>



<h2>RAM memory size</h2>



<p>If the previous check is passed, QakBot proceeds to obtain the size of the memory allocated to the system. This check is performed, like the previous check, using the I/O port, but in this case it uses the value <strong>0x14 </strong>as the command. The resulting value will be stored in the EAX register, to later perform a move to EBP. It is important to note that, if the previous check does not detect that it is running in a VM and passes to this check, here it makes again use of the I/O port, which would be a contradiction.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" width="502" height="354" src="https://lab52.io/blog/wp-content/uploads/2023/03/image-17.png" alt="" class="wp-image-1867" srcset="https://lab52.io/blog/wp-content/uploads/2023/03/image-17.png 502w, https://lab52.io/blog/wp-content/uploads/2023/03/image-17-300x212.png 300w" sizes="(max-width: 502px) 100vw, 502px" /><figcaption><em>Illustration 16 Check code: PC memory</em></figcaption></figure></div>



<p>QakBot will decide if it is inside a VM at this point by comparing the value stored in the EBP register, which contains the size of the machine&#8217;s RAM, against the value 0x2000, which is equivalent to 8192 in decimal. It means that, if the machine has less than 8 Gbytes of RAM, QakBot will decide that it is in a virtual machine.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" width="543" height="178" src="https://lab52.io/blog/wp-content/uploads/2023/03/image-18.png" alt="" class="wp-image-1868" srcset="https://lab52.io/blog/wp-content/uploads/2023/03/image-18.png 543w, https://lab52.io/blog/wp-content/uploads/2023/03/image-18-300x98.png 300w" sizes="(max-width: 543px) 100vw, 543px" /><figcaption><em>Illustration 17 RAM size check</em></figcaption></figure></div>



<p>Note that QakBot only performs this check if it has previously detected that it is not running in a virtual machine using the VMWare I/O port. However, it is curious that the malware uses the VMWare I/O port again during this check, as it should not be able to obtain a valid RAM value when it is not running in a VMWare environment.</p>



<h2>CPU Characteristics</h2>



<p>For the last check QakBot will make use of the <strong>cpuid </strong>instruction. This instruction returns different values based on the value stored in EAX. In this case an EAX xor operation is performed on EAX, which results in a 0 always.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" width="455" height="132" src="https://lab52.io/blog/wp-content/uploads/2023/03/image-19.png" alt="" class="wp-image-1869" srcset="https://lab52.io/blog/wp-content/uploads/2023/03/image-19.png 455w, https://lab52.io/blog/wp-content/uploads/2023/03/image-19-300x87.png 300w" sizes="(max-width: 455px) 100vw, 455px" /><figcaption><em>Illustration 18 <em>cpuid</em> instruction </em></figcaption></figure></div>



<p>When cpuid has a 0 as EAX value, it returns the CPU manufacturer, which is precisely the target pursued by the malware in this step. Then, it performs three memcpy operations to reorder the resulting string.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" width="392" height="376" src="https://lab52.io/blog/wp-content/uploads/2023/03/image-20.png" alt="" class="wp-image-1870" srcset="https://lab52.io/blog/wp-content/uploads/2023/03/image-20.png 392w, https://lab52.io/blog/wp-content/uploads/2023/03/image-20-300x288.png 300w" sizes="(max-width: 392px) 100vw, 392px" /><figcaption><em>Illustration 19 memcpy instructions</em></figcaption></figure></div>



<p>After the operations the final string will correspond to the CPU manufacturer of the system.<br>Once it has obtained this data, it moves the value 1 to EAX to call cpuid again. When cpuid is called with EAX value 1, this operation returns the processor information.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" width="441" height="78" src="https://lab52.io/blog/wp-content/uploads/2023/03/image-21.png" alt="" class="wp-image-1871" srcset="https://lab52.io/blog/wp-content/uploads/2023/03/image-21.png 441w, https://lab52.io/blog/wp-content/uploads/2023/03/image-21-300x53.png 300w" sizes="(max-width: 441px) 100vw, 441px" /><figcaption><em>Illustration 20 Processor information request</em></figcaption></figure></div>



<p>The information received in ECX after the execution of the cpuid instruction will always end with a value of 0 in the case of a physical machine, but in the case of a virtual machine it will be 1.<br>It should be noted at this point that for both VMware and VirtualBox system execution a value of 3 is received, so that for both platforms it would be possible to bypass this check.</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" width="545" height="117" src="https://lab52.io/blog/wp-content/uploads/2023/03/image-22.png" alt="" class="wp-image-1872" srcset="https://lab52.io/blog/wp-content/uploads/2023/03/image-22.png 545w, https://lab52.io/blog/wp-content/uploads/2023/03/image-22-300x64.png 300w" sizes="(max-width: 545px) 100vw, 545px" /><figcaption><em>Illustration 21 Return value for VMware</em></figcaption></figure></div>



<h1>Conclusions</h1>



<p>This analysis has focused on the anti-analysis capabilities employed by QakBot in order to help overcome these obstacles before starting the analysis. The anti-analysis techniques detailed here can be used by different malware, so it is very important to be aware of them. However, it is important to note that this analysis is based on a specific sample of QakBot malware, and there are various other families of malware that employ different anti-analysis techniques that have not been covered in this report. These techniques may be explored in future posts.</p>



<p>Regarding the analysis performed, it is also interesting to highlight the checks made by Qakbot to detect if it is under a virtualized environment, as these checks only applyies to VMWare software when using VMWare&#8217;s own I/O port, and searching by its unique magic number. </p>



<h1>References</h1>



<p><a href="https://sites.google.com/site/chitchatvmback/backdoor" data-type="URL" data-id="https://sites.google.com/site/chitchatvmback/backdoor" target="_blank" rel="noreferrer noopener">VMware Backdoor I/O Port</a></p>



<p><a rel="noreferrer noopener" href="https://c9x.me/x86/html/file_module_x86_id_45.html" data-type="URL" data-id="https://c9x.me/x86/html/file_module_x86_id_45.html" target="_blank">CPUID instruction reference</a></p>



<p><a href="https://www.kernelmode.info/forum/viewtopiccf27.html?f=13&amp;t=5496" target="_blank" rel="noreferrer noopener">Windows Defender DB dump and VDLL&#8217;s</a></p>

<!-- MOLONGUI AUTHORSHIP PLUGIN 4.7.4 -->
<!-- https://www.molongui.com/authorship/ -->

<div class="molongui-clearfix"></div>
<div id="mab-3129202661"
     class="m-a-box "
          data-plugin-release="4.7.4"
     data-plugin-version="lite"
     data-box-layout="slim"
     data-box-position="below"
     data-multiauthor="false"
     data-author-id="25"
     data-author-type="user"
     data-author-archived="">

	
    <div class="m-a-box-container">

        <div class="m-a-box-tab m-a-box-content m-a-box-profile"
             data-profile-layout="layout-1"
             data-author-ref="user-25"
             itemscope itemid="https://lab52.io/blog/author/peko/" itemtype="https://schema.org/Person"        >
            
<div class="m-a-box-content-top">

	
</div><!-- End of .m-a-box-content-top -->

<div class="m-a-box-content-middle">

    <!-- Author picture -->
    
	<div class="m-a-box-item m-a-box-avatar" data-source="local">
		                <a class="m-a-box-avatar-url" href="">
                    <img src="https://lab52.io/blog/wp-content/uploads/2019/03/flask-150x150.png" width="150" height="150" alt="Avatar" class="avatar avatar-150 wp-user-avatar wp-user-avatar-150 photo avatar-default" />                </a>
                	</div>

    <!-- Author social -->
    
    <!-- Author data -->
    <div class="m-a-box-item m-a-box-data">

        <!-- Author name -->
        
<div class="m-a-box-name m-a-box-title">
	<h5 >
                        <a class="m-a-box-name-url " href="https://lab52.io/blog/author/peko/" >
		            PEko                </a>
	            	</h5>
</div>
        <!-- Author metadata -->
        
<div class="m-a-box-item m-a-box-meta">

    
    
    
	
	
	
	        		<script type="text/javascript" language="JavaScript">
			if ( typeof window.ToggleAuthorshipData === 'undefined' )
			{
				function ToggleAuthorshipData(id, author)
				{
					let box_selector = '#mab-' + id;
                    let box = document.querySelector(box_selector);
                    if ( box.getAttribute('data-multiauthor') ) box_selector = '#mab-' + id + ' [data-author-ref="' + author + '"]';
                    let label = document.querySelector(box_selector + ' ' + '.m-a-box-data-toggle');
					label.innerHTML = ( label.text.trim() === "+ posts" ? " <span class=\"m-a-box-string-bio\">Bio</span>" : " <span class=\"m-a-box-string-more-posts\">+ posts</span>" );
                    let bio     = document.querySelector(box_selector + ' ' + '.m-a-box-bio');
                    let related = document.querySelector(box_selector + ' ' + '.m-a-box-related-entries');

					if ( related.style.display === "none" )
					{
						related.style.display = "block";
						bio.style.display     = "none";
					}
					else
					{
						related.style.display = "none";
						bio.style.display     = "block";
					}
				}
			}
		</script>
		<a href="javascript:ToggleAuthorshipData(3129202661, 'user-25')" class="m-a-box-data-toggle" > <span class="m-a-box-string-more-posts">+ posts</span> </a>
	
</div><!-- End of .m-a-box-meta -->

        <!-- Author bio -->
        
<div class="m-a-box-bio" >
    </div>

        
            <!-- Author related posts -->
            <div class="m-a-box-related" data-related-layout="layout-1">
                <div class="m-a-box-item m-a-box-related-entries" style="display: none;">

                    <ul>
                            <li>
        <div class="m-a-box-related-entry" >
            <div class="molongui-display-none" >
                <div >PEko</div>
                <div >https://lab52.io/blog/author/peko/</div>
            </div>
            <div class="m-a-box-related-entry-title">
                <i class="m-a-icon-doc"></i>
                <a class="molongui-remove-underline" href="https://lab52.io/blog/ransomware-2023/" >
                    <span >Ransomware's Christmas Carol</span>
                </a>
            </div>
        </div>
    </li>
                        </ul>

                </div><!-- End of .m-a-box-related-entries -->
            </div><!-- End of .m-a-box-related -->

        
    </div><!-- End of .m-a-box-data -->

</div><!-- End of .m-a-box-content-middle -->

<div class="m-a-box-content-bottom"></div><!-- End of .m-a-box-content-bottom -->        </div><!-- End of .m-a-box-profile -->

        
    </div><!-- End of .m-a-box-container -->

	
</div><!-- End of .m-a-box --><!--<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			xmlns:dc="http://purl.org/dc/elements/1.1/"
			xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
		<rdf:Description rdf:about="https://lab52.io/blog/bypassing-qakbot-anti-analysis-tactics/"
    dc:identifier="https://lab52.io/blog/bypassing-qakbot-anti-analysis-tactics/"
    dc:title="Bypassing Qakbot Anti-Analysis"
    trackback:ping="https://lab52.io/blog/bypassing-qakbot-anti-analysis-tactics/trackback/" />
</rdf:RDF>-->
</div><footer class="entry-footer"><p class="entry-meta"> <span class="entry-author" itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="https://lab52.io/blog/author/peko/" class="entry-author-link" rel="author" itemprop="url"><span class="entry-author-name" itemprop="name">PEko</span></a></span></p></footer></article><h2 class="screen-reader-text">Reader Interactions</h2>	<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/blog/bypassing-qakbot-anti-analysis-tactics/#respond" style="display:none;">Cancel reply</a></small></h3><form action="https://lab52.io/blog/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate><p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span></p><p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" required="required"></textarea></p><p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" required='required' /></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="email" value="" size="30" maxlength="100" aria-describedby="email-notes" required='required' /></p>
<div class="anr_captcha_field"><div id="anr_captcha_field_1" class="anr_captcha_field_div"></div></div><p class="wpgdprc-checkbox"><input type="checkbox" name="wpgdprc" id="wpgdprc" value="1" /><label for="wpgdprc">I hereby declare to have read and accepted the <a href="/legal_note">legal notice</a> and the <a href="/privacy_policy">privacy policy</a>. <abbr class="wpgdprc-required" title="You need to accept this checkbox.">*</abbr></label></p><p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='1839' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p></form>	</div><!-- #respond -->
	<div class="related"><h3 class="related-title">Related</h3><div class="related-posts"><div class="related-post"><a href="https://lab52.io/blog/2344-2/" rel="bookmark" title="Permanent Link to New invitation from APT29 to use CCleaner"><img width="400" height="222" src="https://lab52.io/blog/wp-content/uploads/2023/07/Image20230712114555-400x222.jpg" class="related-post-image" alt="" loading="lazy" /></a><div class="related-post-info"><a class="related-post-title" href="https://lab52.io/blog/2344-2/" rel="bookmark" title="Permanent Link to New invitation from APT29 to use CCleaner">New invitation from APT29 to use CCleaner</a><div class="related-post-date"><time class="entry-time" itemprop="datePublished" datetime="2023-07-12T16:35:00+02:00">July 12, 2023</time></div><div class="related-post-tags"><span class="entry-tags">Tags: <a href="https://lab52.io/blog/tag/apt29/" rel="tag">APT29</a>, <a href="https://lab52.io/blog/tag/ccleaner/" rel="tag">CCleaner</a>, <a href="https://lab52.io/blog/tag/dllside-load/" rel="tag">DLLSide-Load</a>, <a href="https://lab52.io/blog/tag/phishing/" rel="tag">phishing</a>, <a href="https://lab52.io/blog/tag/russia/" rel="tag">Russia</a>, <a href="https://lab52.io/blog/tag/svg/" rel="tag">SVG</a></span></div><div class="related-post-categories"></div></div></div><div class="related-post"><a href="https://lab52.io/blog/beyond-appearances-unknown-actor-using-apt29s-ttp-against-chinese-users/" rel="bookmark" title="Permanent Link to Beyond appearances: unknown actor using APT29&#8217;s TTP against Chinese users"><img width="400" height="222" src="https://lab52.io/blog/wp-content/uploads/2023/07/CV-maldoc-400x222.png" class="related-post-image" alt="" loading="lazy" /></a><div class="related-post-info"><a class="related-post-title" href="https://lab52.io/blog/beyond-appearances-unknown-actor-using-apt29s-ttp-against-chinese-users/" rel="bookmark" title="Permanent Link to Beyond appearances: unknown actor using APT29&#8217;s TTP against Chinese users">Beyond appearances: unknown actor using APT29&#8217;s TTP against Chinese users</a><div class="related-post-date"><time class="entry-time" itemprop="datePublished" datetime="2023-07-07T13:31:40+02:00">July 07, 2023</time></div><div class="related-post-tags"></div><div class="related-post-categories"></div></div></div><div class="related-post"><a href="https://lab52.io/blog/the-chinese-trap/" rel="bookmark" title="Permanent Link to The Chinese trap"><img width="400" height="222" src="https://lab52.io/blog/wp-content/uploads/2023/06/diagram-400x222.jpg" class="related-post-image" alt="" loading="lazy" /></a><div class="related-post-info"><a class="related-post-title" href="https://lab52.io/blog/the-chinese-trap/" rel="bookmark" title="Permanent Link to The Chinese trap">The Chinese trap</a><div class="related-post-date"><time class="entry-time" itemprop="datePublished" datetime="2023-06-08T18:39:29+02:00">June 08, 2023</time></div><div class="related-post-tags"></div><div class="related-post-categories"></div></div></div></div></div></main></div></div><div class="footer-widgets" id="genesis-footer-widgets"><h2 class="genesis-sidebar-title screen-reader-text">Footer</h2><div class="wrap"><div class="widget-area footer-widgets-1 footer-widget-area"><section id="search-4" class="widget widget_search"><div class="widget-wrap"><form class="search-form" method="get" action="https://lab52.io/blog/" role="search" itemprop="potentialAction" itemscope itemtype="https://schema.org/SearchAction"><label class="search-form-label screen-reader-text" for="searchform-1">Search this website</label><input class="search-form-input" type="search" name="s" id="searchform-1" placeholder="Search this website" itemprop="query-input"><input class="search-form-submit" type="submit" value="Search"><meta content="https://lab52.io/blog/?s={s}" itemprop="target"></form></div></section>
</div></div></div><footer class="site-footer" itemscope itemtype="https://schema.org/WPFooter"><div class="wrap"><p> <footer id="footer" class="full-width">                 <span class="small-text-footer italic">Copyright &amp;copy Lab52 2019 by <a href="https://s2grupo.es/en/home/" target="_blank">S2 Grupo</a> | <a href="/legal_note" target="_blank">Legal notice</a> | <a href="/cookie_policy" target="_blank">Cookie policy</a> | <a href="/privacy_policy" target="_blank">Privacy policy</a></span>             </footer></p></div></footer></div>			<script type="text/javascript">
				var anr_onloadCallback = function() {
					for ( var i = 0; i < document.forms.length; i++ ) {
						var form = document.forms[i];
						var captcha_div = form.querySelector( '.anr_captcha_field_div' );

						if ( null === captcha_div )
							continue;
						captcha_div.innerHTML = '';
						( function( form ) {
							var anr_captcha = grecaptcha.render( captcha_div,{
								'sitekey' : '6Lf4ZJwUAAAAAN67aD_PPXidoEzI-aIrP47hK41b',
								'size'  : 'normal',
								'theme' : 'light'
							});
							if ( typeof jQuery !== 'undefined' ) {
								jQuery( document.body ).on( 'checkout_error', function(){
									grecaptcha.reset(anr_captcha);
								});
							}
							if ( typeof wpcf7 !== 'undefined' ) {
								document.addEventListener( 'wpcf7submit', function() {
									grecaptcha.reset(anr_captcha);
								}, false );
							}
						})(form);
					}
				};
			</script>
						<script src="https://www.google.com/recaptcha/api.js?onload=anr_onloadCallback&#038;render=explicit"
				async defer>
			</script>
				<script type="text/javascript">
		function atomicBlocksShare( url, title, w, h ){
			var left = ( window.innerWidth / 2 )-( w / 2 );
			var top  = ( window.innerHeight / 2 )-( h / 2 );
			return window.open(url, title, 'toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width=600, height=600, top='+top+', left='+left);
		}
	</script>
	<script type="text/javascript" src="/blog/wp-content/themes/genesis-sample-develop/custom.js"></script> 
<style type="text/css" media="screen"></style><link rel='stylesheet' id='molongui-authorship-box-css'  href='https://lab52.io/blog/wp-content/plugins/molongui-authorship/assets/css/author-box.69f2.min.css?ver=4.7.4' type='text/css' media='all' />
<style id='molongui-authorship-box-inline-css' type='text/css'>
:root{ --m-a-box-bp: 600px; --m-a-box-bp-l: 599px; }.m-a-box {width:100%;margin-top:20px !important;margin-right:0 !important;margin-bottom:20px !important;margin-left:0 !important;} .m-a-box-header {margin-bottom:20px;} .m-a-box-header > :first-child,  .m-a-box-header a.m-a-box-header-url {font-size:px;line-height:px;} .m-a-box-container {padding-top:0;padding-right:0;padding-bottom:0;padding-left:0;border-style:solid;border-top-width:1px;border-right-width:0;border-bottom-width:1px;border-left-width:0;border-color:#e8e8e8;background-color:#f7f8f9;box-shadow:10px 10px 10px #ababab ;} .m-a-box-avatar img,  .m-a-box-avatar div[data-avatar-type="acronym"] {border-style:solid;border-width:2px;border-color:#bfbfbf;border-radius:%;} .m-a-box-name *  {font-size:22px;line-height:px;} .m-a-box-content.m-a-box-profile .m-a-box-data .m-a-box-meta * {font-size:12px;line-height:px;} .m-a-box-meta-divider {padding:0 0.2em;} .m-a-box-bio > * {font-size:14px;line-height:px;} .m-icon-container {background-color: inherit; border-color: inherit; color: #999999 !important;font-size:20px;} .m-a-box-related-entry-title,  .m-a-box-related-entry-title a {font-size:14px;}
</style>
<script type='text/javascript' src='https://lab52.io/blog/wp-content/plugins/atomic-blocks/dist/assets/js/dismiss.js?ver=1598525594' id='atomic-blocks-dismiss-js-js'></script>
<script type='text/javascript' id='molongui-authorship-byline-js-extra'>
/* <![CDATA[ */
var molongui_authorship_byline_params = {"byline_prefix":"","byline_suffix":"","byline_separator":", ","byline_last_separator":" and ","byline_link_title":"View all posts by","byline_link_class":"","byline_dom_tree":"","byline_dom_prepend":"","byline_dom_append":"","byline_decoder":"v3"};
/* ]]> */
</script>
<script type='text/javascript' src='https://lab52.io/blog/wp-content/plugins/molongui-authorship/assets/js/byline.334a.min.js?ver=4.7.4' id='molongui-authorship-byline-js'></script>
<script type='text/javascript' src='https://lab52.io/blog/wp-includes/js/comment-reply.min.js?ver=5.5.13' id='comment-reply-js'></script>
<script type='text/javascript' src='https://lab52.io/blog/wp-includes/js/hoverIntent.min.js?ver=1.8.1' id='hoverIntent-js'></script>
<script type='text/javascript' src='https://lab52.io/blog/wp-content/themes/genesis/lib/js/menu/superfish.min.js?ver=1.7.10' id='superfish-js'></script>
<script type='text/javascript' src='https://lab52.io/blog/wp-content/themes/genesis/lib/js/menu/superfish.args.min.js?ver=3.3.3' id='superfish-args-js'></script>
<script type='text/javascript' src='https://lab52.io/blog/wp-content/themes/genesis/lib/js/skip-links.min.js?ver=3.3.3' id='skip-links-js'></script>
<script type='text/javascript' id='genesis-sample-responsive-menu-js-extra'>
/* <![CDATA[ */
var genesis_responsive_menu = {"mainMenu":"Menu","menuIconClass":"dashicons-before dashicons-menu","subMenu":"Submenu","subMenuIconClass":"dashicons-before dashicons-arrow-down-alt2","menuClasses":{"combine":[".nav-primary"],"others":[]}};
/* ]]> */
</script>
<script type='text/javascript' src='https://lab52.io/blog/wp-content/themes/genesis-sample-develop/js/responsive-menus.min.js?ver=2.9.2-dev' id='genesis-sample-responsive-menu-js'></script>
<script type='text/javascript' src='https://lab52.io/blog/wp-content/themes/genesis-sample-develop/js/genesis-sample.js?ver=2.9.2-dev' id='genesis-sample-js'></script>
<script type='text/javascript' id='wpgdprc.js-js-extra'>
/* <![CDATA[ */
var wpgdprcData = {"ajaxURL":"https:\/\/lab52.io\/blog\/wp-admin\/admin-ajax.php","ajaxSecurity":"1f335a6398","isMultisite":"","path":"\/","blogId":""};
/* ]]> */
</script>
<script type='text/javascript' src='https://lab52.io/blog/wp-content/plugins/wp-gdpr-compliance/assets/js/front.min.js?ver=1592813009' id='wpgdprc.js-js'></script>
<script type='text/javascript' src='https://lab52.io/blog/wp-includes/js/wp-embed.min.js?ver=5.5.13' id='wp-embed-js'></script>
<script type='text/javascript' src='https://cdn.jsdelivr.net/npm/css-element-queries@1.2.2/src/ResizeSensor.min.js?ver=1.2.2' id='molongui-resizesensor-js'></script>
<script type='text/javascript' src='https://cdn.jsdelivr.net/npm/css-element-queries@1.2.2/src/ElementQueries.min.js?ver=1.2.2' id='molongui-elementqueries-js'></script>
<div data-m-brand="Molongui" data-m-id="Authorship" data-m-license="Lite" data-m-version="4.7.4" data-m-link="https://www.molongui.com/authorship/"></div></body></html>

<!-- Dynamic page generated in 1.593 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2024-01-01 13:02:50 -->

<!-- super cache -->